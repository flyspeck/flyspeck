
% total ratings 16400 as of 5/18/2010.
% 2011/12/11 changed flat->straight

\chapter{Local Fan}\label{sec:local}



\begin{summary}
  The difficult technical estimates that we need for the proof of the
  Kepler conjecture are found in this chapter.  The standard form
of the main estimate
  (Theorem~\ref{lemma:empty-d}) takes the form
\begin{equation}\label{eqn:main}
\tau(V,E,F) \ge d(k),\quad k= \card(V)\in \{3,4,5,6\}.
\end{equation}
Here $(V,E)$ is a fan satisfying various technical conditions, and $F$
is a face of the hypermap of $(V,E)$.  The function $d$ is defined by
a table of real numbers.  Heuristically, the real-valued
function $\tau$ measures the looseness of a packing.  Large values of
$\tau$ indicate that the points of $V$ are loosely arranged around the
face and small values of $\tau$ indicate a tight packing.  The main
estimate gives limits to the tightness of a packing, with the eventual
aim of showing that no packing can have density greater than the FCC
packing.  

This chapter also proves the well-know result that the perimeter of a
geodesically convex spherical polygon is never greater than $2\pi$,
the length of a great circle.
\end{summary}


\section{Localization}

The \newterm{localization} of a fan along
a face discards everything but the part of the fan near the face.  
The localization is used to focus attention on a single face
in a fan.  
We also introduce a notion of convexity that is suitable for local fans.

\subsection{basics}

Roughly speaking,
a local fan is to a fan what a polygon is to a biconnected plane graph.  


\begin{definition}[local fan]\guid{FTNGOGF} \label{def:convex-local}
\formaldef{local fan}{local\_fan}
\formaldef{nonreflexive local fan}{convex\_local\_fan}
A triple $(V,E,F)$ is a \newterm{local fan} if the following conditions hold.
\begin{enumerate} 
\item \firstcase{fan} $(V,E)$ is a fan.
\item \firstcase{face} $F$ is a face of $H = \op{hyp}(V,E)$.
\item \firstcase{dihedral} $H$ is isomorphic to $\op{Dih}_{2k}$, where $k =
\card(F)$.
\end{enumerate}
A local fan $(V,E,F)$ is said to be \newterm{nonreflexive}\footnote{An angle
greater than $\pi$ is a \newterm{reflex angle}.} if the following
additional conditions hold.
\begin{enumerate}
\setcounter{enumi}{3}
\item %\setcounter{enumi}{4} 
\firstcase{angle} $\op{azim}(x)\le \pi$ for all darts $x\in F$.
\item \firstcase{wedge} $V\subset \Wdart(x)$ for all $x\in F$.
% \item If $\{\v,\w\}\in E$, then $\{\orz,\v,\w\}$ is not
%   collinear. %% part of def of fan.
\end{enumerate}
\end{definition}
\indy{Index}{fan!local}%

In the proof of the Kepler conjecture in this chapter and the next,
all local fans are nonreflexive.  Local fans (that are reflexive) appear in
applications to other packing problems in Section~\ref{sec:further}.

\begin{remark}[visualization]\guid{PNCVUMY}\label{rem:visual}
\hspace{-3pt}
  If $(V,E,F)$ is a local fan,
  the intersection of $X(V,E)$ with the unit sphere is a spherical
  polygon, which gives a visual representation of the fan (Figure~\ref{fig:reflex}).
  In the first part of the chapter, the lengths $\normo{\v}$, for $\v\in V$,
  have little importance, and the spherical polygon captures the relevant
  features of the local fan.
  The choice of $F$ distinguishes the interior of the polygon from its
  exterior.  If the local fan is nonreflexive, then the interior of the
  polygon is geodesically convex.
\end{remark}

\figFWYNFVS % fig:reflex


\begin{lemma}[]\guid{WRGCVDR}\rz{0}%
\oldrating{300}
\formalauthor{Nguyen Quang Truong}
For any local fan $(V,E,F)$, there is a bijection from $F$ onto $V$
given by
\[ 
(\v,\w) \mapsto \v.
\] 
Moreover, write $\v\mapsto(\v,\rho\v)$ for the inverse map. 
Then $\rho:V\to V$ is a cyclic permutation.  That is, the orbit
of each $\v$ under $\rho$ is $V$.
\end{lemma}
\indy{Index}{cyclic!permutation}%

%\begin{definition}[$\rho$]\guid{ZHUECEC}
%We write $\rho=\rho_{V,E,F}$ for the permutation $\rho:V\to V$
%determined by the lemma.
%\end{definition}



\begin{proof} The map from a face to the set of nodes is a bijection
  for the dihedral hypermap $\op{Dih}_{2k}$. It is a also bijection
  for a fan isomorphic to $\op{Dih}_{2k}$.

For all $(\v,\rho \v)\in F$,
\[ 
f(\v,\rho \v) = (\rho\v,\rho^2\v),
\] 
so that the orbit of $\v$ under $\rho$ in $V$ corresponds under the
bijection to the orbit of a dart under $f$ on $F$, which $F$.  Thus,
$\rho$ is a cyclic permutation of $V$ of order $k=\card(V)$.
\end{proof}

\begin{definition}[$\rho$,~$\nd$]\guid{MFMPCVM} 
\formaldef{$\rho$}{rho\_node}
\formaldef{$\nd$}{FST}
For any  local fan $(V,E,F)$, write $\rho=\rho_{V,E,F}:V\to V$
and $\nd:F\to V$  for the bijections of the preceding
lemma.
\end{definition}
\indy{Notation}{zzr@$\rho$ (permutation on nodes of a local fan)}%
%\indy{Notation}{node@$\nd$}%
\indy{Notation}{node@$\nd:D\to V$ (node of a dart)}%


\begin{definition}[interior angle,~$\angle$,~$\Wdart$]\guid{PJRIMCV}
\formaldef{interior angle}{interior\_angle}
\formaldef{$\Wdart$}{cw\_node\_fan}
\formaldef{$\Wdarto$}{w\_node\_fan}
For any  local fan $(V,E,F)$,
write
\[ 
\angle(\v) = \op{azim}((\v,\rho\v)),
\] 
for all $\v\in V$.  This is the \newterm{interior} angle of the
 local fan at $\v$.  Also, write
\[ 
  \Wdarto(F,\v) = \Wdarto((\v,\rho \v)),\quad 
\Wdart(F,\v) =\Wdart((\v,\rho \v)).
\] 
\indy{Notation}{2@$\angle$ (dart angle)}%
\indy{Notation}{Wdart@$\Wdarto(F,\v),~\Wdart(F,\v)$}%
\end{definition}

\begin{definition}[localization]\guid{BIFQATK}
\formaldef{localization}{localization}
\hspace{-3pt}
 Let $(V,E)$ be a fan and let $F$ be
a face of $\op{hyp}(V,E)$.  Let
\begin{align*}
V' &= \{\v\in V \mid \exists~\w\in V.~~(\v,\w)\in F\}.\\
E' &= \{\{\v,\w\} \in E\mid (\v,\w)\in F\}.
\end{align*}
The triple $(V',E',F)$ is called the \newterm{localization} of $(V,E)$ along $F$.
\end{definition}
\indy{Index}{localization}%


\begin{lemma}[localization]\guid{LVDUCXU}\rz{0}%
\oldrating{450}
\formalauthor{Nguyen Quang Troung}
\label{lemma:localization}
Let $(V,E)$ be any fan and let $F$ be a face of its hypermap that is
simple and has cardinality of at least three.  Then the localization
$(V',E',F)$ is a local fan.  Moreover, the angle $\op{azim}(x)$ and
the wedges $\Wdart(x)$ and $\Wdarto(x)$ do not depend on whether they
are computed relative to $\op{hyp}(V,E)$ or to $\op{hyp}(V',E')$ for
all $x\in F$.
%That is, 
%\[ 
%\begin{align}
%\op{azim}(V,E,x) &=\op{azim}(V',E',x)\\
%\Wdarto(V,E,x) &=\Wdarto(V',E',x)\\
%\end{align}
%\] 
\end{lemma}



\begin{proof}
The proof that $(V',E')$ is a fan consists of various simple
verifications based on the techniques of
Remark~\ref{remark:fan-verify}.  The details are left to the reader.

The dart set $D'$ of $\op{hyp}(V',E')$ is naturally identified with
the disjoint union $F\coprod F'$, where $F = \{(\v,\rho\v) \mid \v\in
V\}$ and $F'=\{(\v,\rho^{-1}\v) \mid \v\in V\}$.  Under this
identification, $F$ is a face of $\op{hyp}(V',E')$.  The face, node,
and edge permutations have orders $k$, $2$, and $2$, respectively.  By
Lemma~\ref{lemma:dih-iso}, this bijection extends to an isomorphism of
hypermaps $\op{Dih}_{2k}$ onto $\op{hyp}(V',E')$.

The proof that  $\op{azim}(x)$ and $\Wdarto(x)$ do not depend on the
choice of fan is a consequence of their definitions:
\begin{align*}
\op{azim}(x) &= \op{azim}(\orz,\v,\w,\sigma(\v,\w)),\textand \\
\Wdarto(x) &= \Wdarto(\orz,\v,\w,\sigma(\v,\w)).\\
\end{align*}
where $x = (\v,\w)$.  It is enough to check that $\sigma(\v,\w)\in
E'(\v)$.  But $\{\sigma(\v,\w),\v\}\in F$, so this is indeed the case.
% In particular $\op{azim}(x)\le\pi$ follow by the assumptions of the
% lemma.
\end{proof}

\begin{lemma}[]\guid{RNSYJXM}\cutrate{}\label{lemma:localize-nonreflexive} 
Let $(V,E)$ be any fan and
  let $F$ be a face of its hypermap.  Let $(V',E')$ be the
  localization of $(V,E)$ along $F$.  Assume that $(V,E)$ is fully surrounded.
  Then $(V',E',F)$ is a nonreflexive local fan.
\end{lemma}

\begin{proof}
  Lemma~\ref{lemma:localization} gives all the properties of a
  nonreflexive local fan except for property \case{wedge}: $V'\subset
  \Wdart(x)$ for every dart $x\in F$.  By Lemma~\ref{lemma:face}, $U_F
  \subset \Wdarto(x)$.  The wedge $\Wdart(x)$ is closed and contains
  $\Wdarto(x)$. Hence, the closure $\bar U_F$ is contained in
  $\Wdart(x)$.  Let $\v\in V'$ and choose $\w\in V$ such that
  $y=(\v,\w)\in F$.
  % There is a dart of $F$ of the form $y=(\v,\rho \v)$.  Since $y$
  % leads into
  Since the dart $y$ leads into $U_F$, every neighborhood of $\v$
  meets $U_F$.  Thus, $\v\in \bar U_F\subset \Wdart(x)$.  This
  completes the proof.
\end{proof}


\subsection{geometric type}\label{sec:types}

\begin{definition}[generic,~lunar,~circular]\guid{RTPRRJS}
\formaldef{generic}{is\_generic\_clf}
\formaldef{lunar}{is\_lunar\_clf}
\formaldef{circular}{is\_circular\_clf}
A local fan $(V,E,F)$ is \fullterm{generic}{generic fan}  
if it is nonreflexive and if for every $\{\v,\w\}\in E$
and every $\u\in V$, 
\[ 
C\{\v,\w\}\cap C^0_-\{\u\} = \emptyset.
\] 
A  local fan is \fullterm{circular}{circular fan} if it is nonreflexive and if there
exists $\u\in V$ and $\{\v,\w\}\in E$ such that
\[ 
C^0\{\v,\w\}\cap C^0_-\{\u\}\ne \emptyset.
\] 
A nonreflexive local fan is \fullterm{lunar}{lunar fan} with pole
$\{\v,\w\} \subset V$ if it is nonreflexive, if it is not circular, if $\v\ne\w$, and if
$\{\v,\w\}$ is a parallel set (Figure~\ref{fig:fan-type}).
\end{definition}
\indy{Index}{named property!generic fan}%
\indy{Index}{named property!circular fan}%
\indy{Index}{named property!lunar fan}%

\figQTCGYTB % fig:fan-type


\begin{lemma}[trichotomy]\guid{CIZMRRH}\rz{0}%
\oldrating{200} %
\formalauthor{Nguyen Quang Truong}
Every nonreflexive local fan is either
generic, lunar, or circular.  Moreover, these three properties are
mutually exclusive.
\end{lemma}
\indy{Index}{fan!local}%
\indy{Index}{nonreflexive!local fan}%
\indy{Index}{generic fan}%
\indy{Index}{lunar fan}%
\indy{Index}{circular fan}%

\begin{proof} If $(V,E,F)$ is not generic,  select some $\{\v,\w\}\in E$
and some $\u\in V$ such that
\begin{equation}\label{eqn:nongeneric}
C\{\v,\w\}\cap C^0_-\{\u\} \ne \emptyset.
\end{equation}
Now $C\{\v,\w\} = C^0\{\v,\w\} \cup C\{\v\}\cup C\{\w\}$.  If, for
some such triple $(\u,\v,\w)$, the intersection~\eqref{eqn:nongeneric}
meets $C^0\{\v,\w\}$, then the nonreflexive local fan is circular.
Otherwise, the nonreflexive local fan is lunar.
\end{proof}

\begin{definition}[straight]\guid{YPSTLXA}
\formaldef{straight}{is\_flat}
 Let $(V,E,F)$ be a local fan.
If $\angle(\v)=\pi$, then $\v$ is \fullterm{straight}{straight fan node}.
\end{definition}


\begin{lemma}[]\guid{LDURDPN}\rz{0}%
\oldrating{100}  \label{lemma:coplanar}%
\formalauthor{Nguyen Quang Truong}%
Assume that $\{\orz,\u,\w\}$ and $\{\orz,\u,\v\}$ are not collinear sets.
Then $\op{azim}(\orz,\u,\v,\w)=\pi$ if and only if
there exists a plane $A$ such that $\{\orz,\u,\v,\w\}\subset A$
and such that the line $\op{aff}\{\orz,\u\}$ separates $\v$ from
$\w$ in $A$.
\end{lemma}

\begin{proof} The given azimuth angle is $\pi$ if and only if
  $\dih(\{\orz,\u\},\{\v,\w\})=\pi$.  This holds exactly when
  $\{\orz,\u,\v,\w\}$ is coplanar, and the line $\op{aff}\{\orz,\u\}$
  separates $\v$ from $\w$ in $A$.
\end{proof}

\begin{lemma}[]\guid{KOMWBWC}\rating{0}\label{lemma:kom}
  \formalauthor{Nguyen Quang Truong} \oldrating{400} 
Let $(V,E,F)$ be
  a nonreflexive local fan.  Let $k=\card(F)$.  Assume that for some
  $0<r\le k-1$ and some $\v\in V$, the set $U=\{\v,\rho
  \v,\ldots,\rho^r \v\}$ is contained in a plane $A$ passing through
  $\orz$.  Let $\e$ be the unit normal to $A$ in the direction
  $\v\times \rho \v$.  Then the set $U$ is cyclic with respect to
  $(\orz,\e)$, and the azimuth cycle $\sigma$ on $U$ is
\[ 
  \sigma \u = 
\begin{cases} 
\rho \u, & \u\ne \rho^r\v,\\ \v, & \u = \rho^r\v.
\end{cases}
\] 
Furthermore, for all $0\le i\le r-1$,
\[ 
(\rho^i \v\times\rho^{i+1}\v)\cdot \e > 0.
\] 
\end{lemma}

\begin{proof} 
We write $\v_i = \rho^i \v$ for $i=0,\ldots,r$.

\claim{We claim that $(\v_i \times \v_{i+1})\cdot \e > 0$ for all $i\le r-1$. }
Indeed, the base case $(\v_0\times \v_1)\cdot \e > 0$ of an induction
argument holds by assumption.  Assume for a contradiction that the
inequality holds for $i$, but not for $i+1$.  Then
\[ 
  \op{aff}^0_+(\{\orz,\v_{i+1}\},\v_i) 
= \op{aff}^0_+(\{\orz,\v_{i+1}\},\v_{i+2}).
\]  
This forces $C^0\{\v_i,\v_{i+1}\}$ to meet $C^0\{\v_{i+1},\v_{i+2}\}$,
which is contrary to the definition of a fan.  Thus, the claim holds.

The fact that $U$ is cyclic follows trivially from the fact that $U$
is contained in a plane $A$ through $\orz$ and that $\e$ is orthogonal
to $A$.

\claim{For all $0\le i \le r-1$,  $\sigma \v_i = \v_{i+1}$.}
Otherwise, there is some 
\[ 
  \u \in (U\setminus \{\v_i,\v_{i+1}\}) 
\cap W^0(\orz,\e,\v_i,\v_{i+1}) \cap A.
%  ~~\subset~~ 
\] 
However, by the claim, this intersection is a subset of $C^0\{\v_i,\v_{i+1}\}$, and
$\u\in C^0\{\v_i,\v_{i+1}\}$ is contrary to the property
\case{intersection} of fans.  The result ensues.
% The membership of $\u$ in the rightmost term is contrary to the
% definition of fan.  Let $\e_3$ be the unit vector in the direction
% $\v\times \u$.  Let $\e_1$ be the unit vector in the direction $\u$.
% Let $\e_2 = \e_3 \times \e_1$.  The coordinates of $\u,\v,\w$ with
% respect to the frame $(\e_1,\e_2,\e_3)$ take the form
%\[ 
%\begin{align}
%\v &= \wild  \e_1 + a \e_2,  &\quad & a &< 0\\
%\u &= a' \e_1, &\quad & a' &>0\\
%\w&= \wild  \e_1 + a'' \e_2, &\quad & a'' &>0\\
%\end{align}
%\] 
%From this representation it is clear that $\v\times \u$ points in the
% same direction as $\u\times \w$.  The set $\{\v,\u,\w\}$ is clearly
% cyclic and the counterclockwise cycle $\sigma$ in the
% $\{\e_1,\e_2\}$ plane takes $\v$ to $\u$ and $\u$ to $\w$.
\end{proof}

\begin{lemma}[]\guid{OZQVSFF}\rating{0} \label{lemma:A}  
\formalauthor{Nguyen Quang Truong}
\oldrating{600}
Let $(V,E,F)$ be a nonreflexive local fan and let
  $\u,\v,\w\in V$ satisfy the following conditions.
\begin{enumerate}\wasitemize 
\item $\{\orz,\u,\v,\w\}$ is contained in a plane $A$. \vspace{3pt}
\item $\u,\w\not\in\op{aff}\{\orz,\v\}$. \vspace{3pt}
\item $\op{aff}^0_+(\{\orz,\v\},\u) \ne \op{aff}^0_+(\{\orz,\v\},\w)$.
\end{enumerate}\wasitemize 
Then $\v$ is straight.  Moreover, $\rho \v,\rho^{-1} \v\in A$.
\end{lemma}

\begin{proof} Let $x = (\v,\rho\v)\in F$.  
Order $\u$ and $\w$ so that
\[ 
\op{azim}(\orz,\v,\rho\v,\u) \le \op{azim}(\orz,\v,\rho\v,\w).
\] 
By the definition of nonreflexive local fan, by the conditions $\u,\w\in \Wdart(x)$, 
and by  Lemma~\ref{lemma:coplanar},
%By the assumptions, $\dih(\{\orz,\v\},\{\u,\w\})=\pi$.  Since
%$\u,\w\in \Wdart(x)$, it follows that
%\[ \pi = \dih(\{\orz,\v\},\{\u,\w\}) \le 
%\op{azim}(x) = \angle(\v) \le \pi.\] 
%The first conclusion ensues.
\begin{align*}
%\begin{align}
0 &\le \op{azim}(\orz,\v,\rho\v,\u) \\
&= \op{azim}(\orz,\v,\rho\v,\w) - \op{azim}(\orz,\v,\u,\w)\\
&= \op{azim}(\orz,\v,\rho\v,\w)-\pi \\
&\le \op{azim}(\orz,\v,\rho\v,\rho^{-1}\v) - \pi \\
&=\op{azim}(x) - \pi \\
&=\angle(\v)-\pi\\
&\le 0. 
%\end{align}
\end{align*}
Hence, each inequality is equality.  In particular, $\v$ is straight.
In particular, $0 =\op{azim}(\orz,\v,\rho\v,\u)$, so that 
\[ 
\rho\v\in \op{aff}_+(\{\orz,\v\},\u) \subset A.
\] 
Similarly,
\[ 
\rho^{-1}\v\in \op{aff}_+(\{\orz,\v\},\w) \subset A.
\] 
\end{proof}

If Lemma~\ref{lemma:A} can be applied once to a set of vectors, then
it can often be applied repeatedly along a chain of vectors.  For
example, the conclusion of the lemma implies that $\rho^{-1} \v \in
A$.  In fact, by the definition of fan,
\[ 
  \rho^{-1}\v \in A \setminus \op{aff}\{\orz,\v\} 
= \op{aff}^0_+(\{\orz,\v\},\u) \cup \op{aff}^0_+(\{\orz,\v\},\w).
\] 
Suppose that $\rho^{-1} \v$ lies in the second term of the union.  If
$\w\ne \rho^{-1}\v$, then the assumptions of the lemma are met for
$\{\w,\rho^{-1} \v,\v\}$, giving the conclusions that $\rho^{-1} \v$
is straight and that $\rho^{-2}\v\in A$.  Repeating the argument
on a new set of vectors, we obtain a chain
\[ 
\pi=\angle(\v) = \angle(\rho^{-1} \v) = \cdots,
\] 
with $\v,\rho^{-1}\v,\ldots\in A$.  Another chain $\v,\rho \v,\ldots$
of vectors can be constructed in the other direction.  This process of
chaining gives the following lemma.

\begin{lemma}[circular geometry]\guid{KCHMAMG}\rating{0}
\label{lemma:circular}
\formalauthor{Nguyen Quang Truong}
\oldrating{300}
Let $(V,E,F)$ be a circular fan. Then
\begin{enumerate}\wasitemize 
\item $\v$ is straight for all $\v\in V$.
\item The set $V$ lies in a plane $A$ through $\orz$.
\item For some choice of unit vector $\e$ orthogonal to $A$, the set
$V$ is cyclic with respect to $(\orz,\e)$, and the azimuth cycle on
$V$ coincides with $\rho:V\to V$.  
\item 
$
\op{azim}(\orz,\e,\v,\rho\v) = \dih(\{\orz,\e\},\{\v,\rho\v\})
=\op{arc}_V(\orz,\{\v,\rho \v\}) <\pi
$.
\end{enumerate}\wasitemize 
\end{lemma}

\begin{proof} Let $\v, \u\in V$ be such that $C^0\{\u,\rho \u\}$ meets
$C^0_-\{\v\}$.  Apply Lemma~\ref{lemma:A} to $\{\u,\v,\rho \u\}$ to
conclude that $\v$ is straight, and that some plane $A$ contains
$\{\orz,\u,\rho\u,\v,\rho \v,\rho^{-1} \v\}$.  If
%\[ 
%\{\orz,\u,\rho \u,\v,\rho \v,\rho^{-1} \v\} \subset V\cap A,
%\] 
%and 
$\w\in V\cap A$, then there exists $\w_1,\w_2\in (V\cap
A)\setminus\{\w\}$ for which the assumptions of Lemma~\ref{lemma:A}
hold for $\w_1,\w,\w_2$.  
Then $\w$ is straight, and $\rho \w \in V\cap A$.  The set $V\cap
A$ is therefore preserved by $\rho$.  By observing that $V$ is the
only nonempty subset of $V$ that is preserved by $\rho$, it follows
that $V\subset A$ and that $\w$ is straight for all $\w\in V$.


By Lemma~\ref{lemma:kom}, $V$ is cyclic with respect to a unit
vector $\e$ orthogonal to $A$.  The azimuth cycle on $V$ is $\v
\mapsto \rho \v$.

We turn to the final conclusion.  By the final conclusion of
Lemma~\ref{lemma:kom} and Lemma~\ref{lemma:sim}, the azimuth angle is
less than $\pi$.  Under this constraint, the azimuth angle equals the
dihedral angle by Lemma~\ref{lemma:dih-azim}.  By definition, the
dihedral angle is the angle $\arc_V(\orz,\wild )$ of an orthogonal
projection of $\{\v,\rho\v\}$ to a plane with normal $\e$.  But
$\{\v,\rho\v\}$ is already a subset of the plane $A$, so that the
projection is the identity map, and the dihedral angle is
$\arc_V(\orz,\{\v,\rho\v\})$.
%
%\[ 
%%  \op{azim}(\orz,\e,\v,\rho\v) = \dih(\{\orz,\e\},\{\v,\rho\v\}) =
%%  \op{arc}_V(\orz,\{\v,\rho\v\}),
%\] 
%because the azimuth angle is less than $\pi$ and
%the dihedral angle is defined as the angle obtained by orthogonal projection
%to the plane $A$.  Since the points $\v,\rho\in A$, orthogonal projection has no effect.
\end{proof}

\begin{lemma}[lunar geometry]\guid{HKIRPEP}\rating{0}
\formalauthor{Nguyen Quang Truong}
\oldrating{300}\label{lemma:lunar}
Let $(V,E,F)$ be a lunar fan with pole $\{\v,\w\}\subset V$.  
%Assume that $\rho^r \v = \w$ for some $0< r < k$.
Then
\begin{enumerate}\wasitemize 
\item $\u$ is straight for all $\u\in V\setminus \{\v,\w\}$. \vspace{3pt}
\item $0< \angle(\v) = \angle(\w)\le \pi$. \vspace{3pt}
\item $V\cap \op{aff}_+(\{\orz,\v\},\rho \v) = \{\v,\rho \v,\ldots,
\w\}$. \vspace{3pt}
\item $V \cap \op{aff}_+(\{\orz,\v\},\rho^{-1} \v) = \{\w,\rho
\w,\ldots \v\}$. \vspace{3pt}
\end{enumerate}\wasitemize 
\end{lemma}

\begin{proof} Set $V_1 = \{\v,\rho \v,\ldots,\w\}$ and $V_2 =
\{\w,\rho \w,\ldots,\v\}$.  Let $\u\in V\setminus\{\v,\w\}$ be
arbitrary.  Apply Lemma~\ref{lemma:A} to the set $\{\v,\u,\w\}$ to
find that $\u$ is straight and that $\{\orz,\u,\rho \u,\rho^{-1} \u\}$
belongs to a plane $A(\u)$.  Now $A(\u)$ and $A(\rho \u)$ are both
the unique plane containing $\{\orz,\u,\rho \u\}$; hence, $A(\u) =
A(\rho \u)$ when $\rho \u\not\in \{\v,\w\}$.  By induction, there
are planes $A_1, A_2$ such that $V_i\subset A_i$.  There is an
azimuth cycle $\sigma_i$ on $V_i$ such that $\sigma_i \u = \rho \u$,
when $\u \in A_i\setminus \{\v,\w\}$.

The angles $\angle(\v)$ and $\angle(\w)$ are both equal to the
dihedral angle between the half-planes
$\op{aff}_+(\{\orz,\v\},\rho^{\pm}\v)$.  In particular,
$0<\angle(\v)=\angle(\w)\le\pi$.
\end{proof}




\begin{lemma}[monotonicity]\guid{EGHNAVX}\rating{650} 
\label{lemma:monotone}
Let $(V,E,F)$ be a nonreflexive local fan and let $k$ be the cardinality
of $F$.  Fix $\v_0\in V$.  Assume that
$\{\orz,\v_0,\u\}$ is not collinear for any $\u\in
V\setminus\{\v_0\}$.  For all $i$, set $\v_i = \rho^i \v_0$ and
$\beta(i) = \op{azim}(\orz,\v_0,\v_1,\v_i)$.  Then
\[ 0=\beta(1)\le \beta(2)\le \cdots\le
\beta(k-1)\le\pi.\] 
(See Figure~\ref{fig:bk-mono}.)
Moreover, if $\beta(i)=0$ for some $1<i \le k-1$, then
\[ 
\angle(\v_1) = \cdots = \angle(\v_{i-1}) = \pi,
\] 
and $\{\v_1,\ldots,\v_i\} \subset \op{aff}^0_+(\{\orz,\v_0\},\v_1)$.
Finally, if $\beta(i)=\beta(k-1)$ for some $1\le i<k-1$, then 
\[ 
\angle(\v_{i+1}) = \cdots = \angle(\v_{k-1}) = \pi,
\textand  \{\v_i,\ldots,\v_{k-1}\} \subset
\op{aff}^0_+(\{\orz,\v_0\},\v_{k-1}).
\]
\end{lemma}

\figQTICQYN % fig:bk-mono

\begin{proof}  
  With respect to a frame, the points $\v_j$ can be represented in
  spherical coordinates $(r_j,\theta_j,\phi_j)$.  In an appropriate
  frame, $\phi_0=0$ and $\theta_j=\beta(j)$ for all $j$.  From
  $\v_j\in \Wdart(F,\v_0)$ and $\angle(\v_0)\le\pi$, it follows that
  $0\le\theta_j\le\theta_{k-1}\le\pi$ when $0\le j\le k-1$.

One may assume the induction hypothesis that $0\le \beta(1)\le\cdots\le
\beta(i)$.  The condition
\[ 
\v_0\in \Wdart(F,\v_i)
\] 
implies that
\[ 
  0 \le \op{azim}(\orz,\v_i,\v_{i+1},\v_0)
\le \op{azim}(\orz,\v_i,\v_{i+1},\v_{i-1})\le\pi.
\] 
By Lemma~\ref{lemma:sim}, the resulting inequality
\[ 
\sin(\op{azim}(\orz,\v_i,\v_{i+1},\v_0))\ge 0
\] 
reduces to a triple-product:
\[ 
(\v_0 \times \v_i)\cdot \v_{i+1}\ge 0.
\] 
In spherical coordinates, this inequality becomes
\begin{equation}\label{eqn:triple-product}
r_0r_ir_{i+1}\sin\phi_i\sin\phi_{i+1}\sin(\theta_{i+1}-\theta_i)\ge0.
\end{equation}
Under the noncollinearity assumption, $\sin\phi_i\sin\phi_{i+1}\ne0$
(when $0< i < k-1$).  Once we deal with the degenerate
case $\theta_{i+1}=0,\theta_i=\pi$, these inequalities give
$\theta_i\le \theta_{i+1}$, and the result follows by induction.

Turn to the degenerate case $\theta_{i+1}=0,\theta_i=\pi$.  In this
case, the set $\{\orz,\v_0,\v_i,\v_{i+1}\}$ is coplanar.  Let
$C^0_+=C^0_+\{\v_i,\v_{i+1}\}$.  The values of the angles $\theta_i$ and
$\theta_{i+1}$ imply that $C^0_+$ meets the line
$\op{aff}\{\orz,\v_0\}$. In particular, $\epsilon \v_0\in C^0_+$ for
some choice of sign $\epsilon\in\{\pm 1\}$.  The definition of a fan
implies $\v_0\not\in C^0_+$. Hence $-\v_0\in C^0_+$.  By the
definition of a circular fan, $(V,E,F)$ is circular.  The lemma
follows in this case from the explicit description of circular fans in
Lemma~\ref{lemma:circular}.  This completes the proof of the first
statement of the lemma.

Assume that $\beta(i)=\theta_i=0$ for some $1<i\le k-1$.  Then by the first
conclusion, $\beta(j)=0$ for $0\le j\le i$.  That is, 
$\v_1,\ldots,\v_i$ all lie in the half-plane
$\op{aff}^0_+(\{\orz,\v_0\},\v_1)$.  In particular, they are coplanar.
A chaining argument based on Lemma~\ref{lemma:A} gives the result.

The final conclusion follows by a similar chaining argument.
\end{proof}


\section{Modification}

\subsection{deformation}\label{sec:deformation}


This subsection develop a theory of deformations of a nonreflexive local fan
$(V,E,F)$, including sufficient conditions for the deformation of a
nonreflexive local fan to remain a nonreflexive local fan.


\begin{definition}[deformation]\guid{YWNHMBP}
\formaldef{deformation}{is\_deformation\_clf}
A \newterm{deformation} 
of a nonreflexive local fan $(V,E,F)$ over an interval
$I\subset\ring{R}$ is a function $\varphi:V\times I
\to\ring{R}^3$ with the following properties.
\begin{enumerate}
\item  $\varphi(v,\wild):I\to\ring{R}^3$ is continuous
for each $v\in V$,
\item  $0\in I$, and 
\item   $\varphi(\v,0)=\v$ for all $\v\in V$.  
\end{enumerate}
\end{definition}
\indy{Notation}{I@$I$ (real interval)}%
\indy{Index}{deformation}%
\indy{Index}{fan!local}%

\begin{notation}
  Beware of the notational distinction between the zenith angle $\phi$
  and the deformation $\varphi$.  When a deformation $\varphi$ is
  given, write $\v(t)$ as an abbreviation of $\varphi(\v,t)$ for
  $t\in I$.  Also, set
\begin{align*}
V(t)&=\{\v(t) \mid \v\in V\},\\
E(t)&=\{\{\v(t),\w(t)\}\mid \{\v,\w\}\in E\},\\
F(t)&= \{(\v(t),\w(t)) \mid  (\v,\w)\in F\}.
\end{align*}
\indy{Notation}{v8@$\v(t)$ (deformation of $\v$)}%
\end{notation}

A deformation does not require $(V(t),E(t),F(t))$ to be a nonreflexive local fan
for all $t\in I$, although this is often  the case. The
permutation $\rho:V\to V$ gives $\varphi(\rho \v,t)\in V(t)$ for
every $\v\in V$.



The following 
three lemmas give conditions ensuring that  properties of fans are
preserved under deformation.


\begin{lemma}[local deformation]\guid{XRECQNS}\rating{400}\label{lemma:fan-open}
  Let $(\varphi,V,I)$ be a deformation of a  local fan
  $(V,E,F)$ over an interval $I$. 
Then $(V(t),E(t),F(t))$ is a
local fan for all sufficiently small $t\in I$.
\end{lemma}

%% XX May need version that moves several, or moves a pole.  Proof should be similar to generic case.
\begin{lemma}[lunar deformation]\guid{MHAEYJN}\rating{700}\label{lemma:fan-open-lunar}
% The rating is for lunar and generic combined.
  Let $(\varphi,V,I)$ be a deformation of a lunar fan $(V,E,F)$ with pole $\{\v,\w\}$
  over
  an interval $I$.  Assume that $\angle(\w)<\pi$.
  Suppose that there is an index $i$ such that
  $\v_i$ is straight and such that $\v_j$ remains fixed for $j\ne i$.
  Suppose that $\v_i(t)$ remains in the plane through
  $\{\orz,\v,\w,\v_i\}$.  Then $(V(t),E(t),F(t))$
 is a lunar fan for
  all sufficiently small $t\in I$.
\end{lemma}

\begin{lemma}[generic deformation]\guid{ZLZTHIC}\label{lemma:fan-open-generic}
Let $(\varphi,V,I)$ be a deformation of a generic local fan
  $(V,E,F)$ over an interval $I$.  
Assume that the azimuth angle of $\v_i(t)$ is at most
$\pi$ for all sufficiently small $t\in I$, whenever $\v_i$ is straight.  Then 
 $(V(t),E(t),F(t))$ is a
generic local fan for all sufficiently small $t\in I$.
\end{lemma}

\begin{proof}[Proof \eqref{lemma:fan-open}] 
We examine in turn each of the defining properties of a local fan.

\case{cardinality} The set $V(t)$ is the image of $V$ and is
therefore finite and nonempty.

\case{origin} Since $\varphi$ is continuous and
$\orz\not\in V$, it follows that $\orz\not\in V(t)$ for sufficiently
small $t$.

\case{nonparallel} If $\v,\w$ are nonparallel, then $\v(t)$ and
$\w(t)$ are nonparallel for sufficiently small $t$.

\case{intersection} If $\ee \cap \ee'=\emptyset$, then $C(\ee)\cap
S^2$ has a positive distance from $C(\ee')\cap S^2$, where $S^2$ is a unit sphere.  
Hence, for
sufficiently small times, the deformation of these sets remain
disjoint.  If $\ee=\{\u,\v\}$ and $\ee'=\{\v,\w\}$, where $\u\ne\w$,
then again the deformation of $C(\ee)\cap C(\ee')$ is
$C(\{\v(t)\})$ for sufficiently small $t$.  The other cases are
similar.
\indy{Notation}{S@$S^2(r)$ (sphere of radius $r$)}%

\case{face},~\case{dihedral} The azimuth cycle on $E(\v(t))$
is preserved; hence, the combinatorial properties of the hypermap do
not change when $t$ is sufficiently small.
\end{proof}

\begin{proof}[proof \eqref{lemma:fan-open-lunar}~\eqref{lemma:fan-open-generic}] 
  The proofs of these two lemmas may be combined.  The main part of
  the proof shows that the local fans obtained by deformation are
  nonreflexive.  From there, the proof is completed in two cases as
  follows.

  \case{lunar} By assumption, the poles $\{\v,\w\}$ of the lunar fan are not straight.
  The poles
  remain fixed poles under the deformation and remain unstraightened.  This
  shows that the deformation of a lunar fan is lunar.

  \case{generic} Genericity is stated as a finite collection of
open conditions $\v\not\in
  C\{\u,\w\}$.  These conditions continue to hold for sufficiently
  small $t$.

Now we return to the proof of nonreflexivity (page~\pageref{def:convex-local}).

\case{angle} If $\op{azim}(x)<\pi$, then the inequality remains
strict for sufficiently small $t$.  If $\op{azim}(x)=\pi$, then the
straightness assumptions of the lemmas give the inequality 
$\op{azim}(x)\le\pi$ for all sufficiently small $t$.

\case{wedge} We consider two cases, depending on the type of
the local fan.

%If the fan $(V,E,F)$ is circular, then some plane $A$ through
%the origin  contains $V$.  By the straightness condition, the
%deformation maintains a coplanarity condition $V(t)\subset A(t)$.  The
%sets $\Wdart(x(t))$ are half-spaces bounded by $A(t)$.  Thus,
%$V(t)\subset A(t)\subset \Wdart(x(t))$, as desired.

If the fan $(V,E,F)$ is lunar with pole $\{\v,\w\}$, the assumptions
of the lemma make $\Wdart(x(t))$ independent of $t$ for every dart $x$
of $F$.  Then $\v_i(t)$ (for the special index $i$ that appears in the
statement of the lemma) remains in the half-plane
$\aff_+^0(\{\v,\w\},\v_i)$, which is a subset of $\Wdart(x)$,
for every $x\in F$.  The result ensues.

Finally consider a generic fan $(V,E,F)$.  For simplicity, write
$\Wdart(\u)$ for $\Wdart(x)$, where $x=(\u,\rho\u)\in F$.  The
property $\v\in \Wdarto(x)$ is an open condition.  It holds for
sufficiently small $t$.  The proof then reduces to the case
$\v\in \Wdart(\u)\setminus \Wdarto(\u)$, for some $\u,\v\in V$.  By
Lemma~\ref{lemma:monotone}, $\u$ and $\v$ can be connected by a
sequence
\[
\rho\u, \rho^2\u,\ldots \rho^r\u\quad\text{ or }\quad 
\rho\v, \rho^2\v,\ldots,\rho^r\v,
\]
where all intermediate terms are straight.

Thus, it suffices to prove the following statement by an induction on
$r$: for all $\v,\w\in V$, we have $\v(t)\in \Wdart(\w(t))$ and
$\w(t)\in \Wdart(\v(t))$, where $\w=\rho^r\v$, provided $\rho^i\v$ is
straight for all $0<i<r$.  If $r=1$, the statement is a triviality because
the azimuth angle spanned by $\Wdart(\v(t))$ is defined by the azimuth
angle of $(\orz,\v(t),\rho\v(t),\rho^{-1}\v(t))$.

Now assume the induction hypothesis holds for all numbers less than
$r$.  Fix $\v$ and write $\v_i = \rho^i \v$.  We show that $\v_r\in
\Wdart(\v_0)$, leaving the symmetrical claim $\v_0\in \Wdart(\v_r)$ to
the reader.  We return to the coordinate representation that was used
in the proof of Lemma~\ref{lemma:monotone}, which applies to generic
fans.  With respect to a frame, the points $\v_j$ can be represented
in spherical coordinates $(r_j,\theta_j,\phi_j)$.  In an appropriate
frame, $\phi_0=0$ and $\theta_j=\beta(j)$ for all $j$.

From the  induction hypothesis $\v_0(t)\in \Wdart(\v_{r-1}(t))$
and the assumption $\op{azim}(x(t))\le\pi$ of the lemma, we find
\[
0\le \op{azim}(\orz,\v_{r-1}(t),\v_r(t),\v_0(t))\le
\op{azim}(\orz,\v_{r-1}(t),\v_r(t),\v_{r-2}(t))\le \pi.
\]
By relation \eqref{eqn:triple-product}, this gives
\begin{equation}\label{eqn:theta}
\sin(\theta_r(t)-\theta_{r-1}(t))\ge 0.
\end{equation}
When $t=0$, we have $\theta_j(0)=\beta(j)=0$, for $j=1,\ldots,r$.  By
continuity, when $t$ is sufficiently small,
$\theta_r(t)-\theta_{r-1}(t)$ is near zero, so that \eqref{eqn:theta}
gives $\theta_r(t)\ge \theta_{r-1}(t)$.  The induction hypothesis
$\v_{r-1}(t)\in \Wdart(\v_0(t))$ gives $\theta_{r-1}(t)\ge0$.  Hence
$\theta_r(t)\ge0$.

The inequality $\theta_r(t) < \theta_{k-1}(t)$ holds at $t=0$ and by continuity
for small $t$.  We obtain
\[
0 \le \theta_r(t) \le \theta_{k-1}(t).
\]
This is precisely the desired relation $\v_r(t)\in \Wdart(\v_0(t))$,
expressed in spherical coordinates.
\end{proof}


%%%%%%%%%%%

\subsection{slicing}
%\subsection{internal blades}




This subsection shows that a nonreflexive local fan can be sliced
along a internal blade to divide it into two nonreflexive local fans.

\begin{lemma}[]\guid{PGSQVBL}\oldrating{80}\rating{0}
\formalauthor{Nguyen Quang Truong} 
Let $(V,E,F)$ be a nonreflexive local fan.
If $\v,\w\in V$ are nonparallel, then $C\{\v,\w\} \subset
\Wdart(x)$ for any dart $x\in F$.
\end{lemma}
\indy{Index}{fan!local}%

\begin{proof} This is an elementary consequence of
the cone shape of $\Wdart(x)$,  the condition that $V\subset
\Wdart(x)$, and definitions.
\end{proof}






\begin{definition}[slice]\guid{CNAQAAA}
 Let $(V,E,F)$ be a nonreflexive local fan.  Assume that
$\v,\w\in V$ are nonparallel and that $(V,E')=(V,E\cup
\{\{\v,\w\}\})$ is a fan.  Let $F'$ be the face of $\op{hyp}(V,E')$
containing the dart $(\w,\v)$.  Write
\[ (V[\v,\w],E[\v,\w],F[\v,\w])\] 
for the localization of $(V,E')$ along $F'$, where
\begin{align*}
  V[\v,\w] &= \{\v,\rho \v,\rho^2 \v,\ldots,\w\},\\
  E[\v,\w] &= \{\{\v,\rho \v\},\ldots,\{\rho^{-1}\w,\w\},\{\w,\v\}\},\\
  F[\v,\w] &= \{(\v,\rho \v),(\rho \v,\rho^2 \v),
 \ldots,(\rho^{-1}\w,\w),(\w,\v)\}.
\end{align*}
The triple $(V[\v,\w],E[\v,\w],F[\v,\w])$ is called the
\fullterm{slice\/}{slice!fan} of $(V,E,F)$ along $(\v,\w)$.
See Figure~\ref{fig:fan-slice}.
\end{definition}
\indy{Index}{fan!local}%
\indy{Notation}{1@$\wild[\v,\w]$ (slicing a fan)}%

\figSXYGYPC % fig:fan-slice

To allow contexts with more than one nonreflexive local fan $(V,E,F)$, we  extend
the notation, writing $\angle(H,\v)$ for $\angle(\v)$ in the hypermap
$H$.  Similarly, we write $\Wdarto(H,\v)$ for $\Wdarto(x)$ and so
forth.  \indy{Notation}{azimhv@$\op{azim}(H,\v)$}%
%\indy{Notation}{wdart@$\Wdarto$}%
\indy{Notation}{Wdart@$\Wdarto$ (wedge)}%
\indy{Notation}{2@$\angle$ (dart angle)}%

% XX revised May 15, 2012.
% parallel condition relaxed.

\begin{lemma}[slicing]\guid{EJRCFJD}\rating{400}\label{lemma:slice} Let
$(V,E,F)$ be a nonreflexive local fan with hypermap $H$.  Select $\v,\w\in V$
such that
%For
%each $\u\in \{\v,\w\}$, assume that $\u$ is not parallel with  any
%element of $V\setminus\{\u\}$.  
 $\v$ is not parallel with $\w$.
Assume that $C^0\{\v,\w\}\subset
\Wdarto(x)$ for all darts $x\in F$.  Then
\begin{enumerate}\wasitemize 
\item $(V[\v,\w],E[\v,\w],F[\v,\w])$ and
$(V[\w,\v],E[\w,\v],F[\w,\v])$ are nonreflexive local fans.
\item Let $H[\v,\w]$ and $H[\w,\v]$ be the hypermaps of these two
  nonreflexive local fans, respectively.  Let $g:V\to\ring{R}$ be any
  function.  Then
\[ 
  \sum_{\v\in V} g(\v)\angle(H,\v) 
  = \sum_{\v\in V[\v,\w]}g(\v)\angle(H[\v,\w],\v) 
  + \sum_{\v\in V[\w,\v]}g(\v)\angle(H[\w,\v],\v).
\] 
\end{enumerate}\wasitemize 
\end{lemma}
\indy{Index}{slice!fan}%
\indy{Index}{fan!local}%

\begin{proof} 
\claim{For
each $\u\in \{\v,\w\}$, the node $\u$ is not parallel with  any
element of $V\setminus\{\u\}$.}  Otherwise, say that $\u$ and $\v$
are parallel.  Then the fan is circular or lunar with pole $\{\u,\v\}$.
By Lemmas~\ref{lemma:circular} and~\ref{lemma:lunar},
\[
\w\in \op{aff}_+(\{\orz,\v\},\rho\v)\cup \op{aff}_+(\{\orz,\v\},\rho^{-1}\v).
\]
This gives $C^0\{\v,\w\}\not\subset \Wdarto(x)$, where $x$ is the dart
of $F$ at $\v$.  This contradicts an assumption.

\claim{$(V,E')$ is a fan, where $E' = E\cup \{\{\v,\w\}\}$.}
Indeed, except for the intersection property, all of the properties
of a fan follow trivially from the fact that $(V,E)$ is a fan and
that $\v$ and $\w$ are nonparallel.  (Note the similarity with
Lemma~\ref{lemma:add-edge}.)  The intersection property also is
trivial except in the case $\ee=\{\v,\w\}$ and $\ee'\setminus \ee\ne
\emptyset$.  Select $\u\in \ee'\setminus\ee$.  It follows from the
node partition of Lemma~\ref{lemma:disjoint} that
\begin{align*}
C(\ee) \cap C(\ee') &= (C(\v) \cap C(\ee')) \cup (C(\w)\cap C(\ee')) \\
&= C(\{\v\}\cap \ee') \cup C(\{\w\}\cap \ee') \\
&= C(\{\v,\w\}\cap \ee').
\end{align*}
The intersection property thus holds and $(V,E')$ is a fan.

It follows by Lemma~\ref{lemma:localization} that
$(V[\v,\w],E[\v,\w],F[\v,\w])$ is a local fan.

The second conclusion of the lemma follows from the following identities.
If $\u\ne \v,\w$ with $\u\in V[\v,\w]$, then $\u\not\in V[\w,\v]$ and 
\begin{equation}
\Wdarto(H,\u)=\Wdarto(H[\v,\w],\u),\quad \angle(H,\u) = \angle(H[\v,\w],\u).
\end{equation}
If $\u\in\{\v,\w\}$, then 
$\angle(H,\u)=\angle(H[\v,\w],\u) +\angle(H[\w,\v],\u)$.

Finally, it remains to be shown that the local fan is nonreflexive.
%Lemma~\ref{lemma:localization} already shows that the hypermap is
%isomorphic to $\op{Dih}_{2k}$. and that $F[\v,\w]$ can be identified with a
%face.  
The conclusion $V[\v,\w]\subset \Wdart(x)$ follows from the
fact that the angles $\beta(i)$ are increasing in
Lemma~\ref{lemma:monotone}.
\end{proof}

\begin{definition}\guid{CFAYDJM}  When $(V,E,F)$ is a local fan, set
\[
\sol(V,E,F) =  2\pi + \sum_{x\in F}(\op{azim}(x)-\pi) = 2\pi + \sum_{\v\in V} (\angle(\v) -\pi).
\]
\end{definition}
\indy{Notation}{solVEF@$\sol(V,E,F)$ (formal solid angle)}%

When $\card(V)=3$, this definition reduces to Girard's formula for the
solid angle of a triangle.  For conforming fans, the definition
reduces to the \case{solid angle} formula of $U_F$ for conforming fans
(page~\pageref{def:conforming}).  However, we cannot apply the results
from Chapter~\ref{sec:fan} directly, because a local fan is not
conforming: $(V,E)$ is not fully surrounded. Instead, we rely on the
following lemma.


\begin{lemma}\guid{NKEZBFC}\label{lemma:sol-local}
Let $(V,E,F)$ be a generic nonreflexive local fan.  Then
\[
\sol(V,E,F) \ge 0.  % \sol(\cap_{x\in F} \Wdarto(x)).
\]
%In particular, it is nonnegative.
\end{lemma}

\begin{proof} 
  We argue by complete induction on $k=\card(V)$.  The base case of
  the induction is $k=3$.  In this case, the formula reduces to
  Girard's formula (Lemma~\ref{lemma:prim-volume}) for the solid angle
  of the triangle $\op{aff}_+^0(\orz,V)$, which is certainly
  nonnegative.

  When $k\ge4$, if we can find distinct $\v,\w\in V$ such that
  $C^0\{\v,\w\}\subset \Wdarto(x)$, then we may apply
  Lemma~\ref{lemma:slice} and use the induction hypothesis to write
  $\sol(V,E,F)$ as the sum of two nonnegative terms, to obtain the
  lemma.  We may therefore assume that for all $\v,\w\in V$,
  $C^0\{\v,\w\}\not\subset \Wdarto(x)$.

\claim{We may assume that some $\v\in V$ is not straight.}  Otherwise,
it follows trivially from definitions that $\sol(V,E,F)=2\pi>0$.

Select any $\v\in V$ that is not straight, and write $\v_i = \rho^i\v$.  By
Lemma~\ref{lemma:monotone} and the assumptions, it follows that there
is some $i\mid 1 \le i \le k-2$ such that $\v_j$ is straight, for all
$j\ne 0,i,i+1$.  In particular, there are at most three unstraightened 
elements of $V$.  By Girard's formula, the value of $\sol(V,E,F)$ is
equal to the solid angle of
\[
\op{aff}_+^0(\orz,\{\v_0,\v_i,\v_{i+1}\}),
\]
which is nonnegative.
\end{proof}



\section{Polarity}


\subsection{construction}

This section constructs a polar fan $(V',E',F')$ from a local fan $(V,E,F)$.

\begin{definition}[polar]\guid{JNVXCRC}
  Let $(V,E,F)$ be a local fan, with permutation
  $\rho=\rho_{V,E,F}:V\to V$.  Define a map $('): V \to \ring{R}^3$ by
  $\v\mapsto\v' = \v\times\rho\v$.  Set
\begin{align*}
V' & = \{\v' \mid \v\in V\}\\
E' & = \{\{\v',(\rho\v)'\}\mid \v\in V\}\\
F' &=\{ (\v',(\rho\v)') \mid \v\in V\}.
\end{align*}
The triple $(V',E',F')$ is called the \fullterm{polar}{polar!fan} of $(V,E,F)$.
See Figure~\ref{fig:polar}.
\end{definition}
\indy{Notation}{4@$\wild'$ (polar local fan $(V',E',F')$)}%
\indy{Notation}{V@$V'$ (polar node set)}%
\indy{Notation}{E2a@$E'$ (polar edge set)}%
\indy{Notation}{F@$F'$ (polar face)}%

\figHEABLRG % fig:polar

The properties of the polar are established in the
following lemma.

\begin{lemma}\label{lemma:polar-fan}\guid{BGMIFTE}
  Let $(V,E,F)$ be a generic nonreflexive local fan. 
Assume that $\angle(\v)<\pi$ for every $\v\in V$.  Then $(V',E',F')$ is
a generic nonreflexive local fan satisfying $\op{card}(V')=\op{card}(V)$.
Moreover, for every $\v\in V$,
\begin{align*}
\arc_V(\orz,\{\v',(\rho\v)'\}) 
&= \pi - \angle(\rho\v) \in \leftopen 0,\pi\rightopen,\\
\arc_V(\orz,\{\v,\rho\v\}) 
&= \pi - \angle'(\v')\in\leftopen 0,\pi\rightopen,
\end{align*}
where $\angle'$ is the azimuth angle function on the nodes of the
polar fan $(V',E',F')$.
\end{lemma}


\begin{proof}
Fix $\v\in V$ and write $\v_i = \rho^i \v$ and $\w_i = \v_i
  \times \v_{i+1}$.  In a generic fan, $\{\orz,\v_i,\rho\v_i\}$
 is not collinear.  By Lemma~\ref{lemma:cross-collinear}, $\w_i\ne\orz$.

  The proof makes repeated use of the cross product identities of
  Lemmas~\ref{lemma:cross-id} and ~\ref{lemma:sim}, without further
  mention.  Recall that $(\sim)$ is the equivalence relation on
  $\ring{R}$ given by $x\sim y$ when there exists $t>0$ such that $x =
  t y$.  Abbreviate $(\u\times \v)\cdot \w$ to $[\u,\v,\w]$.
\indy{Notation}{9a@$\sim$ (equal up to positive scalar)}%

The sign of
  $\sin(\op{azim}(\orz,\w_i,\w_{i+1},\w_j))$, when $j\ne i,i+1$, is determined
by a calculation:
\begin{align*}
\sin(\op{azim}(\orz,\w_i,\w_{i+1},\w_j)) &\sim (\w_i \times \w_{i+1})\cdot \w_j\\
&= ((\v_i\times \v_{i+1})\times (\v_{i+1}\times \v_{i+2}))\cdot \w_j\\
&= (\v_{i+1} [\v_{i},\v_{i+1},\v_{i+2}])\cdot (\v_j\times \v_{j+1})\\
&= [\v_i,\v_{i+1},\v_{i+2}][\v_j,\v_{j+1},\v_{i+1}]\\
&\sim \sin(\op{azim}(\orz,\v_{i+1},\v_{i+2},\v_i)) 
   \sin(\op{azim}(\orz,\v_j,\v_{j+1},\v_{i+1}))\\
&\sim \sin\angle(\v_{i+1}) \sin(\op{azim}(\orz,\v_j,\v_{j+1},\v_{i+1}))\\
&\sim \sin(\op{azim}(\orz,\v_j,\v_{j+1},\v_{i+1})).
\end{align*}
By Lemma~\ref{lemma:monotone}, this final term is positive.  We
conclude by Lemma~\ref{lemma:dih-azim} that 
\[
0<\op{azim}(\orz,\w_i,\w_{i+1},\w_j) = \dih_V(\{\orz,\w_{i}\},\{\w_{i+1},\w_j\}) < \pi.
\]  
When $j\ne i-1,i$, we have similar inequalities in which $i$ is
replaced with $i-1$. This implies that
\begin{equation}\label{eqn:wj}
\w_j\in W^0(\orz,\w_{i},\w_{i+1},\w_{i-1}),\quad j\ne i-1, i, i+1.
\end{equation}

{\it We claim that }
\begin{equation}\label{eqn:colw}
\{\orz,\w_i,\w_j\} \text{ is not collinear, when } i\ne j.
\end{equation}  
Indeed, by Lemma~\ref{lemma:cross-collinear}, it is enough to show that
$\w_i\times \w_j\ne\orz$.  We compute
\[
\w_i \times \w_j = (\v_i\times\v_{i+1})\times (\v_j \times \v_{j+1})
  = [\v_i,\v_j,\v_{j+1}] \v_{i+1} - [\v_{i+1},\v_j,\v_{j+1}] \v_i.
\]
The coefficients $[\v_i,\v_j,\v_{j+1}]$ and $[\v_{i+1},\v_j,\v_{j+1}] $ are
nonzero by the preceding calculations.  If $\w_i\times \w_j=\orz$, then
$\{\orz,\v_i,\v_{i+1}\}$ is collinear.  This contradicts the defining properties
of the fan $(V,E,F)$.  This establishes the claim.

The calculation of $\arc_V(\orz,\{\w_i,\w_{i+1}\})$ relies on
 Lemma~\ref{lemma:dih-cross}:
\begin{align*}
\arc_V(\orz,\{\w_i,\w_{i+1}\}) 
&= \arc_V(\orz,\{\v_i\times\v_{i+1},\v_{i+1}\times \v_{i+2}\}) \\
&=\pi - \arc_v(\orz,\{\v_{i+1}\times\v_i,\v_{i+1}\times\v_{i+2}\})\\
&=\pi - \dih_V(\{\orz,\v_{i+1}\},\{\v_i,\v_{i+1}\})\\
&=\pi - \angle(\v_{i+1}).
\end{align*}

The calculation of $\angle'(\w_{i+1})$ also relies on Lemma~\ref{lemma:dih-cross}:
\begin{align*}
\angle'(\w_{i+1}) 
&= \dih_V(\{\orz,\w_{i+1}\},\{\w_i,\w_{i+2}\}) \\
&= \arc_V (\orz,\{\w_{i+1}\times \w_{i},\w_{i+1}\times \w_{i+2}\})\\
&=\arc_V(\orz,\{ (\v_{i+1}\times \v_{i+2}) \times (\v_i\times \v_{i+1}),
   (\v_{i+1}\times \v_{i+2}) \times (\v_{i+2}\times \v_{i+3}) \})\\
&= \arc_V(\orz,\{ - \v_{i+1} [\v_i,\v_{i+1},\v_{i+2}], 
   \v_{i+2} [\v_{i+1},\v_{i+2},\v_{i+3}]\})\\
&=\arc_V(\orz,\{-\v_{i+1},\v_{i+2}\})\\
&=\pi -\arc_V(\orz,\{\v_{i+1},\v_{i+2}\}).
\end{align*}

It is a routine verification to check that $(V',E',F')$ is a local
fan.  The verification uses the calculations \eqref{eqn:wj} and
\eqref{eqn:colw} to give the separation properties \case{origin},
\case{nonparallel}, and \case{intersection} in the definition of fan.
This fan cannot be lunar, because \eqref{eqn:wj} precludes poles.
It cannot be circular because the azimuth angles $\angle'(\v')$
are less than $\pi$.  It must be generic.
We leave the remaining verifications  to the reader.
\end{proof}
\indy{Notation}{1@$[\u,\v,\w] = (\u\times\v)\cdot \w$}%


\subsection{perimeter}

The perimeter bound of $2\pi$ for convex spherical polygons is
classical~\cite[p.~100]{vanderWaerden:1951}.   This
section proves the bound $2\pi$ on the perimeter of a nonreflexive
local fan (Lemma~\ref{lemma:convex-hyp}).  A great circle has
perimeter $2\pi$.  The proof shows that the perimeter of the
fan is related to the solid angle of the polar fan by duality.
The upper bound on the perimeter is equivalent to the nonnegativity
of the solid angle of the polar.

%\subsection{perimeter}

\begin{definition}[perimeter]\guid{IQCPCGW}\label{lemma:perim}
Let $(V,E,F)$ be a nonreflexive local fan.    Set
\[ 
  \op{per}(V,E,F) 
= \sum_{i=0}^{k-1} \arc_V(\orz,\{\rho^i \v,\rho^{i+1} \v\}), 
\] 
where $k=\card(F)$.  The right-hand side of this formula is easily
seen to be independent of the choice of $\v\in V$.  Call $\op{per}$
the \newterm{perimeter} of the nonreflexive local fan.  If $\v,\w\in V$ are
distinct nodes, define the \newterm{partial perimeter}
\[ 
  \op{per}(V,E,F,\v,\w) 
= \sum_{i=0}^{r-1} \arc_V(\orz,\{\rho^i \v,\rho^{i+1} \v\}), 
\] 
where $r$ is chosen so that $\w=\rho^r \v$ and $0<r\le k-1$.
\end{definition}
\indy{Index}{perimeter!nonreflexive local fan}%
\indy{Index}{fan!local}%
\indy{Notation}{per@$\op{per}$ (perimeter)}%



\begin{lemma}[perimeter majorization]\guid{WSEWPCH}\rating{500} %was 400
% was 1200 in old. approach.
\label{lemma:convex-hyp}
The perimeter of every nonreflexive local fan is at most $2\pi$.  
\end{lemma}
\indy{Index}{fan!local}%
\indy{Index}{perimeter}%

\begin{proof} 
\claim{If the nonreflexive local fan $(V,E,F)$ is circular, then its perimeter is
$\op{per}(V,E,F) =2\pi$.}
  Indeed, by Lemma~\ref{lemma:circular},
the arcs making up the perimeter all lie in a common plane.  The
azimuth cycle on $V$ coincides with $\rho:V\to V$.  The sum of the
terms in the formula defining the perimeter is the sum of the
azimuth angles in the azimuth cycle.  The sum is $2\pi$ by
Lemma~\ref{lemma:2pi-sum}.


\claim{If the nonreflexive local fan  is lunar, then its perimeter is
$\op{per}(V,E,F) =2\pi$.}  Indeed, by Lemma~\ref{lemma:lunar}, the
set $V$ is contained in the union of two half-planes.  The perimeter
is the sum of arcs in a half-circle in the first half-plane plus the
sum of arcs in a half-circle in the second half-plane. This sum is
$2\pi$.

Finally, assume that the nonreflexive local fan is generic.  Suppose for a
contradiction that the lemma is false.  Consider all counterexamples
that minimize the cardinality of $V$.  
%Among all such
%counterexamples, select a counterexample with the smallest number of
%darts $x\in F$ such that $\op{azim}(x) = \pi$.

A nonreflexive local fan $(V,E,F)$ is determined by $V$ and the cyclic
permutation $\rho:V\to V$: $E=\{\{\v,\rho \v\}\mid \v\in V\}$ and $F
= \{(\v,\rho \v)\mid \v\in V\}$.

In such a counterexample, if there is any straight dart $x=(\v,\w)\in F$,
then there is a new nonreflexive local fan $(V',E',F')$ with $V' =
V\setminus\{\v\}$ and $\rho':V'\to V'$ given by
\[ 
\rho'(\u) = \begin{cases}
\rho(\u), & \text{if } \rho(\u)\ne \v,\\
\rho(\v), & \text{if }\rho(\u) = \v.\\
\end{cases}
\] 
This is a nonreflexive local fan with the same perimeter, contrary to the presumed
minimality of the counterexample.  Thus, in the minimal counterexample
$\op{azim}(x) <\pi$ for all $x\in F$.

Let $(V',E',F')$ be the polar fan.  Its solid angle, which is nonnegative, is given by
Lemma~\ref{lemma:sol-local}.  We find by Lemma~\ref{lemma:polar-fan}
and the definition of perimeter that
\begin{align*}
0 &\le \sol(V',E',F') \\
    &= 2\pi + \sum_{\v'\in V'} (\angle'(\v') - \pi)\\
    &= 2\pi - \sum_{\v\in V} \arc_V(\orz,\{\v,\rho\v\})\\
    &= 2\pi - \op{per}(V,E,F).
\end{align*}
The lemma ensues.
\end{proof}


\section{Main Estimate}\label{sec:weight}  

Our aim becomes single-minded throughout the rest of the chapter; we
wish to give a proof of the main estimate (Theorem~\ref{lemma:empty-d}).
This,  the most intricate proof in the book,  requires substantial
preparation.  Assuming the existence of some counterexample to the main estimate, a
compactness argument gives the existence of a minimal counterexample.
The properties of minimal counter\-examples are developed in a long
sequence of lemmas.  Eventually, enough properties of a minimal
counterexample are established to conclude that it cannot exist.

\subsection{statement of results}\label{sec:statement}

This subsection states the main results of the chapter.


\begin{definition}[$\hm$,~$\tau$,~$\dih_i$]\guid{CUFCNHB}\label{def:tau}
Let $(V,E,F)$ be a nonreflexive local fan.  Recall that $\hm = 1.26$ and
$L(h) = ({h_0-h})/({h_0-1})$, when $h \le h_0$.
  Set
\begin{align*}
\rho_0(y) &= 1 + \dfrac{\sol_0}{\pi} \cdot
    \dfrac{y-2}{2\hm-2} = 1 + \dfrac{\sol_0}{\pi}(1 - L(y/2)),\\
  \tau(V,E,F) &=\sum_{x\in F}^{\phantom{!}} \rho_0(\normo{\nd(x)})\op{azim}(x)
+ \left(\pi+{\sol_0}\right) (2- k(F)),
\end{align*}
where $\sol_0=3\arccos(1/3)-\pi\approx0.551$ is the solid angle of a
spherical equilateral triangle of side $\pi/3$, and $k(F)$ is the
cardinality of $F$.  
Let 
\begin{equation}\label{eqn:tautri}
  \tau_{tri}(y_1,y_2,y_3,y_4,y_5,y_6) =
  \sum_{i=1}^3 \rho_0(y_i) \dih_i(y_1,\ldots,y_6)
- \left(\pi+{\sol_0}\right),
\end{equation}
where
\begin{align}\label{eqn:dihi}
\dih_1(y_1,y_2,y_3,y_4,y_5,y_6) &= \dih(y_1,y_2,y_3,y_4,y_5,y_6),\notag\\
\dih_2(y_1,y_2,y_3,y_4,y_5,y_6) &= \dih(y_2,y_3,y_1,y_5,y_6,y_4),\textand\notag \\
\dih_3(y_1,y_2,y_3,y_4,y_5,y_6) &= \dih(y_3,y_1,y_2,y_6,y_4,y_5).
\end{align}
\indy{Notation}{h@$h_0 = 1.26$}%
\indy{Notation}{zzt@$\tau_{tri}$}%
\indy{Notation}{zzt@$\tau$ (weight assignment)}%
\indy{Notation}{zzrho1@$\rho_0$ (real-valued function)}%
\indy{Notation}{sol0@$\sol_0 = 3\arccos(1/3)-\pi$}%
\indy{Notation}{dih@$\dih_i$}%
\indy{Notation}{L@$L$ (linear function)}%
\end{definition}


\begin{definition}[standard,~protracted,~diagonal]\guid{KRACSCQ} Let $(V,E)$ be a fan.  
We write $\normo{\ee}$ for $\norm{\v}{\w}$, when $\ee=\{\v,\w\}\subset V$.
We say that  $\ee$ is \newterm{standard} if
\[
2\le \normo{\ee}\le2\hm.
\]
We say that  $\ee$ is \newterm{protracted} if
\[
2\hm\le \normo{\ee}\le\sqrt{8}.
\]
If $\v,\w\in V$ are distinct, and $\ee=\{\v,\w\}$ is not an edge in $E$, then
we call $\ee$ a \newterm{diagonal} of the fan.
\end{definition}
%\indy{Notation}{4@$\norm{\wild}$ (norm of fan edge)}% % doesn't parse


\begin{theorem}[main~estimate]\guid{JEJTVGB}\label{lemma:empty-d}
%\label{theorem:main}
Let $(V,E,F)$ be a nonreflexive local fan (Definition~\ref{def:convex-local}).
We make the following additional
assumptions on $(V,E,F)$.
\begin{enumerate}
\item \case{packing} $V$ is a packing.  That is, for every $\v,\w\in
V$, if $\norm{\v}{\w}<2$, then $\v=\w$.
\item \case{annulus} $V\subset \BB$.
\item \case{diagonal} For all distinct elements $\v,\w\in V$, if
$\{\v,\w\}\not\in E$, then 
\[ 
\norm{\v}{\w}\ge 2\hm.
\] 
\item \case{card} 
Let   $k=\card(E)=\card(F)$.  Then $3\le k \le 6$.
\end{enumerate}
In this context, we have the following conclusions.
\begin{enumerate}
\item Assume $k\ge 4$.  If  every edge of $E$ is standard, then
\[ 
\tau(V,E,F) \ge d (k), \text{ where } d(k) =
\begin{cases}
  0.206,&\text{if }k=4,\\
  0.4819,&\text{if }k=5,\\
  0.712,&\text{if }k=6.
\end{cases}
\] 
\item Assume $k=5$.  Assume that every edge of $E$ is standard.
Assume that every diagonal $\ee$ of the fan satisfies $\normo{\ee}\ge\sqrt{8}$.
Then 
\[
\tau(V,E,F)\ge 0.616.
\]
\item Assume $k=5$.  Assume there exists some protracted edge in $E$ 
and that the other four are standard.  Then 
\[
\tau(V,E,F)\ge 0.616.
\]
\item Finally, assume that $k=4$.  Assume that there exists some protracted
 edge in $E$ and that the other three are standard.  
Assume that both diagonals $\ee$ of the fan satisfy $\normo{\ee}\ge\sqrt{8}$.
Then
\[
\tau(V,E,F)\ge 0.477.
\]
%% XX condition on diags >= sqrt8 added 2012-5-20.
%% based on the semantics of glpk/tame_archive/head.mod.
\end{enumerate}
\end{theorem}

There are two related inequalities that we will prove separately. For that reason,
we state them as a separate lemma.

\begin{lemma}\guid{HGDRXAN}\label{lemma:tau3}
Let $(V,E,F)$ be a nonreflexive local fan.
Under the same hypotheses on $(V,E,F)$ as in Theorem~\ref{lemma:empty-d}, 
\begin{enumerate}
\item Assume $k=3$. Then
\[\tau(V,E,F)\ge 0.\]
\item Assume $k=4$.  Assume that every edge of $E$ is standard.
Assume that both diagonals $\ee$ of the fan satisfy $\normo{\ee}\ge3$.
Then
\[
\tau(V,E,F)\ge 0.467.
\]
\end{enumerate}
\end{lemma}

The proof of the main estimate occupies the rest of the chapter.
We refer to the first conclusion of the theorem as the \newterm{standard main estimate}.  

The main estimate and Lemma~\ref{lemma:tau3} are obtained by computer
calculation, proving nonlinear inequalities by interval arithmetic.
Two  difficulties
arise in the proof of  the main estimate.  First, nonlinear optimization is
in general NP hard; and our calculations in particular rapidly become
more difficult to carry out as the dimension increases.  When $k=3$,
the set $V=\{\v_1,\v_2,\v_3\}$ is six-dimensional (nine spacial
coordinates minus a three-dimensional group of rotational symmetries).
These calculations in six dimensions are relatively simple.  However,
by the time $k=6$, the dimension of $V$ has reached fifteen, which is 
beyond our computational capacity.  We are forced to prove a sequence of
lemmas, showing that any configuration $(V,E,F)$ that minimizes $\tau$
lies in an explicit low-dimensional subset of this set of local
nonreflexive fans, where low-dimensional means anything small enough
to be treated directly by a computer calculation.

The second source of difficulty comes from numerical instabilities.
For numerical stability, we insist on using analytic functions on
compact domains.  One of our favorite strategies is to slice along
internal blades to cut local fans into smaller fans, and inductively
build up the desired estimates from the smaller fans.  However, when
we slice along an internal blade, it is very difficult to avoid computations on
simplices that flatten into simplices of zero volume.  
The functions defining $\tau$ are not analytic at flat simplices. They behave as
$\sqrt{\Delta}$, with $\Delta$ tending to $0$ from above.  Concerns
such as these force us to use relatively short diagonals when we
slice.  The general heuristic we use is that degeneracies are avoided when
$\normo{\ee}< 3.106\ldots$, and calculations become stable
when $\normo{\ee}<3.01$  (see the proof of
Lemma~\ref{lemma:compact:bs}).

We do not present a complete proof of the main estimate in the text,
because much of it is done by computer.  In the rest of this chapter,
we describe how the local fans of large dimension (especially, the case $k=6$)
can be reduced to much lower dimension.  From there, the reader must
trust that the small calculations have been executed, or turn directly to
the computer implementation for details.

\subsection{constraints}

Let $(V,E,F)$ be a nonreflexive local fan that satisfies all the assumptions
of the main estimate.  The main estimate takes the form of a collection of
bounds
\begin{equation}\label{eqn:taud}
\tau(V,E,F) > d,
\end{equation}
assuming various length constraints on the edges and diagonals of the fan.
In building up these estimates inductively (by slicing into
smaller fans), we will need to consider further estimates of the same
general form \eqref{eqn:taud}, under many different length constraints on
edges and diagonals.
With that in mind, we introduce a \newterm{constraint system}.
\indy{Notation}{s@$s$ (constraint system)}%

\begin{definition}[torsor,~adjacent]
  Let $k>1$ be an integer.  A \newterm{torsor} is a set $I$ with a
  given simply transitive action of $\ring{Z}/k\ring{Z}$ on $I$.  We
  write the application of $j\in\ring{Z}/k\ring{Z}$ to $i\in I$ as
  $j+i$ or $i+j$.  We also write $j+i$
  for the application of the image of $j\in\ring{Z}$ in $\ring{Z}/k\ring{Z}$ to
  $i\in I$.  Note that each choice of base point $i_0\in I$ gives a
  bijection $i\mapsto i+i_0$ between $\ring{Z}/k\ring{Z}$ and $I$.  
  We say that $i$ and $j$ are not \newterm{adjacent} if $i\ne j\pm 1$.
  %If $i,j\in I$, write 
  %\[
  %|i-j|_0 = \min\left \{ |m-n| \mid m + i = n +j,\ m,n\in\ring{Z}\right \}.
  %\]
  An
  \fullterm{isomorphism of torsors}{isomorphism!torsor} 
 is a bijection that respects the action.
\indy{Notation}{I@$I$ (torsor)}%
\end{definition}

We use the constant $\stab=3.01$ to make the constraint systems
numerically stable.  Its use will become apparent in
Lemma~\ref{lemma:compact:bs}.  
%
\indy{Notation}{ci@$\stab=3.01$}%

% XX stab. May 17, 2012.  Dropped the constraint a_{ij}\le \stab.
% It doesn't hold for one of the quad terminal constraint systems:
% 1637868761 has diag at least 3.41.

\begin{definition}[constraint~system,~stable]\guid{ZGFHNKX}
A \newterm{constraint system} $s$ consists of the following data:
\begin{enumerate}
\item a natural number $k\in \{3,4,5,6\}$,
\item a $\ring{Z}/k\ring{Z}$-torsor $I$,
\item a real number $d$,
\item real constants $a_{ij}$, $b_{ij}$,  satisfying
   $a_{ij} = a_{ji}$, $b_{ij}=b_{ji}$, $a_{ij}\le b_{ij}$, for $i,j\in I$, and
\item a subset $J\subset \{ \{i,1+i\} \mid i\in I\}$, 
such that $\card(J)+k\le 6$.
\end{enumerate}
\indy{Notation}{J@$J$}%
We say that a constraint system $s$ is \newterm{stable} if the following
additional properties hold.
\begin{enumerate}
\item 
\[
2\le a_{ij} \text{ for all }  i,j\in I \text{ such that } i\ne j.
\]  
\item
  Also, 
\[0 = a_{ii}\text{ and }
  b_{i,i+1}\le \stab.
\]  
\item
If $\{i,j\}\in J$, then $\leftclosed
  a_{ij},b_{ij}\rightclosed=\leftclosed\sqrt{8},\stab\rightclosed$.
\end{enumerate}
\end{definition}

\begin{remark}\guid{XUHUBYO}
  The number $k$ represents the number of edges in a given local fan.
  In practice, the set $I$ is an indexing set for the set of nodes
  $V=\{\v_i\mid i\in I\}$ of a local fan $(V,E,F)$, indexed such that
$\rho_{V,E,F}\v_i = \v_{i+1}$.   The constants $a_{ij}$ and
  $b_{ij}$ prescribe the lower and upper bounds on the edges and
  diagonals of a fan $(V,E,F)$ with $V$:
\[
a_{ij}\le \norm{\v_i}{\v_j} \le b_{ij}.
\]
A constant $d$ appears in \eqref{eqn:taud}.    The set $J$ is used to
make minor adjustments to the estimates, and will be explained later.
In most cases, we can take $J=\emptyset$.
\end{remark}

For each constraint system $s$, we write $k(s)$,
$d(s)$, $I(s)$, $a_{ij}(s)$, and so forth for the associated
parameters.  

\begin{example}\label{ex:main} The constants in the conclusions of the main estimate
  (Theorem~\ref{lemma:empty-d}) can be packaged into stable constraint
  systems.  For example, the standard main estimate for $k=6$ gives
  the constraint system $d=0.712$, $J=\emptyset$, $I$ an indexing set
  of cardinality six, and
\[
a_{ij} = \begin{cases} 0, & i=j,\\
  2, & j= i\pm1,\\
  2 \hm, & \text{otherwise}.
  \end{cases}
\qquad
b_{ij}=\begin{cases}
 0, & i=j,\\
 2\hm, & j= i\pm1,\\
 4\hm, & otherwise.
  \end{cases}
\]
The upper bound $4\hm$ on any diagonal comes from the triangle
inequality: $\norm{\v_i}{\v_j} \le \normo{\v_i}+\normo{\v_j} \le
4\hm$.   


We write $\smain$ for the set of stable constraint systems $s$, with a
fixed choice of torsor for each $k$, for all cases of the main
estimate.
\end{example}
\indy{Notation}{Smain@$\smain$ (main estimate constraint systems)}%


\begin{example}[ear]  We have a stable constraint system $s$ given by
$k=\card(I)=3$, $d=0.11$, $J$ a singleton, 
and
\[
\leftclosed a_{ij},b_{ij}\rightclosed=
\begin{cases}
 \leftclosed0,0\rightclosed,
 &\text{~~if } i=j,\\
 \leftclosed\sqrt8,\stab\rightclosed,
 &\text{~~if } \{i,j\} \in J,\\
 \leftclosed 2,2\hm\rightclosed,
 &\text{~~otherwise. }
\end{cases}
\]
We call $s$ an \newterm{ear} (by analogy with an ear
in a triangulation of a polygon, which is a triangle that has two of
its edges in common with the polygon).
\end{example}

Next we associate a set $\BB_s$ with each constraint system $s$.
\indy{Notation}{BBs@$\BB_s$}%

\begin{definition}[$\BB_s$]\guid{KTFVGXF}
  For every constraint system $s$, and every function
  $\v:I(s)\to \BB$, let $V_\v\subset \BB$ be the image of
  $\v$.  Let $E_\v$ be the image of $i\mapsto \{\v_i,\v_{i+1}\}$.  Let
   $F_\v$ be the image of $i\mapsto (\v_i,\v_{i+1})$.
 Let $\BB_s$ be
  the set of all functions $\v$ that have the following properties.
\begin{enumerate}
\item $a_{ij}(s)\le\norm{\v_i}{\v_j}\le b_{ij}(s)$, for all $i,j\in I(s)$.
\item $(V_\v,E_\v,F_\v)$ is a nonreflexive local fan.
\end{enumerate}
\end{definition}

\begin{lemma}[]\guid{WJSCPRO}\label{lemma:compact:bs}
Let $s$ be a stable constraint system. Then
$\BB_s$ is compact (as a subset of
$\BB^k \subset \ring{R}^{3k}$).
\end{lemma}

\begin{proof}  The set $\BB$ is defined as a closed subset of a closed
ball in $\ring{R}^3$.  It is compact.  By taking products of
a compact set, $\BB^k$ is compact. The set $\BB_s$ is defined by two
conditions.  The first enumerated condition in
the definition of $\BB_s$ is a closed constraint.  
It is enough to check that the condition the second condition is also
a closed constraint.  That is, it is enough to show that the set of functions $\v$
such that $(V_\v,E_\v,F_\v)$ is a nonreflexive local fan is closed in $\BB^k$.
 
For this, we run through each defining property of fan, local, and nonreflexive
in turn, and check that they are all closed conditions. 
For that purpose, consider a 
function
\[
\v : \{1,\ldots,k\}\to\BB.
\]
that lies in the closure of functions in $\BB_s$.
We show that the limit $(V_\v,E_\v,F_\v)$ is also a  nonreflexive local fan.
By the stability condition $2\le \norm{\v_i}{\v_j}$, when $i\ne j$, we see
that $\v$ is an injective function on the domain $\{1,\ldots,k\}$.
We find that $V_\v$ is a subset of $\BB$ of cardinality $k$.  In particular,
it is a nonempty finite set such that $\orz\not\in V_\v$.  This verifies the first
two defining properties of a fan.

The condition \case{nonparallel} of a fan follows from the estimates based on stability.
\[
2 \le \norm{\v_i}{\v_{i+1}} \le \stab, 
\]
If $\v_i$ and $\v_{i+1}$ are parallel, we get a contradiction:
\[
\norm{\v_i}{\v_{i+1}} = | \, \normo{\v_i} \pm \normo{\v_{i+1}} \,|
\]
which is at least $4>\stab$ or no greater than $2\hm - 2 < 2$.

We turn to the condition \case{intersection}.  This is the most tedious part 
of the proof, because there are several cases involved in showing that 
for all $\ee ,\ee '\in E \cup \{\{\w\}\mid \w\in V\}$, 
\[ C(\ee )\cap C(\ee ') = C(\ee \cap \ee ').\] We leave most of these
routine verifications to the reader.  Two cases are noteworthy.  (1)
Suppose that $\ee$ and $\ee'$ are disjoint sets of cardinality two,
such that the data for $\v$ gives a nonempty intersection
$C^0(\ee)\cap C^0(\ee')\ne\emptyset$.  The intersection of these two
blades is an open condition, so that this failure to satisfy the fan
constraint is open, and satisfaction of the constraint is therefore
closed.  (2) Suppose that $\ee=\{\u\}$ and $\ee'\in E_\v$ is disjoint
from $\ee$.  Suppose for a contradiction that $C^0(\ee')$ meets
$C(\ee)$.  We obtain a planar quadrilateral with diagonals $\ee'$ and
$\{\orz,\u\}$.  By contracting the diagonal $\ee'$, we obtain a
rhombus of side $2$.  By vector geometry, the two diagonals $d_1$ and
$d_2$ of the rhombus satisfy
\begin{equation}\label{eqn:rhombus16}
d_1^2 = 16 - d_2^2.
\end{equation}
We have $d_2\le 2\hm$ because  $\u$ is an element of the annulus $\BB$,
 and $\ee'$ satisfies an upper bound coming from the
stability conditions:
\begin{equation}\label{eqn:rhombus}
d_1^2 = \normo{\ee'}^2\le \stab^2< 3.106^2 <  
16-(2\hm)^2 \le 16-d_2^2 = d_1^2.
\end{equation}
%16 = d_1^2 + d_2^2 \le (2\hm)^2 + \stab^2 = 15.4105.
This is a contradiction. 

The defining properties of local fan are combinatorial, and depend only on 
$s$.
In the definition of nonreflexive, the condition \case{angle} is given
as a closed condition on the azimuth angle.  The condition
\case{wedge} is also given as a closed condition.
This completes the proof.
\end{proof}

The following lemma is based on the same methods as the previous
lemma.  It tells us that sufficiently short blades are necessarily
internal.

\begin{lemma}[]\guid{TECOXBM}\rating{0}\label{lemma:2hm-slice}
Let $s$ be a stable constraint system, and let $\v\in \BB_s$.
Let $\u,\w\in V_\v$ satisfy $2\le\norm{\u}{\w}\le \stab$ where
$\{\u,\w\}\not\in E_\v$.  Then $\u$ and $\w$ are nonparallel.
Moreover,
$C^0\{\u,\w\}\subset \Wdarto(x)$ for all $x\in F$.
\end{lemma}
% can extend the norm out to \stab.

\begin{proof} 
The proof that $\u$ and $\w$ are nonparallel is identical to the
proof in the previous lemma that showed $\v_i$ and $\v_{i+1}$ are not parallel.

We turn to the second conclusion of the lemma.
Assume for a contradiction that the second conclusion of the lemma is false.
We can find an edge $\{\u_1,\u_2\}\in E_\v$ such that 
\[
C^0\{\u,\w\}\cap C\{\u_1,\u_2\}\ne \emptyset.
\]
Moreover, $C^0\{\u,\w\}$ lies in a half-space with boundary
$\op{aff}\{\orz,\u_1,\u_2\}$.  This forces 
\[
C^0\{\u,\w\}\cap \{\u_1,\u_2\}\ne \emptyset.
\]
To be definite, assume that $\u_1\in C^0\{\u,\w\}$.  
%Then by Lemma~\ref{lemma:internal}, all the intermediate internal
%angles between $\u$ and $\w$ are equal to $\pi$.  As a result, (after
%interchanging $\u$ and $\w$ if necessary), the set
%$\{\orz,\u,\rho\u,\rho^2\u,\ldots,\rho^r\u\}$ is planar.
We obtain a planar quadrilateral with diagonals
$\{\orz,\u_1\}$ and $\{\u,\w\}$.  We obtain the same contradiction
as in the proof of case (2) of \case{intersection} in the previous lemma,
by deforming the quadrilateral to a rhombus.
\end{proof}

The set $J$ is used to make a small correction $d(s,\v)$ to the
constant $d(s)$.  


\begin{definition}[$d(s,\v)$]\guid{TPLCZFL}
Set $\sigma(s) =1$ when $s$ is an ear;  $\sigma =
-1$, otherwise.  Let $V=\{\v_i\mid i\in I(s)\}$ 
be a set of points in $\ring{R}^3$.
Write
\begin{equation}
d(s,\v) = d(s) +  0.1\, \sigma(s)\,\sum_{\{i,j\}\in J(s)} (\stab - \norm{\v_i}{\v_j}).
\end{equation}
\end{definition}
\indy{Notation}{zzs@$\sigma=\pm1$}%
\indy{Notation}{d@$d(s,\v)$}%

This correction to $d(s)$  makes it a bit easier to prove inequalities when
$\sigma(s)=-1$, at the cost of slightly more difficult inequalities for ears.
The set $J(s)$ is empty for $s\in \smain$, so this correction does not
directly affect the main estimates:
\[
d(s,\v) = d(s), \text{ for all } s \in \smain.
\]


\begin{definition}[$\tau^*$]\guid{BGCEUKP}\label{def:tau-star}
\indy{Notation}{zzt@$\tau^*$}%
Let $s$ be a stable constraint system.  Define 
\[
\tau^*:\{(s,\v)\mid \ \v\in \BB_s\} \to \ring{R}
\] 
by
\[ 
(s,\v) \mapsto \tau(V_\v,E_\v,F_\v)-d(s,\v).
\] 
\indy{Notation}{zzt@$\tau^*$}%
\end{definition}

\begin{lemma}[continuity]\guid{HDPLYGY}\label{lemma:compact-fan}
Let $s$ be a stable constraint system.  Then the function 
\[
\v\mapsto \tau^*(s,\v)
\]
is a continuous function on $\BB_s$.  Moreover, if $\BB_s$ is
nonempty, then the function attains a minimum.
\end{lemma}

\begin{proof} 
The function $\tau^*$ is a polynomial in $\normo{\v_i}$ and
$\op{azim}(\orz,\v_i,\v_{i+1},\v_{i-1})$.  The norm and azimuth
angle are both continuous functions of $\v$.
Moreover, a continuous function on a compact space attains its minimum.
\end{proof}

The largest constant $d(s)$ that arises in our calculations will be $d(s)=0.712$
(in the standard main estimate for $k=6$).  In particular, the
following lemma allows us to assume in all that follows that the fan
of a counterexample is not circular.

\begin{lemma}\guid{GBYCPXS}\label{lemma:09}
Let $s$ be a stable constraint system.  Let $\v\in \BB_s$.
Suppose that
\[
d(s)\le 0.9 \text{ and } \sol(V_\v,E_\v,F_\v) \ge \pi.
\]
Then $\tau^*(s,\v)>0$.
In particular, if $d(s)\le 0.9$ and
$\tau^*(s,\v)\le0$, then $(V_\v,E_\v,F_\v)$ is not a circular local fan.
\end{lemma}


\begin{proof}
We have
\begin{align*}
\tau(V,E,F) &=\left(\pi+{\sol_0}\right) (2- k)+ \sum_{x\in F}\op{azim}(x)
\left(1 + \dfrac{\sol_0}{\pi}  \dfrac{\normo{v}-2}{2\hm-2}\right) \\
  &\ge\left(\pi+{\sol_0}\right) (2- k)+ \sum_{x\in F} \op{azim}(x) \\
  &=\sol(V_\v,E_\v,F_\v) + (2-k)\sol_0\\
  &\ge \pi + (2-6)\sol_0 \\
  &> 0.92.\vspace{6pt}\\
%\\
  %&\ge 2\pi - 4\sol_0\\
 % &> 0.7578\\
  %&=0.103 (2) + 0.2759 (2)\\
 % &\ge 0.103 (2-s) + 0.2759 (r+2s-4) \\ 
  %&= d(r,s).
%\end{align*}
%\begin{align*}
d(s,\v) &= d(s) + 0.1\, \sigma \sum_{\{i,j\}\in J(s)} (\stab  - \norm{\v_i}{\v_{j}}) \\
   &\le d(s) + 0.1 (\stab - \sqrt{8}) \\
   &\le d(s) + 0.02\\
    &\le 0.92.
\end{align*}
Hence $\tau^*(s,\v) = \tau(V,E,F)-d(s,\v) > 0$.
When the fan is circular, 
\[
\sol(V_\v,E_\v,F_\v)=2\pi.
\] 
The result ensues.  
\end{proof}


\subsection{minimality}


We slice torsors as we did earlier with local fans 
(Figure~\ref{fig:slice-torsor}).



\begin{definition}[slice] \guid{ZTBHGMO}
Let $I$ be a $\ring{Z}/k\ring{Z}$-torsor, with action given by $(j,i)\mapsto j+i$,
for $i\in I$.  Let $p,q\in I$ that are not adjacent.  Set
\[
I[p,q] = \{p,1+p,2+p,\ldots,q\} \subset I.
\]
Note that the cardinality of $I[p,q]$ is
\[
m = 1 + \min \{m\in \ring{N} \mid m + p = q\}.
\]
We make $I[p,q]$ into a $\ring{Z}/m\ring{Z}$-torsor with action $(j,i)\mapsto j+' i$,
given by the iterates of
\[
1 +' i = 
\begin{cases}
  1 + i &\text{if } i\ne q,\\
  p &\text{if } i = q.
\end{cases}
\]
The $\ring{Z}/m\ring{Z}$-torsor $I[p,q]$ is called the
\fullterm{slice\/}{slice!torsor} of $I$ along $(p,q)$.
\indy{Notation}{Ipq@$I[p,q]$ slice (of a torsor)}%
\end{definition}

\figWKUYEXM % fig:slice-torsor


To prove the main estimate, we  use a finite set $S$ of constraint
systems that includes $\smain$.  To obtain the main estimate by
induction by slicing fans into pieces, the constraint systems must be
compatible. We use the following coherence conditions.

\begin{definition}[diagonal~cover]\guid{YCFMXRF}
  Let $s$ be a constraint system and let $p,q\in I(s)$ where $p$ and
  $q$ are not adjacent.  (In particular, $k(s)=\card(I(s))>3$.)  We
  say that a pair $\{s',s''\}$ of constraint systems \fullterm{covers}{cover}  the
  diagonal $\{p,q\}$ of $s$, if the following conditions hold.
\begin{enumerate}
\item  
 $I(s') = I[p,q]$ and $I(s'')=I[q,p]$, up to isomorphisms of torsors.
\item $d(s) \le d(s') + d(s'')$.
\item 
$J(t)\subset J(s)\cup \{\{p,q\}\}$, for  $t=s',s''$.
Also, $\{p,q\}\in J(s')$ if and only if $\{p,q\}\in J(s'')$,
 if and only if
 $s'$ or $s''$ is an ear.
\item For $t=s',s''$,
\[
a _{ij}(t) = a_{ij}(s)\text{~~and~~} b_{ij}(t) = b_{ij}(s),
\]
when $i,j\in I(t)$, provided $\{i,j\}\ne \{p,q\}$.
\item For $t=s',s''$,
\[
a_{pq}(s), b_{pq}(s) \in \leftclosed a_{pq}(t),b_{pq}(t)\rightclosed.
\]
%%!! Removed b_{pq}(s) in interval on Jan 23, 2012.
%%!! XX restored again on May 17, 2012
%
%\item The corresponding properties $(c'')$, $(d'')$, $(e'')$, 
%under $\phantom{a}'\leftrightarrow \phantom{a}''$ and $p\leftrightarrow q$.
\end{enumerate}
\end{definition}
\indy{Index}{diagonal cover}%

A cover of a diagonal $\{p,q\}$ is used when we slice a fan of cardinality $k$ into
two smaller fans with cardinalities $k(s')$ and $k(s'')$.  All of the edge
length constraints are to be preserved under slicing, with a
mild compatibility condition on the new edge created by the slice.

If   $\{s',s''\}$ covers a diagonal $\{p,q\}$, then we can use the inclusions
$I(s')\subset I(s)$ and $I(s'')\subset I(s)$ to restrict an element $\v:I(s)\to\BB$ to
$\v':I(s')\to \BB$ and $\v'':I(s'')\to \BB$.
The inequality $d(s)\le d(s') + d(s'')$ of a covered diagonal
implies a related inequality.


\begin{lemma}\guid{MTUWLUN}\label{lemma:cover}
Let $s$ be a stable constraint system with diagonal $\{p,q\}$ that is covered
by a pair of stable constraint systems $\{s',s''\}$. 
Let $\v\in \BB_s$ and let $\v'$ and $\v''$ be constructed from $\v$ as above.
Assume that if $\{i,j\}\in J(s)\cup J(s')\cup J(s'')$, 
then $\norm{\v_i}{\v_j}\le \stab$.
Then
\begin{equation}
d(s,\v) \le d(s',\v') + d(s'',\v'')
\end{equation}
and
\begin{equation}
\tau^*(s,\v)\ge \tau^*(s,\v')+\tau^*(s,\v'').
\end{equation}
Moreover, 
% XX changed May 17, 2012. Hypothesis is no longer needed because
% b_{pq}(s) has been restored in the defining conditions of cover.
%if 
%\[
%\norm{\v_p}{\v_q}\le \min (b_{pq}(s'),b_{pq}(s'')),
%\]
%then 
$\v'\in \BB_{s'}$ and $\v''\in \BB_{s''}$.
\end{lemma}

\indy{Notation}{zzd@$\delta\in\{0,1\}$}%
\begin{proof}
The existence of a diagonal forces $k(s)>3$.  In particular, $s$ is not an ear,
so that $\sigma(s)=-1$.  Every element of $J(s)$, by the definition of a constraint
system has the form $\{i,i+1\}$.  In particular, $\{p,q\}\not\in J(s)$.
Let $\delta=1$ if $\{p,q\}\in J(s')$ and $\delta=0$, otherwise.
By covering properties,  $\{p,q\}\in J(s')$, if and only if $\{p,q\}\in J(s'')$.
If $\delta=1$, 
then at least one of $\sigma(s'),\sigma(s'')$ is $1$.  
Abbreviate $c_{ij}(\v)=\stab-\norm{\v_i}{\v_j}$, for $\{i,j\}\in J(s)\cup \{\{p,q\}\}$.
We have $c_{ij}(\v)\ge0$, for all $\{i,j\}\in J(s)\cup J(s')\cup J(s'')$, by assumption.  
The sets $J(s')$ $J(s'')$ are  disjoint if $\delta=0$
and meet in the singleton set $\{\{p,q\}\}$ if $\delta=1$.
These observations give
\begin{alignat*}{4}
&\hspace{-0.6em}d(s',\v')+d(s'',\v'')-d(s,\v) \\
&\ge (d(s')+d(s'')-d(s) ) \quad+
   0.1 (\sigma(s')+\sigma(s'')) \,\delta\,  c_{pq}(\v) \quad+
   0.1 \hspace{-2.5em}\sum_{\{i,j\}\in J(s)\setminus (J(s')\cup J(s''))} \hspace{-2.5em} c_{ij}(\v) \\
  &\ge 0 + 0 + 0.
\end{alignat*}
The statement about $\tau^*$ follows from Lemma~\ref{lemma:slice}.
\end{proof}


The proof of the main estimate has the following structure.  In an
iterative process, we construct an explicit finite set $S$ of
constraint systems that includes the set $\smain$ of constraint
systems appearing in the main estimate.   We give a proof that for
every $s\in S$ and every $\v\in \BB_s$
\begin{equation}\label{eqn:main:sv}
\tau^*(s,\v)> 0.
\end{equation}

\indy{Notation}{l@$\ell$ (level function)}%
\begin{definition}[level~function,~minimal counterexample]\guid{WNUGMSE}
  Let $S$ be a set of constraint systems.  We say that $\ell:S\to\ring{N}$ 
  is a \newterm{level} function
on $S$ if for every $s,s'\in S$, $k(s')<k(s)$ implies  $\ell(s')<\ell(s)$. 
 We say that
  $(s,\v)\in S\times\BB_s$ is a \newterm{minimal counterexample}  relative to $S$ and $\ell$ if
the following conditions hold.
\begin{enumerate}
\item $\v$ minimizes the function $\v\mapsto\tau^*(s,\v)$ over $\BB_s$.
\item  $\tau^*(s,\v)\le 0$.
%If $s$ is the standard constraint system for $k=3$, then the minimum value
%is negative.
\item If $s'\in S$ is any constraint system such that $\ell(s')<\ell(s)$, then
for all $\v'\in \BB_{s'}$, we have $\tau^*(s',\v')>0$.
%\item For all $i,j$ that are not adjacent, we have $a_{ij}(s) < \norm{\v_i}{\v_j}$.
\end{enumerate}
\end{definition}

\begin{lemma}\guid{ESMGBKI}\label{lemma:esm}
Let $S$ be a set of constraint systems with level function $\ell$.
If \eqref{eqn:main:sv} fails to hold for some $s\in S$, 
then there exists a minimal counterexample relative to $S$ and $\ell$.
\end{lemma}

\begin{proof}
  Select some $s$ that minimizes $\ell(s)$, from the set $S_1\subset S$ of
  constraint systems $s$, such that $\BB_s$ contains points violating
  \eqref{eqn:main:sv}.  Let $\v$ minimize $\tau^*$ on $\BB_s$.  By
  construction, it satisfies the  defining properties of a
  minimal counterexample.  
%The fourth property is a consequence of the
%  induction property of coherence: if $\norm{\v_i}{\v_j}$ reaches its
%  minimum $a_{ij}(s)$, then we can find induction systems
%  $s',s'',\ldots$ with $k(s')<k(s)$ and $s'\in S_1$, contrary to the
%  minimality of $k(s)$.
\end{proof}

\begin{lemma}[minimality criteria]\label{lemma:min-crit}\guid{YPKHQKB} 
Let $S$ be a set of constraint systems.  Let $s\in S$.
Suppose that for every $\w\in\BB_s$, one of the following criteria holds.
\begin{enumerate}
\item \case{numerical positivity}  A calculation\footnote{In practice, these
  are computer calculations.} shows $\tau^*(s,\w)>0$.
 \item \case{deformation}  For some $\epsilon>0$, there exists a continuous function 
  $\v:\leftclosed 0,\epsilon\rightopen\to\BB_s$ such that $\v(0)=\w$ and
  \[
  \tau(s,\v(t))<\tau(s,\w),
  \]
  for all sufficiently small positive numbers $t$.
\item \case{diagonal}  The system $s$ is stable.  Also,
there exist $p,q\in I(s)$ and stable $s',s''\in S$ such that
  $\{s',s''\}$ covers the diagonal $\{p,q\}$ and such that
\[
\norm{\v_p}{\v_q}\le \min (b_{pq}(s'),b_{pq}(s'')),
\]
\item \case{transfer} The constraint system $s$ is not an ear, and
  there exists $s'\in S$ such that the following conditions hold.
  \begin{enumerate}
    \item $\w\in \BB_{s'}$;
    \item $\ell(s')<\ell(s)$;
      \item  $I(s')=I(s)$ (up to isomorphism);
        \item $d(s')\ge d(s)$; and
          \item $J(s')\subset J(s)$.
            \end{enumerate}
\end{enumerate}
Then there does not exist an element $\w\in \BB_s$ such that $(s,\w)$
is a minimal counterexample relative to $S$ and $\ell$.
\end{lemma}
\indy{Index}{transfer}%
\indy{Index}{deformation}%
\indy{Index}{diagonal cover}%

\begin{proof} The first two criteria are clearly incompatible with
  minimality.  The third is incompatible with minimality by
  Lemma~\ref{lemma:cover}.  If the final criterion holds at $\w$, then
  $k(s)=k(s')$, and $\tau(V_\w,E_\w,F_\w)$ is the same for both $s$
  and $s'$.  Also, $d(s',\w)\ge d(s,\w)$ and $\tau^*(s',\w)\le
  \tau^*(s,\w)$.  Then $(s',\w)$ certifies that $(s,\w)$ is not minimal.
\end{proof}

\subsection{reducing dimension}

As we pointed out at the beginning of this section, the dimension of
$\BB_s$ is so large that it gives computational difficulties.  
The dimension of $\BB_s$ is $ 3 k- 3 \le 15$, and to
obtain reasonable performance, we prefer to restrict our computer
calculations to at most six or seven dimensions.  This subsection gives a
collection of lemmas that show that some minimal counterexample (for
suitable $S$) must lie in a subset of $\BB_s$ of small dimension.
This will allow us to use computers to complete the verifications of
the main estimate.

Throughout this subsection we examine a constraint system $s$.  With
the \case{deformation} criterion of Lemma~\ref{lemma:min-crit} in
mind, we specifically avoid minimal counterexamples that will be
treated later with the \case{diagonal} criterion of the same lemma.
We say that $(s,\v)$ is \newterm{free}, if
$a_{ij}(s)<\norm{\v_i}{\v_j}<b_{ij}(s)$ for all diagonals $\{i,j\}\not\in E_\v$.
We limit our discussion in this section to free pairs $(s,\v)$.

We
consider differentiable curves
\[
\v:\leftopen -\epsilon,\epsilon\rightopen\to \BB^{k(s)}.
\]
If we show that $\tau^*(s,\v(t))<\tau^*(s,\v(0))$ and $\v(t)\in\BB_s$,
whenever $t$ is positive and sufficiently small, then
 $(s,\v(0))$ is not a minimal counterexample.
For simplicity, we will start our study with curves that move a single point:
\begin{equation}\label{eqn:move1}
   \v_j(t)= \w_j\text{ if } j\ne i,\quad \v_i(0) = \w_i,
\end{equation}
for some index $i\in I(s)$ and some fixed $\w\in \BB_s$.
\indy{Notation}{v8@$\v(t)$ (deformation of $\v$)}%

% XX Need to exclude vertices i st {i,j} in J.
% in all the deformation lemmas.
% Added final condition. May 14, 2012.


%% XX Need to assume that it is generic or lunar:

In the next three lemmas, we make the implicit assumption that the local fan
$(V_\w,E_\w,F_\w)$
is generic, or that it is a lunar fan satisfying the assumptions of Lemma~\ref{lemma:fan-open-lunar}.

\begin{lemma}\guid{ODXLSTC}\label{lemma:odx}
  If $(s,\w)$ is a free minimal counterexample relative to $S$ and $\ell$,
  then for all $i$, one of the following
  constraints hold.
\begin{enumerate}
\item $\norm{\w_i}{\w_{i+1}}$ attains its lower bound $a_{i,i+1}(s)$.
\item $\norm{\w_i}{\w_{i-1}}$ attains its lower bound $a_{i,i-1}(s)$.
\item $\normo{\w_i}$ attains its lower bound $2$.
\item There exists $j$ adjacent to $i$ such that $\{i,j\}\in J(s)$.
\end{enumerate}
\end{lemma}

\begin{proof} Fix $i$.  Assume for a contradiction that none of the
constraints hold.
The function $\tau^*$ is decreasing along
the curve of the form \eqref{eqn:move1} such that
$\v_i(t)=(1-t) \w_i$.
That is, we push the point $\w_i$ radially towards the origin.
Explicitly, along this deformation, up to a constant, $\tau^*$ is equal
to a positive constant times $\normo{\v_i(t)}$.
If none of the constraints of the lemma are satisfied, then
$\v(t)\in \BB_s$ for all $t$ positive and sufficiently
small.
\end{proof}

Recall that we call $\w_i$ \fullterm{straight}{straight fan node}
if $\angle(\w_i)=\pi$ in the local fan $(V_\w,E_\w,F_\w)$.

% XX May 14, added final constraint.

\begin{lemma}\guid{IMJXPHR} \label{lemma:imj}
  Let $(s,\w)$ be a free minimal counterexample relative to $S$ and
  $\ell$,  and let $i\in I(s)$.  If $\w_i$ is straight, then one of the
  following constraints hold.
\begin{enumerate}
\item $\norm{\w_i}{\w_{i+1}}$ attains its lower bound $a_{i,i+1}(s)$, and
 $\norm{\w_i}{\w_{i-1}}$ attains its lower bound $a_{i,i-1}(s)$.
\item $\normo{\w_i}$ attains its lower bound $2$.
\item There exists $j$ adjacent to $i$ such that $\{i,j\}\in J(s)$.
\end{enumerate}
\end{lemma}

\begin{proof}  The set $\{\orz,\w_{i-1},\w_i,\w_{i+1}\}$ lies in a plane $A$.
Assume for a contradiction that none of the constraints holds.  By the previous
lemma one of the norm constraints is satisfied, say
\[
\norm{\w_i}{\w_{i+1}}=a_{i,i+1}(s).
\]
We consider a  curve $\v$ of the form \eqref{eqn:move1}.
We let the curve $\v_i$ describes a circle through
 $\w_i$ with center $\w_{i+1}$ in the plane $A$.  Parameterize the curve
so that as $t$ increases, the norm $\normo{\v_i(t)}$ decreases.
The function $\tau^*(s,\v)$ is decreasing in $t$.  Explicitly, the
function again depends linearly on $\normo{\v_i(t)}$, because
the azimuth angles remain fixed.  The result ensues.
\end{proof}

The following lemma allows us to propagate a lower bound constraint
from one edge to an adjacent one.

\begin{lemma}\guid{NUXCOEA} \label{lemma:nux}
  Let $S$ be a set of constraint systems and $\ell$ a level
  function. Let $s\in S$, and let $i\in I(s)$.  Assume that every
  free minimal counterexample $(s,\w)$ relative to $S$ and $\ell$
  satisfies
\[
\w_i \text{ straight } \quad
\Longrightarrow\quad \norm{\w_i}{\w_{i+1}}=a_{i,i+1}(s).
\]
Assume $a_{i,i+1}(s)<b_{i,i+1}(s)$.
Then every free minimal counterexample $(s,\w)$
for which $\w_i$ is straight, also satisfies $\norm{\w_i}{\w_{i-1}}=a_{i,i-1}(s)$.
Moreover, the same result holds with $i+1$ and $i-1$ interchanged.
\end{lemma}

\begin{proof}
Let $(s,\w)$ be a free minimal counterexample as described.
Assume for a contradiction that 
\[
\norm{\w_i}{\w_{i-1}}>a_{i,i-1}(s)
\]
We consider a curve $\v$ of the form \eqref{eqn:move1} that moves $\v_i$
in a circular arc with center $\orz$ through the point $\w_i$ and in
the fixed plane determined by $\{\orz,\w_i,\w_{i+1}\}$.  The function $\tau^*$ is
constant along this curve.  We orient the curve to be increasing
in $\norm{\w_i}{\w_{i+1}}$.  For sufficiently, small $t$, we find that
$\v(t)\in\BB_s$ outperforms the minimal counterexample. This is a contradiction.
\end{proof}

\indy{Notation}{zzt@$\tau_{tri}$}%
\begin{remark}[lateral motion]\label{rem:contract}
  We continue to study curves $\v$ of the form \eqref{eqn:move1}, with
  motion confined to a single index $i\in I$. Let $j,k\in I$ be the
  two indices adjacent to $i$, so that $\{j,k\}=\{i-1,i+1\}$.  We
  consider a curve $\v_i$ in $\ring{R}^3$ with parameter $t$ that
  describes the circle through $\w_i$ at fixed distance from $\orz$
  and $\w_j$ (Figure~\ref{fig:lateral-motion}).  By 
  Lemma~\ref{lemma:slice} applied to $\tau^*$, 
  up to a term that is constant along the
  curve, the function $\tau^*(s,\v)$ depends on $\v$ only through the
  three points $\w_j$, $\v_i$, and $\w_k$.  The function $\tau^*$ is
  invariant under orthogonal transformations.  The dependence on $\v$ can be
  expressed through the function $\tau_{tri}$ in
  Definition~\ref{def:tau}, evaluated at the six edge lengths of the
  simplex $\{ \orz,\w_j,\v_i,\w_k \}$.  The derivative of $\tau^*$
  along the curve is given by the partial derivative of $\tau_{tri}$ with
  respect to a single variable, say $y_4=\norm{\v_i(t)}{\w_k}$:
 \begin{equation}\label{eqn:tau-partial}
 \frac{\partial \tau^*(s,\v(t))}{\partial t} = \frac{\partial \tau_{tri}}{\partial y_4}
 \frac{\partial y_4}{\partial t}.
 \end{equation}  
 Even when the dimension of
  $\BB_s$ is large, the right-hand side of this equation is a function
of just six variables,
  and can be estimated by computer.  By a \cc{UPONLFY}{} we can show that
  under rather general conditions on $s$, the function $\tau_{tri}$ is
  increasing in $y_4$.  More generally, when the partial derivative
  of $\tau_{tri}$ of $y_4$ vanishes, computer calculations of the
  second derivative show that the $\tau_{tri}$ has a local maximum
  (again under mild restrictions on the domain), so that there are no
  interior point local minima as a function of $y_4$.  By applying lateral
  motions at one index after another, the dimension of the configuration space
  can be significantly reduced.
\end{remark}

\figGJBTZJI % fig:lateral-motion

\begin{remark}[straight node strategies]
  A complication occurs in lateral motions.  Consider the lateral
  motion of $\w_i$ at fixed distance from $\w_j$ and $\orz$, where $j$
  and $k$ are the indices adjacent to $i$.  The curve $\v$ is required
  to remain inside $\BB_s$ for $t$ sufficiently small and positive.
  But when $\w_i$, $\w_j$, or $\w_k$ is straight, the curve does not
  generally remain inside $\BB_s$: nonreflexivity can fail.  We use
  three different strategies to get around this complication.  In
  practice, these three strategies are sufficient to handle all the
  situations that arise.

  First, we can try a lateral motion for a different ordered triple of
  pairs $(i,j,k)$, such as a different index $i$ altogether, or the
  triple $(i,k,j)$, which interchanges the roles of $j$ and $k$.
 
  Second, we can restrict the direction of the lateral motion to
  decrease the angle at the straight node(s).  Sometimes a computer
  calculation shows that for a given $s$, the azimuth angle of $\w_i$
  is obtuse.  When the azimuth angle at $\w_i$ is obtuse, basic
  trigonometry shows that if the lateral motion is directed to
  decrease the angle at $\w_j$, then it also decreases the angle at
  $\w_k$, and the curve remains initially inside $\BB_s$.

  Finally, to be concrete assume that $(j,k)=(i-1,i+1)$.  Select $\ell$
  so that $\w_{i-1},\w_{i-2},\ldots,\w_{\ell+1}$ are straight, but
  $\w_{\ell}$ is not. The point $\orz$ and collection
  $W=\{\w_{i},\ldots,\w_{\ell}\}$ lie in a common plane $A$.  We
  consider a curve $\v$ that fixes all coordinates, except those in
  $W$, and isometrically moves the set $W$ by a rotation of the plane
  $A$ about the line through $\{\orz,\w_{\ell}\}$.  (This is the one
  place where we consider a curve $\v$ that moves more that one
  component $\v_i$ at once.)  In this case, the dependence of $\tau^*$
  on the curve factors through the six edges of the simplex
  $\{\orz,\v_i,\w_{i+1},\w_{\ell}\}$.  The local minima of this
  function can be studied by computer by using the right-hand side of
  \eqref{eqn:tau-partial}.
\end{remark}

\indy{Notation}{zzt@$\tau_{tri}$}%
\begin{remark}[radial motion]\label{rem:radial}
  We continue to study curves $\v$ of the form \eqref{eqn:move1}, with
  motion confined to a single index $i$.  We consider a curve $\v_i$
  in $\BB\subset\ring{R}^3$ with parameter $t$ that describes the
  circle through $\w_i$ at fixed distance from $\w_{i-1}$ and
  $\w_{i+1}$ (Figure~\ref{fig:radial-motion}).  Up to a term that is
  constant along the curve, the function $\tau^*(s,\v)$ again reduces
  to $\tau_{tri}$ and the derivative with respect to $t$ is given by
  the partial derivative of $\tau_{tri}$ with respect to
  $y_1=\normo{\v_i}$, provided we use parameterization $t=y_1$.
  Whenever we use this radial motion, we impose the following preconditions.
\begin{enumerate}
\item $\norm{\w_{i-1}}{\w_i}=\norm{\w_i}{\w_{i+1}}=2$, and
\item $\norm{\w_{i-1}}{\w_{i+1}} \ge \stab$.
\end{enumerate}
Under these conditions a computer calculation of the first and second
derivatives of $\tau_{tri}$ shows that it has no local minimum, provided
$\w_i$ is not straight.
To maintain nonreflexivity along the curve, we must also assume that
 neither of $\w_{i-1},\w_{i+1}$ is straight,
As a consequence of radial motion,  
any free minimal counterexample $(s,\w)$ that satisfies this and
the preconditions
must have an extremal norm:
\begin{equation}\label{eqn:extremal}
\normo{\w_i}=2,\text{ or } \normo{\w_i}=2\hm, \text{ or } \w_i
\text{ is straight.}
\end{equation}
\end{remark}

\figMVFCDJQ % fig:radial-motion


\subsection{computer proof of main estimate}\label{sec:computer-main}

In this subsection, we sketch the computer proof of the main estimate.
Before turning to the general case, we illustrate the methods, by
proving Lemma~\ref{lemma:tau3}.

\begin{proof}[computer proof (\ref{lemma:tau3})]
  When $k=3$, the space of configurations has six dimensions.  The
  inequality $\tau(V,E,F)\ge0$ is a simple direct computer calculation.  When
  $k=4$, the assumptions of the lemma give that both diagonals have
  length at least $3$.  By a rigorous computer estimate of dihedral
  angles, all nodes of a quadrilateral with diagonals at least $3$
  must have azimuth angle less than $\pi$.  We laterally contract edges (by
  Remark~\ref{rem:contract}) until both diagonals are precisely $3$ or
  all four edges reach the lower bound $2$.  However, the rhombus
  diagonal inequality \eqref{eqn:rhombus16} shows that both diagonals
  become $3$ before the four edges reach the lower bound $2$.  Thus,
  it is enough to consider the case when both diagonals are $3$.  By
  adding these two constraints, we have reduced the dimension from nine
  to seven. This seven-dimensional inequality is within reach of direct
  computer calculation.
\end{proof}


\subsubsection{construction of $S$}

We now sketch the proof of the main estimate, and describe the
construction of set $S$ of constraint systems and level
set\footnote{We may replace the range of $\ell$ with any
  well-ordered set that has the same ordinal as $\ring{N}$.  In
  particular, it is more convenient to use a lexicographic order on
  $\ring{N}\times Z$, for some fixed finite ordered set $Z$, with the
  property that the first coordinate of the pair is $k(s)$ and the
  second coordinate orders constraint systems with given $k$ however
  we please in the construction that follows.}  $\ell$, starting with
$\smain$.  We always wish to slice along diagonals of length at most
$\stab$.  We saturate $S$ by adding diagonal covers in all possible
ways, up to symmetry, of slicing systems $s\in \smain$ along diagonals
of length at most $\stab$.  (By Lemma~\ref{lemma:2hm-slice}, the
corresponding blades are necessarily internal, and can be used to
slice the local fan.)  For example, when $k=5$, we need to add two
additional constraint systems, one corresponding to a
single diagonal (which partitions the pentagon into a quadrilateral
and triangle), and two diagonals (which triangulates the pentagon).
For these additional constraint systems, the constants $d$ have been
determined experimentally, and satisfy the required diagonal covering
conditions.  We do not list all the constants here.  They are
available in the computer code.  We define $J(s)$ to be as large as
possible, subject to the diagonal covering conditions.

For every $s$ in this set $\smain$, we add a constraint system $s'$ to $S$,
where $s'$ has the same parameters as $s$, except that for all
non-adjacent indices $i$ and $j$, we set
\begin{equation}\label{eqn:s'}
a_{ij}(s') = \max(a_{ij}(s),\stab),\quad b_{ij}(s')=\max(b_{ij}(s),\stab).
\end{equation}
so that
\begin{equation}\label{eqn:stab}
\stab \le a_{ij}(s')\le b_{ij}(s').
\end{equation}
At this point, a minimal counterexample necessarily has diagonals
greater than $\stab$.  By a transfer to new constraint system $s'$ with
these parameters, and choosing $\ell(s')<\ell(s)$, we may
assume that if $(s',\v)$ is a minimal counterexample, then the system
$s'$ satisfies \eqref{eqn:stab}.

In general, whenever we add any constraint system to $S$, we recursively add
further constraint systems, corresponding to slicing along diagonals,
to maintain the diagonal covering properties.  We assume this is done
in what follows, without further mention.

When $s\in S$ satisfies $k(s)>3$, and $J(s)\ne\emptyset$, we transfer
to an additional $s'\in S$ that is identical to $s$, except that $J(s')=\emptyset$
and $\ell(s')<\ell(s)$.  



\subsubsection{triangles and quadrilaterals}

The computer proof that there are no minimal counterexamples $(s,\v)$
with $k(s)=3$ goes as follows.  Up to rotational invariance, the function
$\tau^*$ can be expressed in terms of the function $\tau_{tri}$ of six
variables.  The rigorous nonlinear minimization of $\tau^*$ is easily done
by computer, and we find that for each $s\in S$, and every $\v\in \BB_s$,
we have $\tau^*(s,\v)>0$.

The computer proof that there are no minimal counterexamples $(s,\v)$
with $k(s)=4$ is not much more difficult.

\subsubsection{pentagons}

We consider a transfer that combines all the cases with $k=5$ (with
diagonals greater than $\stab$) into a single additional constraint
system $s$ of level lower than any other pentagon.  For this we put
the standard constraint on all edges but one
\[
(a_{i,i+1}(s),b_{i,i+1}(s))=
\begin{cases}
(2,2\hm),&\text{if } i\ne 0\\
(2,\stab),&\text{if } i=0,
\end{cases}
\]
where $I(s) = \ring{Z}/5\ring{Z}$.
We use the usual modified constraint on all diagonals:
\[
(a_{ij}(s),b_{ij}(s))=(\stab,4\hm),\quad \text{ if $i$ and $j$ are not adjacent. }
\]
For the constant $d(s)$ we take  the maximum of
the constant $d(s')$ as $s'$ runs over cases with $k(s')=5$.

By combining all pentagonal cases into one, we may give a uniform proof.
 By
lateral motions (Remark~\ref{rem:contract}), a computer assisted
argument shows that every minimal counterexample $(s,\w)$ satisfies
\[
\norm{\w_i}{\w_{i+1}} = 2,
\]
for all $i$.  We use the following lemma.

\begin{lemma}\guid{VPWSHTO}
Consider any skew pentagon in $\ring{R}^3$ whose five edges equal $2$.
Then there are two  diagonals  of the pentagon with a common
endpoint whose lengths  are at most
\[
1 + \sqrt{5} = 3.2607\ldots.
\]
\end{lemma}

\begin{proof}
  Cut the pentagon into a triangle and skew quadrilateral along the
  shortest diagonal, of length $t$.  By the triangle inequality
  $t\le4$.  The shortest diagonal of the skew quadrilateral is
  maximized, when the quadrilateral is planar, with equal diagonals.
  The length of this diagonal is given by the largest root $u$ of
\[
\Delta(u^2,4,4,u^2,4,t^2)=0.
\]
Solve for $u$ in terms of $t$ to obtain
\[
u = \sqrt{4 + 2 t}.
\]
If $t>1+\sqrt{5}$, this gives a contradiction $u<t$.  
So $t\le 1+\sqrt{5}$.
Then also
\[
u = \sqrt{4 + 2t} \le 1+\sqrt{5}.
\]
\end{proof}

\figLZBQINL %fig:main-pent


We assume that indexing is chosen so that $I=\ring{Z}/5\ring{Z}$ and
 $(s,\w)$ is a minimal
counterexample with two chosen diagonals (Figure~\ref{fig:main-pent}).
\[
\stab < \norm{\w_0}{\w_i} \le 1+\sqrt{5},\quad i=2,3.
\]
Dihedral angle computer calculations show that under these
constraints, none of $\{\w_0,\w_2,\w_3\}$ is straight.  This allows
us to apply radial motion (Remark~\ref{rem:radial}), to show that
$\w_1$ and $\w_4$ are extremal, in the sense of \eqref{eqn:extremal}.
This determines $\w_1$ and $\w_4$ (up to three cases each) as a
function of $\w_0$, $\w_2$, $\w_3$.  The calculations reduce in this
way to a single simplex $\{\orz,\w_0,\w_2,\w_3\}$, which have been
carried out by computer.

\subsubsection{hexagons}

Only one of the inequalities in the main estimate has $k=6$.  It
asserts that $\tau(V,E,F) > 0.712$.  By adding an additional hexagon
of lower level, we may transfer to a constraint system whose diagonals
satisfy
\begin{equation}\label{eqn:astab}
a_{ij}(s)=\stab.
\end{equation}  
We assume that our constraint system
has this property.
By lateral motions, we reduce to the case
\[
\norm{\w_i}{\w_{i+1}}=2,
\]
for all $i$.  We may assume that the indexing set $I$ is $\ring{Z}/{6\ring{Z}}$. 
We triangulate with three blades
$\{\w_{2i},\w_{2i+2}\}$, for $i=0,2,4$.  See Figure~\ref{fig:main-hex}.

\figARTLHOI % fig:main-hex

\begin{lemma}\guid{LFJCIXP}
The norms $\norm{\w_{2i}}{\w_{2i+2}}$, for $\w\in \BB_s$, 
are at least $\stab$ and at most $3.915$.
\end{lemma}

\begin{proof}
  The lower bound comes from \eqref{eqn:astab}.  By
  Lemma~\ref{lemma:delta-pos}, the squares of the edges $x_{ij}$ of
  the simplex $\{\orz,\w_{2i},\w_{2i+1},\w_{2i+2}\}$ gives a
  nonnegative value
\[
\Delta(x_{ij})\ge 0.
\]
However, this polynomial is  negative when
$\norm{\w_{2i}}{\w_{2i+2}} > 3.915$.
\end{proof}

By radial motion, we may assume that the \eqref{eqn:extremal} holds at
each odd index $\w_{2i+1}$.  We warn that these contraction arguments
may produce nonreflexivity in the local fan at some of the even
indices $\v_{2i}$.  At this final stage, we abandon the nonreflexive
condition.  In fact, at this stage, we may abandon the geometry
altogether, and view $\tau^*$ analytically as a sum of four terms
$\tau_{tri}$, indexed by the four triangles in the triangulation of
the hexagon.  After radial motion, the points $\v_{2i+1}$ are rigidly
determined, up to three cases \eqref{eqn:extremal}, in terms of the
simplex $\{\orz,\v_2,\v_4,\v_6\}$.  We have reduced the calculations
for $k=6$ to a single simplex, which have been carried out by
computer.

\subsubsection{instabilities}

We add a final lemma that we used to deal with the issue of numerical
instability in the calculations when one of the simplices 
$\{\orz,\w_{2i},\w_{2i+1},\w_{2i+2}\}$ is close to being planar.

\indy{Notation}{zzt@$\tau_{tri}$}%
\begin{lemma}\guid{OWZLKVY}
Consider the function $\tau_{tri}$
on the domain
\[
y_1,y_2,y_3\in\leftclosed 2,2\hm\rightclosed,
\quad y_4\in\leftclosed \stab,3.915\rightclosed,
\quad y_5=y_6=2,\quad
\Delta(y_1^2,\ldots,y_6^2)\ge0.
\]
Then $\tau_{tri}$ has the following properties.
\begin{enumerate}
\item If $y_1=2$, then $\tau_{tri}(y_1,y_2,y_3,y_4,y_5,y_6)\ge -\sol_0$.
\item If $y_1=2\hm$, then $\tau_{tri}(y_1,y_2,y_3,y_4,y_5,y_6)\ge 0$.
\item If $\dih_1(y_1,y_2,y_3,y_4,y_5,y_6) =\pi$, then 
  \[
  \tau_{tri}(y_1,y_2,y_3,y_4,y_5,y_6) = \sol_0\dfrac{y_1 -2\hm}{2\hm-2}.
  \]
\end{enumerate}
\end{lemma}

\begin{proof}
The first claim is the trivial lower bound that we obtain by replacing
$\rho_0(y)$
with $1$, and the solid angle $-\pi+\sum_{i=1}^3 \dih_i$ with zero
in the Definition~\ref{def:tau} of $\tau_{tri}$.  The does not use the
assumption that $y_1=2$.

To establish the second claim, we write each of the three terms 
\[
\pi-\dih_1,\quad\dih_2,\quad \dih_3.
\]
in the form $f_i\nsqrt{\Delta}$, for $i=1,2,3$.  The explicit formulas
for dihedral angles show that $f_i$ is an analytic function of
$y_1,\ldots,y_6$.  When $y_1=2\hm$, we obtain a formula for
$\tau_{tri}$ of the general form
\[
\tau_{tri}(y_1,\ldots,y_6)= f(y_1,\ldots,y_6)\sqrt{\Delta(y_1^2,\ldots,y_6^2)}
\]
for some analytic function $f$.  A computer calculation shows that $f\ge0$
on the domain given in the lemma. Hence $\tau_{tri}$ is also nonnegative.

We turn to the third claim.  If $\dih_1=\pi$, then $\dih_2=\dih_3=0$.
If we make these substitutions into the formula for $\tau_{tri}$, the
claim follows immediately.
\end{proof}

The lemma is used to avoid numerical instabilities as follows.  The
three statements of the lemma correspond to the three cases given by
\eqref{eqn:extremal}.  We may assume that the simplex
$\{\orz,\w_{2i},\w_{2i+1},\w_{2i+2}\}$ falls into one these cases.
When the simplex approaches a planar configuration, that is as
$\Delta$ approaches zero, we replace the term $\tau_{tri}$ with the
lower bound given by the lemma, to avoid computing a nonanalytic
term directly.  By doing this, all of the computer calculations go
through without trouble.
