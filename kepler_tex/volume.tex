%------------------------------------------------------------
% File : volume.tex
% Author: Thomas C. Hales
% Book Chapter: Dense Sphere Packings
% File  created: 3/22/07
%------------------------------------------------------------



\chapter{Volume}\label{chapter:volume}

\begin{summary}
  In this chapter a general working knowledge of measure in three
  dimensional Euclidean space is assumed.  Nowhere does this book directly need
   integration.  Measure alone suffices.  Volume formulas
  for various classical solids are stated.  Most of the volumes
  considered in this chapter (such as that of the ball, a rectangle, a
  tetrahedron, and a frustum) have been known since antiquity.  This chapter
  describes the volumes of every
  three-dimensional solid that appears anywhere in the book.

  To keep the presentation as simple as possible, we avoid surface
  integrals.  As an elementary substitute for surface integration on a
  sphere, this book systematically replaces subsets of the unit sphere
  with three-dimensional solids, called \fullterm{radial}{radial!set}
  sets.  This chapter presents basic properties of radial sets.

  Finally, Section~\ref{sec:finiteness} uses the volume formula for
  cubes to estimate the number of integer lattice points in a ball of
  large radius.
\end{summary}

\section{Background in Measure}
\indy{Index}{measure}%

%Most of the volumes to be considered (such as that of a
%ball, a tetrahedron, and a frustum) were known in antiquity.

This book uses the concepts of null set, measurable set, and volume in
three dimensions; the existence of these concepts with stated
properties is assumed without proof. \footnote{Harrison has already
  implemented gauge integration, which is much more than what this
  book requires, inside the proof assistant HOL Light~\cite{HHMNOZ}.}


% The existence
%follows from the known properties of gauge integrals: a null sets can
%be defined to be a set of zero gauge measure, a measurable set to be a
%bounded gauge measurable set, and the volume of a measurable set to be
%ts gauge measure.  


%\subsubsection{null set}\label{sec:null}

\begin{definition}[vol,~measurable,~null]\guid{EABVAEK}
Let $\op{vol}$ be the Lebesgue measure
on $\ring{R}^3$. 
A \newterm{null set} is a 
Lebesgue measurable subsets of $\ring{R}^3$ of measure zero.
A \newterm{measurable} set in this book is a subset of $\ring{R}^3$ that
is bounded and Lebesgue measurable.
\end{definition}
\indy{Notation}{vol}%
\indy{Index}{measure!Lebesgue}%

\begin{remark}[]\guid{KEKGFJK}
  The Lebesgue measure may be replaced with various alternatives (for
  example, Riemann or gauge) of measure in this definition.  A list of
  three-dimensional solids (a rectangle, a ball, a tetrahedron, a
  frustum, and so forth), called \fullterm{primitive regions}{primitive region}, is
  provided by Definition~\ref{def:primitive}.  These primitive regions
  are measurable (and have the same volume) with respect to almost any
  normalized translation invariant measure.
\end{remark}

\begin{lemma}[null set]\guid{OWCZKJR}\label{lemma:null}
Null sets have the following  properties:
\begin{enumerate}%[Null Set]
\item A measurable subset of a null set is a null set.
\item A union of two null sets is a null set.
\item A plane is a null set.
\item A sphere is a null set.
\item A circular cone is a null set; that is, a union of all
lines through a fixed point $\p$ and at
a fixed angle to a given line through $\p$.
\label{enum:null}
\indy{Index}{null set}%
\indy{Index}{plane}%
\indy{Index}{sphere}%
\indy{Index}{circular cone}%
\end{enumerate}
\end{lemma}
\indy{Notation}{p@$\p\in \ring{R}^3$}%

%\begin{definition}[$\equiv$]\guid{YVGRQXG}\label{def:equiv}
%Write $X\equiv Y$ when sets $X$ and $Y$ are equal up to a null set;
%that is, when there exists a null set $Z$ such that
%$(X\setminus Y) \cup (Y\setminus X) \subset Z$.
%\end{definition}
%\indy{Index}{null set}%
%\indy{Notation}{1@$\equiv$}%
%
%%\subsubsection{measurability}\label{sec:measure}



\begin{lemma}[measurable]\guid{NUKRQDI}\label{lemma:measurable}
Measurability has the following  properties:
\begin{enumerate}%[Measurable set]
\item Null sets are measurable.
\item Primitive regions are measurable (Definition~\ref{def:primitive}).
\item The union of two measurable sets is measurable.
\item The intersection of two measurable sets is measurable.
\item The difference of two measurable sets is measurable.
\label{enum:measure}
\indy{Index}{null set}%
\indy{Index}{measure}%
\indy{Index}{primitive region}%
\end{enumerate}
\end{lemma}

%\subsubsection{volume}\label{sec:volume}

\begin{lemma}[volume]\guid{ATOAPUN}\label{lemma:volume} 
% guid moved from below by thales on 01/02/2010.
Volume  has the following properties:
\indy{Index}{primitive region}%
\begin{enumerate}%[Volume]
\item \firstcase{nonnegative} The volume is defined for every measurable set.  It is
a nonnegative real number.
\item \firstcase{null set} The volume of a null set is $0$.
\item \firstcase{null difference} If $X$ and $Y$ are  measurable, and if
the \newterm{symmetric difference} of
$X$ and $Y$ is contained in a null set, then 
$X$ and $Y$ have the same volume.  
\item \firstcase{union} If $X$ and $Y$ are measurable sets, and if $X\cap
Y$ is contained in a null set, then
\[ 
\op{vol}(X\cup Y) = \op{vol}(X) + \op{vol}(Y).
\] 
\indy{Notation}{X@$X$ (measurable set)}%
\indy{Notation}{Y@$Y$ (measurable set)}%
\item \firstcase{linear stretch} For $X\subset \ring{R}^3$, and
$\v\in\ring{R}^3$, set
\[ 
T_\v(X) = \{ (v_1u_1,v_2u_2,v_3u_3) \mid \u\in X\}.
\] 
\indy{Notation}{T@$T_\v$ (linear stretch)}%
If $X$ and $T_\v(X)$ are measurable, then
$\op{vol}(T_\v(X)) = |v_1v_2v_3|\op{vol}(X)$.
\item \firstcase{translation} If $X\subset \ring{R}^3$ and $\v\in\ring{R}^3$,
then let $X+\v = \{\p + \v\mid \p\in X\}$.  If $X$ is measurable,
then $X+\v$ is as well, and $\op{vol}(X) = \op{vol}(X+\v)$.
\item \firstcase{primitives} If $X$ is a primitive region, then 
 $\op{vol}(X)$ is given by the formulas of
Lemma~\ref{lemma:prim-volume} and Lemma~\ref{lemma:wedge-vol}.  
\end{enumerate}
\end{lemma}
\indy{Index}{volume}%
\indy{Index}{linear stretch}%
\indy{Index}{translation}%
%Volume calculations of primitive regions are given in 
%Lemmas~\ref{lemma:prim-volume} and~\ref{lemma:wedge-vol}.
%% NB Don't need lemma:wedge-sol because solid of a \op{FR} is a \op{CAP}.
%% Don't need lemma:prim-sol because solds are \op{CAP} or \op{TRI}.

%\begin{lemma}[]\guid{ATOAPUN}
%\formalauthor{John Harrison}  
%Let $\op{vol}$ be the Lebesgue measure
%on $\ring{R}^3$. Let $B$ be the collection of all bounded Lebesgue
%measurable subsets of $\ring{R}^3$.  Let $N$ be the collection of all
%Lebesgue measurable subsets of $\ring{R}^3$ of measure zero.
%Then
%\begin{enumerate}\wasitemize 
%\item The collection $N$ satisfies the null set properties of
%Section~\ref{sec:null}
%\item The collection $B$ satisfies the measurability properties of
%Section~\ref{sec:measure}
%\item $\op{vol}$ on $B$ satisfies the volume properties of
%Section~\ref{sec:volume}.  \indy{Index}{measure!Lebesgue}%
%\end{enumerate}\wasitemize 
%\end{lemma}
%\indy{Notation}{B@$B$ (Lebesgue measurable subsets)}%
%\indy{Notation}{vol@$\op{vol}$}%



\section{Primitive Volume}
\indy{Index}{volume!primitive}%

This book accepts certain elementary volume calculations as assumed
background.  These volumes are called primitive volumes.  All further
volumes calculations are obtained from these through the basic
properties of measure.
% This treatment of volume is hardly about measure at all.  The focus
% is rather on the geometry of the various regions and how to
% decompose them into primitives.

To fix a convention, this book prefers to take the volume of open sets
whenever that can be arranged.  It begins with a description of some
of the primitive regions.

\subsection{radial set}\label{sec:solid}

Surface integrals are not required in this book.  Although
the \newterm{solid angle} is traditionally defined as a surface integral,
it is simpler to give an alternative definition based on volume.

\begin{definition}[ball]\guid{VSPMVNR}
 The open ball $B(\v,r)$ with center $\v$
and radius $r$ is the set
\[ 
\{ \q\in\ring{R}^3 \mid \norm{\v}{\q} < r.\}
\] 
The closed ball $\bar B(\v,r)$ is
\[ 
\{ \q\in\ring{R}^3 \mid \norm{\v}{\q} \le r.\}
\] 
\indy{Index}{open ball}%
\indy{Index}{ball, open and closed}%
\indy{Index}{closed ball}%
\indy{Notation}{B@$B(\v,r)$ (open ball)}%
\indy{Notation}{B@$\bar B(\v,r)$ (closed ball)}%
\end{definition}

\begin{definition}[radial]\guid{QPHVSMZ}
  A set $C$ is $r$-\fullterm{radial}{radial!set} at center $\v$ if the two
  conditions $C\subset B(\v,r)$ and $\v + \u \in C$ imply $\v + t \u
  \in C$ for all $t$ satisfying $0 < \normo{\u} t < r$.  A set $C$ is
  {\it eventually radial}
at center $\v$ if $C\cap B(\v,r)$ is
  $r$-radial at center $\v$ for some $r>0$.  
\end{definition}
\indy{Index}{eventually|see{radial}}%
\indy{Index}{radial!eventually}%
\indy{Notation}{C@$C$ (set)}%


\begin{lemma}[radial intersection]\guid{KODOBRF} 
  If $C$ and $C'$ are $r$-radial at $\v$, then $C\cap C'$ is also
  $r$-radial at $\v$.
\end{lemma}

\begin{lemma}[eventually radial]\guid{LBWOPAH}
If $C$ is $r$-radial for some $r>0$ then it is eventually radial.
\end{lemma}

\begin{lemma}[radial scale]\guid{PUACSHX}\label{lemma:r-r'}
\formalauthor{Nguyen Tat Thang, Nov 2008}
Assume that $C$ is measurable and $r$-radial at $\v$.  Let $0\le
r'<r$.   Then $C\cap B(\v,r')$ is measurable and $\op{vol}(C\cap
B(\v,r')) = \op{vol}(C) (r'/r)^3$.
\end{lemma}

\begin{proof}  The radial set $C$ transforms into $C\cap B(\v,r')$ by
a sequence of translations and linear stretches.
\end{proof}


\begin{definition}[solid angle]\guid{MASYUQQ}\label{def:sol}
When $C$ is measurable and eventually radial at center $\v$, 
define the \newterm{solid angle} of $C$ at $\v$ to be
\[ 
\sol(\v,C) = 3 \op{vol}(C\cap B(\v,r))/r^3,
\] 
where $r$ is as in the definition of eventually radial. 
By Lemma~\ref{lemma:r-r'}, this
definition is independent of any such $r$.  When the center $\v$ is
clear from the context, write $\sol(C)$ for
$\sol(\v,C)$.
\indy{Index}{solid angle}%
\indy{Notation}{solid@$\sol$ (solid angle)}%
\end{definition}


\begin{lemma}[solid angle]\guid{VQFENMT}
If $C$ is measurable and $r$-radial at $\v$, then the volume of $C$
satisfies
\[ 
\op{vol}(C) = \sol(\v,C) r^3/3.
\] 
Moreover,
if $C$ is bounded away from $\v$, then $C$ is eventually radial at
$\v$, and $\sol(\v,C) = 0$.
\indy{Index}{radial}%
\end{lemma}

\begin{proof}
These properties follow immediately from the definitions.
\end{proof}



\subsection{wedge}
\indy{Index}{wedge}%


\begin{definition}[wedge]\guid{NIQRVNM}\label{def:wedge}
Assume that $\v_0\ne \v_1$ and that
$\w_1$ and $\w_2$ do not lie on
the line $\op{aff}\{\v_0,\v_1\}$.  
\begin{align*}
W^0(\v_0,\v_1,\w_1,\w_2) &= 
\{\p %\not\in\op{aff}\{\v_0,\v_1\} 
\mid 
0< \op{azim}(\v_0,\v_1,\w_1,\p) < \op{azim}(\v_0,\v_1,\w_1,\w_2)\},\\
W(\v_0,\v_1,\w_1,\w_2) &= 
\{\p \mid 
0\le \op{azim}(\v_0,\v_1,\w_1,\p) \le \op{azim}(\v_0,\v_1,\w_1,\w_2)\}.\\
\end{align*}
Both sets are called \fullterm{wedges}{wedge}.
\end{definition}

\begin{definition}[lune]\guid{MVIADQK}\label{def:lune}
  The set $\op{aff}^0_+(\{\v_0,\v_1\},\{\v_2,\v_3\})$, called a
  \newterm{lune}, is given in Definition~\ref{def:aff}.  It is the
  intersection of two open half-spaces
\[ 
\op{aff}^0_+(\{\v_0,\v_1\},\{\v_2,\v_3\})
=\op{aff}^0_+(\{\v_0,\v_1,\v_2\},\v_3)\cap
\op{aff}^0_+(\{\v_0,\v_1,\v_3\},\v_2).
\] 
\end{definition}
\indy{Notation}{aff2@$\op{aff}_{\pm}$, $\op{aff}^0_{\pm}$}%


A lune is a special case of a wedge, restricted to have an azimuth
angle less than $\pi$.  To specify a lune, the ordering of
$\{\v_2,\v_3\}$ is irrelevant, just as it is in the dihedral angle
$\dih(\{\v_0,\v_1\},\{\v_2,\v_3\})$.  To specify a wedge, the ordering
of $(\v_0,\v_1,\w_1,\w_2)$ does matter.  A reversal of $(\w_1,\w_2)$
complements the wedge (up to the shared boundary).  The next lemma
shows that a lune is indeed a special case of a wedge.
%A lune has a dihedral angle  between $0$ and $\pi$.   
%For angles that are larger than $\pi$,   
%a wedge $W^0(\v_0,\v_1,\w_1,\w_2)$ is used instead of the lune.  
\indy{Index}{lune}%
\indy{Index}{half-space}%
\indy{Index}{angle!dihedral}%
\indy{Index}{wedge}%
\indy{Notation}{dih}%
\indy{Notation}{W@$W^0$ (wedge)}%

\begin{lemma}[lune~wedge]\guid{VICUATE} 
  Let $\{\v_0,\v_1,\v_2,\v_3\}$ be a set of four points in
  $\ring{R}^3$.  Assume that the set is not coplanar.  Assume that
  $\op{azim}(\v_0,\v_1,\v_2,\v_3)<\pi$.  Then,
\[ W^0(\v_0,\v_1,\v_2,\v_3) =
\op{aff}^0_+(\{\v_0,\v_1\},\{\v_2,\v_3\}).\] 
\indy{Index}{coplanar}%
\end{lemma}


\subsection{primitive types}

%\subsubsection{tetrahedron}
\indy{Index}{tetrahedron}%

\begin{definition}[tetrahedron]\guid{XRRLDYK}
 A tetrahedron is a set of the form
\[ \op{TET}\{\v_1,\v_2,\v_3,\v_4\} = 
\op{aff}^0_+(\emptyset,\{\v_1,\v_2,\v_3,\v_4\}).\] 
\indy{Index}{tetrahedron}%
\end{definition}
\indy{Notation}{TET (tetrahedron)}%


%\subsubsection{solid triangle}
\indy{Index}{solid triangle}%

\begin{definition}[solid triangle]\guid{OWTPAPZ}
 The \newterm{solid triangle}
$\op{TRI}(\v_0,V,r)$ is determined by $\v_0\in\ring{R}^3$, a 
set $V=\{\v_1,\v_2,\v_3\}\subset\ring{R}^3$, and a radius $r\ge0$:
\[ 
\op{TRI}(\v_0,V,r) = 
B(\v_0,r)\cap \op{aff}_+(\v_0,V).
\] 
%(Usually, $V=\{\v_1,\v_2,\v_3\}$, and this accounts for
%the term \newterm{triangle}.)
\indy{Index}{solid triangle}%
\indy{Notation}{TRI@$\op{TRI}$ (solid triangle)}%
%\indy{Notation}{r@$r$ (radius)}%
\indy{Notation}{r@$r$ (polar, cylindrical, and spherical radius)}%
\end{definition}




%\subsubsection{frustum}
\indy{Index}{frustum}%

\begin{definition}[rcone]\guid{UJAARGK}\label{def:p:rcone}
%\label{def:rcone} % from Tarski collection..
\indy{Index}{cone!right-circular}%
Define the following collection of right-circular cones.
If $\v$ and $\w$ are points in $\ring{R}^3$, and
$h\in\ring{R}$, then set
\begin{align*}
\op{rcone}(\v,\w,h) 
&= \{\p\mid (\p-\v)\cdot (\w-\v) \ge \norm{\p}{\v}\,\norm{\w}{\v} h\},\\
\op{rcone}^0(\v,\w,h) 
&= \{\p\mid (\p-\v)\cdot (\w-\v) > \norm{\p}{\v}\,\norm{\w}{\v} h\}.\\
\end{align*}
\end{definition}
\indy{Notation}{rcone@$\op{rcone},~\op{rcone}^0$}%
\indy{Notation}{v7@$\v\in\ring{R}^3$}%
\indy{Notation}{wi@$\w\in\ring{R}^3$}%


\begin{definition}[frustum, FR]\guid{OSOVFFQ}
 The frustum
$\op{FR}(\v_0,\v_1,h',h,a)$ is specified by an apex
$\v_0\in\ring{R}^3$, heights $0\le h'\le h$, a vector $\v_1-\v_0$
giving its direction, and $a\in[0,1]$. The set $\op{FR}$ is given as
\[ 
\{ \p \in\op{rcone}^0(\v_0,\v_1,a) \mid \ 
h'\norm{\v_1}{\v_0} < (\p-\v_0) \cdot (\v_1-\v_0) < h\norm{\v_1}{\v_0} \}.
\] 
\indy{Index}{frustum}%
\indy{Notation}{frustum@$\op{FR}$ (frustum)}%
%\indy{Notation}{vapex@${\mathbf v}_0$ (apex)}%
\indy{Notation}{v7@$\v\in\ring{R}^3$}%
%\indy{Notation}{v1@${\mathbf v}_1$ (vector)}%
%\indy{Notation}{v0@${\mathbf v}_0$ (vector)}%
\end{definition}

That is, the frustum is the part of a right-circular cone between two
parallel planes that cut the axis of the cone at a right angle.  When
$h'=0$, the frustum extends to the apex of the cone.  When $h'=0$, it
is dropped from the notation:
$\op{FR}(\v_0,\v_1,h,a)=\op{FR}(\v_0,\v_1,0,h,a)$.

%\subsubsection{conic cap}
\indy{Index}{conic cap}%

% renamed from spherical cap.

\begin{definition}[conic cap]\guid{IQJNKRA}
The conic cap $\op{CAP}(\v_0,\v_1,r,a)$ is specified by an apex
$\v_0\in\ring{R}^3$,  radius $r\ge0$,  nonzero vector $\v_1-\v_0$ giving
direction, and constant $a$.  The conic cap is the intersection of
the ball $B(\v_0,r)$ with a solid right-circular cone:
\[ 
\op{CAP}(\v_0,\v_1,r,a)=\{\p \in B(\v_0,r) 
\mid (\p-\v_0)\cdot (\v_1-\v_0) > \norm{\p}{\v_0}\, \norm{\v_1}{\v_0}\, a\}.
\] 
\indy{Index}{conic cap}%
\indy{Index}{apex}%
%\indy{Index}{cone}%
\indy{Notation}{CAP@$\op{CAP}$}%
\end{definition}


\begin{remark}[quadratic solids]\guid{JFKYUIE}
  By Tarski arithmetic, %tarski: {hedra-tope},
  a tetrahedron can also be described as the intersection of four open
  half-spaces. Moreover,  all of
  the three-dimensional solids that have just been defined are
  described by linear and quadratic constraints.  
\indy{Index}{Tarski    arithmetic}%
\end{remark}

\figHFHVHSV % fig:primitive.


%\subsubsection{primitive}
\indy{Index}{primitive region}%

\begin{definition}[primitive]\guid{UGDOENP}\label{def:primitive} 
A \newterm{primitive region} (Figure~\ref{fig:primitive}) is any of the following:

\begin{enumerate}%%[Primitive Volumes]
\item A rectangle 
\[ 
\op{RECT}(a,b)=\{\p \mid a_i < p_i < b_i,\text { for } i=1,2,3.\}.
\] 
\item A tetrahedron $\op{TET}\{\v_0,\v_1,\v_2,\v_3\}$.
\item A solid triangle $\op{TRI}(\v_0,\{\v_1,\v_2,\v_3\},r)$.
\indy{Notation}{TRI@$\op{TRI}$ (solid triangle)}%
\item A frustum or a wedge of a frustum:
\[ 
\op{FR}(\v_0,\v_1,h_1,h_2,a) \cap W^0(\v_0,\v_1,\v_2,\v_3).
\] 
\item A conic cap or a wedge of a conic cap: 
\[ 
\op{CAP}(\v_0,\v_1,r,c) \cap W^0(\v_0,\v_1,\v_2,\v_3).
\] 
\item A ball or a wedge of a ball
\[ 
B(\v_0,r) \cap W^0(\v_0,\v_1,\v_2,\v_3).
\] 
\indy{Index}{solid triangle}%
\indy{Index}{tetrahedron}%
\indy{Index}{wedge}%
\indy{Index}{frustum}%
\indy{Index}{conic cap}%
\indy{Index}{rectangle}%
\indy{Index}{ball}%
%\indy{Index}{ellipsoid}%
\label{enum:volume-prim}
\end{enumerate}
The set of primitives is not minimal.  In particular, the
rectangle is a union of tetrahedra, and the wedge of a ball is a union of
solid triangles (up to a null set).
%But this would only make the definition more difficult to apply.

\end{definition}

\subsection{volume calculations}\label{sec:primitive}

\begin{lemma}[primitive volume]\guid{PAZNHPZ}\label{lemma:prim-volume} 
\begin{enumerate} 
\item A rectangle $\op{RECT}(a,b)$
has volume $0$ unless $a_i<b_i$ for all $i$.  In this case, the
volume is
\[ (b_3-a_3)(b_2-a_2)(b_1-a_1).\] 
\item A tetrahedron $\op{TET}\{\v_1,\v_2,\v_3,\v_4\}$
has volume
\[ 
\sqrt{\Delta(x_{12},x_{13},x_{14},x_{34},x_{24},x_{23})}/12,
\] 
where $x_{ij} = \norm{\v_i}{\v_j}^2$.
\item  Let $\v_1,\v_2,\v_3$ be unit vectors.  A solid
triangle $\op{TRI}(\v_0,\{\v_1,\v_2,\v_3\},r)$ has
volume
\[ 
(\alpha_1+\alpha_2+\alpha_3-\pi)r^3/3,
\] 
where $\alpha_i = \dih_V(\{\v_0,\v_i\},\{\v_j,\v_k\})$.
\item  The frustum $\op{FR}(\v_0,\v_1,h,a)$ (with $h'=0$) 
has volume
\[ 
\pi (t^2-h^2) h/3,\quad h = t a.
\] 
\item  The conic cap $\op{CAP}(\v_0,\v_1,r,a)$
has volume
\[ 
2\pi(1-a) r^3/3.
\] 
\item The ball $B(\v_0,r)$ has volume
% with a wedge
%$W^0(\v_0,\v_1,\v_2,\v_3)$ is measurable.  The volume of the intersection
%is 
\[ 
4\pi r^3/3,\text{ when } r \ge 0,
\] 
%where $\theta = \op{azim}(\v_0,\v_1,\v_2,\v_3)$.
\end{enumerate}
\end{lemma}



We do not give a proof of Lemma~\ref{lemma:prim-volume}.  It is part 
of the background in measure theory assumed at the beginning of the chapter.
(The enumeration of background properties of volume in 
Lemma~\ref{lemma:volume} makes a forward
reference to Lemma~\ref{lemma:prim-volume}.)  The measurability
of these primitive regions is also part of the background assumptions.
An incomplete sketch of the lemma follows.

\begin{proof}[Proof sketch]
The volume of a tetrahedron is
\[ 
|\det(\v_2-\v_1,\v_3-\v_1,\v_4-\v_1)|/6.
\] 
Cayley and Menger evaluated the square of this determinant (See
Section~\ref{sec:piped}).  The square is $\Delta/4$, with
$\Delta\ge0$.  
\indy{Index}{Cayley-Menger!determinant}%
\indy{Index}{determinant!Cayley-Menger}%

The formula for the volume of a solid triangle is $r^3/3$ times
its solid angle.  Girard's formula
\begin{equation} 
\alpha_1+\alpha_2+\alpha_3-\pi\label{eqn:girard}
\end{equation}
for the area of a spherical triangle is classical
(Figure~\ref{fig:abcmpi}).  Euler's formula (Lemma~\ref{lemma:euler})
gives another formula for the area, which is sometimes more
convenient.
%
\indy{Index}{Euler's formula for solid angle}%
\indy{Index}{Girard's formula}%

\figLWQUMHN % fig:abcmpi

The volume of a right-circular cone, $1/3$ its base area times height,
has been known from antiquity.  

\figWQBMWZO % fig:tarskislice

The conic cap volume is $r^3/3$ times its solid angle, which computed
as a surface of revolution for the curve $x^2 + y^2 = 1$
(Figure~\ref{fig:tarskislice}):
\[ 
2\pi \int_a^1  \abs{y} \sqrt{1 + (y')^2}\,dx 
= 2\pi\int_a^1  \abs{y} \sqrt{1/y^2}\,dx 
= 2\pi \int_a^1\,dx = 2\pi (1-a).\qedhere
\]
\end{proof}



%\subsubsection{wedge}\label{sec:wedge}
\indy{Index}{wedge}%

When the region is realized by revolution along an axis
$\op{aff}\{\v_0,\v_1\}$, we can also give the volume of the
intersection of the region with a wedge
$W^0=W^0(\v_0,\v_1,\v_2,\v_3)$.  These intersections are measurable by
the last statement of Lemma~\ref{lemma:prim-volume} (with $r$
sufficiently large).  In the following let $\theta =
\azim(\v_0,\v_1,\v_2,\v_3)$.  
%\indy{Notation}{zzh@$\theta$ (azimuth)}%
%\indy{Notation}{zzh@$\theta$ (polar, cylindrical, and spherical coordinate)}%
\indy{Notation}{zzh@$\theta$ (polar, cylindrical, and spherical angle)}%


\begin{lemma}[wedge volume]\guid{DFNVMFM}\label{lemma:wedge-vol}  
Let $C$ be $\op{CAP}(\v_0,\v_1,r,a)$, $B(\v_0,r)$,  
or $\op{FR}(\v_0,\v_1,h,a)$.  Let $m$ be the volume of $C$.  Then
$C\cap W^0$ has volume $m\,\theta/(2\pi)$.
\end{lemma}
\indy{Notation}{C@$C$ (wedge)}%

This lemma is also part of the assumed background material on volumes,
cited at the beginning of the chapter in Lemma~\ref{lemma:volume}.
Of course, these are elementary integrals.

%\subsection{solid angle calculations}

All of the primitive regions (except the rectangle) 
are eventually radial at the natural
base point $\v_0$ and have a
solid angle.  In fact, the intersection of any primitive region (again except
the rectangle) with a small ball at $\v_0$ is again a primitive region.  Thus,
the earlier volume calculations immediately yield solid angle formulas as well.
%By Lemma~\ref{lemma:wedge-sol}, it is enough to compute
%the solid angle before intersecting with a wedge.
%\indy{Notation}{v0@$\v_0$ (base point)}%
\indy{Notation}{v7@$\v\in\ring{R}^3$}%

\begin{lemma}[primitive solid angle]\guid{FUPXNLC} \label{lemma:prim-sol}
\begin{enumerate}
\item $\op{TET}\{\v_0,\v_1,\v_2,\v_3\}$ is eventually radial at $\v_0$
with solid angle
\[ 
(\alpha_1+\alpha_2+\alpha_3-\pi),\quad
\alpha_i=\dih_V(\{\v_0,\v_i\},\{\v_j,\v_k\}).
\] 
\item  $\op{TRI}(\v_0,\{\v_1,\v_2,\v_3\})$ is eventually radial at $\v_0$
with solid angle 
\[ 
(\alpha_1+\alpha_2+\alpha_3-\pi),\quad
\alpha_i=\dih_V(\{\v_0,\v_i\},\{\v_j,\v_k\}).
\] 
\item $\op{FR}(\v_0,\v_1,h,a)$ is eventually radial at $\v_0$ with solid
angle        $2\pi (1-a)$.
\item $\op{CAP}(\v_0,\v_1,r,a)$ is eventually radial at $\v_0$ with solid
angle 
$2\pi(1-a)$.
\item $B(\v_0,r)$ is eventually radial at $\v_0$ with solid
angle 
$4\pi$.
\indy{Index}{radial!eventually}%
\end{enumerate}
\end{lemma}
\indy{Notation}{CAP@$\op{CAP}$}%
\indy{Notation}{frustum@$\op{FR}$ (frustum)}%
\indy{Notation}{zza@$\alpha$ (angle)}%
\indy{Notation}{dih}%

\begin{proof} In every case, the intersection of 
the region with $B(\v_0,r')$, for $r'>0$ sufficiently small, is a ball,
a conic cap, or a solid triangle.  These two volumes have
already been calculated.  This gives the results as stated.
\end{proof}

\begin{lemma}[wedge solid angle]\guid{FMSWMVO}\label{lemma:wedge-sol}  
Let $C$ be either $\op{CAP}(\v_0,\v_1,r,a)$, $B(\v_0,r)$, or
$\op{FR}(\v_0,\v_1,h,a)$.  Then $C$ and $C\cap W^0$ are eventually
radial at $\v_0$. Furthermore, $C\cap W^0$ has solid angle
$s\,\theta/(2\pi)$, where $s$ is the solid angle of $C$.
\end{lemma}

\begin{proof} The intersection of $C\cap W^0$ is one of the primitive
  regions with a solid angle that has already been calculated in
  Lemma~\ref{lemma:wedge-vol}.
\end{proof}

\section{Finiteness and Volume}\label{sec:finiteness}

Previous sections have developed all of the volume calculations that are
 needed in this book.  This chapter concludes with some 
elementary estimates based on the volumes of  cubes and balls.

\begin{lemma}[]\guid{WQZISRI}
\formalauthor{Nguyen Tat Thang}
\label{lemma:Zcount}
For all $\p\in\ring{R}^3$ and all $r\ge 0$, the set
$\ring{Z}^3\cap B(\p,r)$ is finite of cardinality at most
$4\pi (r+\sqrt3)^3/3$.
\indy{Index}{cardinality!finite}%
\end{lemma}

\begin{proof}  If $\v\in\ring{Z}^3\cap B(\p,r)$, then the ith
coordinate $v_i$ of $\v$ must lie in the finite range
\[ 
p_i - r \le v_i \le p_i + r.
\] 
Hence, there are only finitely many possibilities for $\v$.


Place an open unit cube at each point of $\ring{Z}^3\cap B(\p,r)$.
The cubes are measurable, disjoint, and contained in
$B(\p,r+\sqrt3)$.  Thus, the combined volume of the cubes, which is
$\card(\ring{Z}^3\cap B(\p,r))$,  is no greater than the volume of the
containing ball.  The result ensues.
\end{proof}

\begin{lemma}[]\guid{PWVIIOL}
\formalauthor{Nguyen Tat Thang}
\label{lemma:Zlow-count}
For all $\p\in\ring{R}^3$ and all $r\ge\sqrt3$, the set
$\ring{Z}^3\cap B(\p,r)$ is finite of cardinality at least
$4\pi (r-\sqrt3)^3/3$.
\end{lemma}

\begin{proof} Lemma~\ref{lemma:Zcount} establishes finiteness.  Place
a closed unit cube at each point of $\ring{Z}^3\cap B(\p,r)$.  The
cubes are measurable and cover $B(\p,r-\sqrt3)$.  Thus, the combined
volume of the cubes is at least the volume of the covered ball.  The
result ensues.
\end{proof}

\begin{lemma}[lattice shell]\guid{TXIWYHI}
\formalauthor{Nguyen Tat Thang}
\label{lemma:Zr2}
For all $\p\in\ring{R}^3$ and all $r_0,r_1>0$, there exists a $C$ such
that for all $r\ge r_1$, 
\[ 
\card(\ring{Z}^3 \cap (B(\p,r+r_0) \setminus B(\p,r-r_1))) \le C r^2.
\] 
\end{lemma}

\begin{proof}  When $r \ge r_1+\sqrt3$, the previous two lemmas show
that the cardinality is at most $4\pi/3$ times
\[ 
(r +r_0 + \sqrt3)^3 - (r - r_1 - \sqrt3)^3 \le C' r^2
\] 
for some $C'$.  Similarly, if $r_1\le r\le r_1+\sqrt3$, the
cardinality is at most some fixed constant $C''$.  The result
 ensues.
\end{proof}

