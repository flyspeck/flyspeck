% File added May 15, 2012

%\chapter{Supplementary Notes}\label{sec:supplement}

\newpage
\section{Appendix on the main estimate}\label{sec:sup-local-fan}

This appendix gives further details about the proof of the main estimate.
It contains numerous improvements over the published text of
{\it Dense Sphere Packings}.
The verification of the main estimate can be
viewed as a combinatorial proof that $\smain\Ra \sterm$.  

\subsection{statement of results}\label{sec:statement'}

This appendix largely replaces Section~\ref{sec:weight}.
For completeness, we repeat a few definitions and results.



\begin{definition}[$\hm$,~$\tau$]\guid{CUFCNHB}\label{def:tau}
\formaldef{$\rho_0$}{rho\_fun}
\formaldef{$\rho_0$}{rho}
\formaldef{$\tau$}{tau\_fun}
\formaldef{$\sol_0$}{sol0}
\formaldef{$\hm$}{h0}
\formaldef{$\azim$}{azim\_in\_fan}
Let $(V,E,F)$ be a nonreflexive local fan.  Recall that $\hm = 1.26$ and
$L(h) = ({h_0-h})/({h_0-1})$, when $h \le h_0$.
  Set
\begin{align*}
\rho_0(y) &= 1 + \dfrac{\sol_0}{\pi} \cdot
    \dfrac{y-2}{2\hm-2} = 1 + \dfrac{\sol_0}{\pi}(1 - L(y/2))\\
  \tau(V,E,F) &=\sum_{x\in F}^{\phantom{!}} \rho_0(\normo{\nd(x)})\op{azim}(x)
+ \left(\pi+{\sol_0}\right) (2- k(F))\\
 &= \sum_{\v\in V} \rho_0(\normo{\v}) \angle (\v) + \left(\pi+{\sol_0}\right) (2- \card(V)),
\end{align*}
where $\sol_0=3\arccos(1/3)-\pi\approx0.551$ is the solid angle of a
spherical equilateral triangle of side $\pi/3$, and $k(F)$ is the
cardinality of $F$.  
\end{definition}

\begin{definition}[$\tau_{tri}$,~$\tau_3$,~,~$\dih_i$]
\formaldef{$\tau_{tri}$}{taum}
  We define additional functions in the case $k=3$.
If $\op{card}(V) = 3$, then write $V =\{\v_1,\v_2,\v_3\}$.  Set
\[
\tau_3(V) = \sum_{i=1}^3 \rho_0(\normo{\v_i}) \dih_V\{\orz,\v_i\}\{\v_{i+1},\v_{i+2}\} - (\pi + \sol_0).
\]
Let 
\begin{equation}\label{eqn:tautri}
  \tau_{tri}(y_1,y_2,y_3,y_4,y_5,y_6) =
  \sum_{i=1}^3 \rho_0(y_i) \dih_i(y_1,\ldots,y_6)
- \left(\pi+{\sol_0}\right),
\end{equation}
where
\begin{align}\label{eqn:dihi}
\dih_1(y_1,y_2,y_3,y_4,y_5,y_6) &= \dih(y_1,y_2,y_3,y_4,y_5,y_6),\notag\\
\dih_2(y_1,y_2,y_3,y_4,y_5,y_6) &= \dih(y_2,y_3,y_1,y_5,y_6,y_4),\textand\notag \\
\dih_3(y_1,y_2,y_3,y_4,y_5,y_6) &= \dih(y_3,y_1,y_2,y_6,y_4,y_5).
\end{align}
\indy{Notation}{h@$h_0 = 1.26$}%
\indy{Notation}{zzt@$\tau_{tri}$}%
\indy{Notation}{zzt@$\tau$ (weight assignment)}%
\indy{Notation}{zzrho1@$\rho_0$ (real-valued function)}%
\indy{Notation}{sol0@$\sol_0 = 3\arccos(1/3)-\pi$}%
\indy{Notation}{dih@$\dih_i$}%
\indy{Notation}{L@$L$ (linear function)}%
\end{definition}


\begin{definition}[standard,~protracted,~diagonal]\guid{KRACSCQ} 
\formaldef{standard}{standard (deprecated)}
\formaldef{protracted}{protracted (deprecated)}
\formaldef{diagonal}{diagonal0 (deprecated)}
Let $(V,E)$ be a fan.  
We write $\normo{\ee}$ for $\norm{\v}{\w}$, when $\ee=\{\v,\w\}\subset V$.
We say that  $\ee$ is \newterm{standard} if
\[
2\le \normo{\ee}\le2\hm.
\]
We say that  $\ee$ is \newterm{protracted} if
\[
2\hm\le \normo{\ee}\le\sqrt{8}.
\]
If $\v,\w\in V$ are distinct, and $\ee=\{\v,\w\}$ is not an edge in $E$, then
we call $\ee$ a \newterm{diagonal} of the fan.
\end{definition}
%\indy{Notation}{4@$\norm{\wild}$ (norm of fan edge)}% % doesn't parse


\begin{theorem}[main~estimate]\guid{JEJTVGB}\label{lemma:main-estimate}
\formaldef{\case{annulus}}{ball\_annulus}
\formaldef{main estimate}{main\_estimate (deprecated)}
\formaldef{\case{diagonal}}{diagonal1 (deprecated)}
\formaldef{\wild}{check:quad\_std\_cs, pent\_std\_cs, hex\_st\_cs, pent\_diag\_cs, pent\_pro\_cs, }
%\label{theorem:main}
Let $(V,E,F)$ be a nonreflexive local fan (Definition~\ref{def:convex-local}).
We make the following additional
assumptions on $(V,E,F)$.
\begin{enumerate}
\item \case{packing} $V$ is a packing.  
\item \case{annulus} $V\subset \BB$.
\item \case{diagonal} If $\{\v,\w\}$ is a diagonal,  then 
\[ 
\norm{\v}{\w}\ge 2\hm.
\] 
\item \case{card} 
Let   $k=\card(E)=\card(F)$.  Then $3\le k \le 6$.
\end{enumerate}
In this context, we have the following conclusions.
\begin{enumerate}
\item Assume $k\ge 3$.  If  every edge of $E$ is standard, then
\[ 
\tau(V,E,F) \ge
\begin{cases}
  0.0,&\text{if }k=3,\\
  0.206,&\text{if }k=4,\\
  0.4819,&\text{if }k=5,\\
  0.712,&\text{if }k=6.
\end{cases}
\] 
\item Assume $k=5$.  Assume that every edge of $E$ is standard.
Assume that every diagonal $\ee$ of the fan satisfies $\normo{\ee}\ge\sqrt{8}$.
Then 
\begin{equation}
\tau(V,E,F)\ge 0.616. \tag{check:pent\_diag\_cs}
\end{equation}
\item Assume $k=5$.  Assume there exists some protracted edge in $E$ 
and that the other four edges are standard.  Then 
\begin{equation}
\tau(V,E,F)\ge 0.616. \tag{check:pent\_pro\_cs}
\end{equation}
\item Assume that $k=4$.  Assume that there exists some protracted
 edge in $E$ and that the other three edges are standard.  
Assume that both diagonals $\ee$ of the fan satisfy $\normo{\ee}\ge\sqrt{8}$.
Then
\begin{equation}
\tau(V,E,F)\ge 0.477. \tag{check:quad\_pro\_cs}
\end{equation}
%% XX condition on diags >= sqrt8 added 2012-5-20.
%% based on the semantics of glpk/tame_archive/head.mod.
%\item Assume $k=3$. Then
%\begin{equation}
%\tau(V,E,F)\ge 0.\tag{check:tri\_std\_cs}
%\end{equation}
\item Assume $k=4$.  Assume that every edge of $E$ is standard.
Assume that both diagonals $\ee$ of the fan satisfy $\normo{\ee}\ge3$.
Then
\begin{equation}
\tau(V,E,F)\ge 0.467.\tag{check:quad\_diag\_cs}
\end{equation}
%\item Assume $k=3$. Then
%\begin{equation}
%\tau(V,E,F)\ge 0.\tag{check:tri\_std\_cs}
%\end{equation}
\end{enumerate}
\end{theorem}

%% Merged with Main Estimate on 2013-03-01.
%There are two related inequalities that we will prove separately. For that reason,
%we state them as a separate lemma.
%
%\begin{lemma}\guid{HGDRXAN}\label{lemma:tau3}
%Let $(V,E,F)$ be a nonreflexive local fan.
%Under the same hypotheses on $(V,E,F)$ as in Theorem~\ref{lemma:main-estimate}, 
%\begin{enumerate}
%
%\end{enumerate}
%\end{lemma}


\subsection{definitions}


\begin{definition}[torsor,~adjacent]\guid{XCZLSVS}
%\formaldef{$\cstab$}{cstab}
\formaldef{torsor}{torsor}
  Let $k>1$ be an integer.  A \newterm{torsor} is a set $I$ with a
  given simply transitive action of $\ring{Z}/k\ring{Z}$ on $I$.  We
  write the application of $j\in\ring{Z}/k\ring{Z}$ to $i\in I$ as
  $j+i$ or $i+j$.  We also write $j+i$
  for the application of the image of $j\in\ring{Z}$ in $\ring{Z}/k\ring{Z}$ to
  $i\in I$.  Note that each choice of base point $i_0\in I$ gives a
  bijection $i\mapsto i+i_0$ between $\ring{Z}/k\ring{Z}$ and $I$.  
  We say that $i$ and $j$ are \newterm{adjacent} if $i= j+ 1$ or $j=i+1$.
  %If $i,j\in I$, write 
  %\[
  %|i-j|_0 = \min\left \{ |m-n| \mid m + i = n +j,\ m,n\in\ring{Z}\right \}.
  %\]
When $i$ and $j$ are adjacent, we call $\{i,j\}$ an edge of $I$.
 A \newterm{diagonal} is a pair $\{i,j\}\subset I$
such that $\{i,j\}$ is not a singleton and not an edge.
\indy{Notation}{I@$I$ (torsor)}%
\end{definition}

\begin{definition}\guid{TEQQCLX}
 The \newterm{opposite} $I'$ of a torsor $I$ is the torsor with the
same underlying set and the action is composed with the group automorphism
$\ring{Z}/k\ring{Z}\to\ring{Z}/k\ring{Z}$, sending $i\mapsto -i$.
  An
  \fullterm{isomorphism of torsors}{isomorphism!torsor} 
 is a bijection that respects the action.
Two torsors are \newterm{equivalent} if they are isomorphic or if 
one is isomorphic to the opposite of the other.
\end{definition}


\begin{example} If $H=(D,e,n,f)$ is a hypermap with face $F$,
then $F$ is a torsor under the action $x \mapsto f x$.  If $H$ is
isomorphic to $\op{Dih}_{2k}$ and has vertex set $V$, then $V$ is a torsor
under the action of $x\mapsto \rho x$, for some $\rho$ similar to
 $\rho_{(V,E,F)}$.  We may mostly restrict our attention to
these instances of torsors.
\end{example}

% XX stab. May 17, 2012.  Dropped the constraint a_{ij}\le \stab.
% It doesn't hold for one of the quad terminal SCSs:
% 1637868761 has diag at least 3.41.

% March 2013. Merged constraint system and SCS.
%(We merge the definitions of stable,  tri-stable, and augmented
%(augmented) from earlier versions.)
% renamed augmented -> substandard, then mreged with stable.

Recall that $\stab=3.01$.

\begin{definition}[stable~constraint~system]\guid{ZGFHNKX}
\formaldef{constraint system}{constraint\_system}
\formaldef{stable constraint system}{stable\_system}
\formaldef{$(k,a,b,d,I,J,+1)$}{(k\_sy,a\_sy,b\_sy,d\_sy,I\_sy,J\_sy,f\_sy)}
\formaldef{tri-stable}{tri\_stable}
\formaldef{$(a,b,d,k,I,J,+1)$}{$(a\_ts,b\_ts,d\_ts,k\_ts,I\_ts,J\_ts,f\_ts)$}
\formaldef{substandard (stable)}{augmented\_constraint\_system1}
\formaldef{substandard (tri-stable)}{augmented\_constraint\_system2}
%
A \newterm{stable constraint system} $s$ (or \newterm{SCS} for short)
consists of the following data subject
to conditions listed below.
\begin{enumerate}
\item a natural number $k\in \{3,4,5,6\}$,
\item a $\ring{Z}/k\ring{Z}$-torsor $I$,
\item a real number $d$,
\item real constants $a_{ij}$, $b_{ij}$, $\alpha_{ij}$, $\beta_{ij}$, for $i,j\in I$.
\item a set of edges $J\subset  I\{ \{i,1+i\} \mid i\in I\}$, 
\item subsets $I_{lo}$, $I_{hi}$, $I_{str} \subset I$.
\end{enumerate}
The data is subject to the following conditions.
\begin{enumerate}
\item $d < 0.9$,
\item 
   $a_{ij} = a_{ji}$, $b_{ij}=b_{ji}$, $\alpha_{ij}=\alpha_{ji}$, $\beta_{ij}= \beta_{ji}$,   for $i,j\in I$.
\item 
$a_{ij}\le \alpha_{ij}\le \beta_{ij}\le b_{ij}$,
 for $i,j\in I$,
\item 
\[
0 = a_{ii}\text{ and } 2\le a_{ij} \text{ for all }  i,j\in I \text{ such that } i\ne j.
\]  
\item
  Also, 
\[
   ~\quad \begin{cases}
    b_{i,i+1} < 4, & \text{if } k = 3\\
    b_{i,i+1}\le \stab, & \text{if } k > 3.
    \end{cases}
\]  
\item
If $\{i,j\}\in J$, then $\leftclosed
  a_{ij},b_{ij}\rightclosed=\leftclosed\sqrt{8},\stab\rightclosed$.
\item  $m+k\le 6$, where 
$m$ is the number of edges $\{i,i+1\}\subset I$ such that
$b_{i ,i+1}> 2h_0$ or $a_{i ,i+1}>2$. In particular, $\card(J)+k\le 6$.
\end{enumerate}
\indy{Notation}{J@$J$}%
\indy{Notation}{m@$m(s)$ (number of nonstandard edges)}%
\end{definition}

For each SCS $s$, we write $k(s)$,
$d(s)$, $I(s)$, $a_{ij}(s)$, and so forth for the associated
parameters.   We simply write $k$, $d$, and so forth when there is a single
SCS $s$ in a given context.



%% Merged above.
%\begin{definition}\guid{ZBJCZHI} \guid{RIUGHVX} 
%We say that a constraint system $s$ is \newterm{stable} if the following
%additional properties hold.
%\begin{enumerate}
%\end{enumerate}
%
%\end{definition}

\begin{definition}[unadorned,~basic]\guid{SDJTENL}
We say that a SCS $s$ is \newterm{unadorned} if the following additional
properties hold (with established notation):
\begin{enumerate}
\item For all $i,j\in I(s)$,  $a_{ij}(s)=\alpha_{ij}(s)$ and $b_{ij}(s)=\beta_{ij}(s)$.
\item $I_{lo}(s)=I_{hi}=I_{str}(s)=\emptyset$.
\end{enumerate}
We say the SCS $s$ is \newterm{basic} if it is unadorned and $J(s)=\emptyset$.
\end{definition}

Intuitively, we think of the SCS as involving both {\it hard} and {\it
  soft} constraints.  The soft constraints are those that involve the
adornments $\alpha_{ij}$, $\beta_{ij}$, $I_{lo}$, $I_{hi}$, $I_{str}$.

\begin{example}\label{ex:extend-cs} 
We may always transform a SCS $s$ into another $s'$ that is unadorned by
setting $\alpha_{ij}(s')=a_{ij}(s)$, $\beta_{ij}(s')=b_{ij}(s)$, $I_{lo}(s')=I_{hi}(s')=I_{str}(s')=\emptyset$, and
keeping the rest of the data the same.
\end{example}


\begin{definition}[ear] \guid{HVFQIBQ}
\formaldef{$a_{ij}$}{a\_ear0}
\formaldef{$b_{ij}$}{b\_ear0}
\formaldef{ear}{ear\_sy}
We have an unadorned SCS $s$ given by
$k=3$, $d=0.11$, $J$ a singleton, 
and
\[
\leftclosed a_{ij},b_{ij}\rightclosed=
\begin{cases}
 \leftclosed0,0\rightclosed,
 &\text{~~if } i=j,\\
 \leftclosed\sqrt8,\stab\rightclosed,
 &\text{~~if } \{i,j\} \in J,\\
 \leftclosed 2,2\hm\rightclosed,
 &\text{~~otherwise. }
\end{cases}
\]
We call $s$ an \newterm{ear} (by analogy with an ear
in a triangulation of a polygon, which is a triangle that has two of
its edges in common with the polygon).
\end{definition}


Next we associate a set $\BB_s$ with each SCS $s$.
\indy{Notation}{BBs@$\BB_s$}%


\begin{definition}[$\BB_s$]\guid{KTFVGXF}\label{def:BBs}
  For every SCS $s$, and every function
  $\v:I(s)\to \ring{R}^3$, let $V_\v\subset \ring{R}^3$ be the image of
  $\v$.  Let $E_\v$ be the image of $i\mapsto \{\v_i,\v_{i+1}\}$.  Let
   $F_\v$ be the image of $i\mapsto (\v_i,\v_{i+1})$.
 Let $\BB_s$ be
  the set of all functions $\v$ that have the following properties.
\begin{enumerate}
\item $V_\v\subset \BB$.
\item $a_{ij}(s)\le\norm{\v_i}{\v_j}\le b_{ij}(s)$, for all $i,j\in I(s)$.
\item if $k(s)>3$, then $(V_\v,E_\v,F_\v)$ is a nonreflexive local fan.
\end{enumerate}
\end{definition}





Note that $\BB_s$ does not depend on the data $\alpha_{ij}$, $\beta_{ij}$, $J$, $I_{str}$, $I_{lo}$, $I_{hi}$, and $d$.
The set $J$ is used to make a small correction $d(s,\v)$ to the
constant $d(s)$.  

\begin{definition}[$d(s,\v)$]\guid{TPLCZFL}
\formaldef{$\sigma$}{sigma\_sy}
Let $s$ be a SCS.  
Set $\sigma(s) =1$ when $s$ is an ear;  $\sigma =
-1$, otherwise.  
Write
\begin{equation}
d(s,\v) = d(s) +  0.1\, \sigma(s)\,\sum_{\{i,j\}\in J(s)} (\stab - \norm{\v_i}{\v_j}).
\end{equation}
\end{definition}
\indy{Notation}{zzs@$\sigma=\pm1$}%
\indy{Notation}{d@$d(s,\v)$}%

This correction to $d(s)$  makes it a bit easier to prove inequalities when
$\sigma(s)=-1$, at the cost of slightly more difficult inequalities for ears.

When
$k(s)=3$ and $\v\in \BB_s$, 
the set $V_\v=\{\v_i\mid i\in I(s)\}$ may degenerate to planar
configurations, because the local fan constraint in Definition~\ref{def:BBs} is not imposed in this case.
Nevertheless, by the
constraint $b_{ij}(s)<4$, the tetrahedron $\{\orz,\v_1,\v_2,\v_3\}$ has well-defined
dihedral angles $\dih_V \{\orz,\v_i\} \{\v_{i+1},\v_{i+2}\}$,  so
that $\tau_3(V_\v)$ is defined.

\begin{definition}[$\tau^*$]\guid{BGCEUKP}\label{def:tau-star}
\indy{Notation}{zzt@$\tau^*$}%
Let $s$ be a SCS.  Define 
\[
\tau^*:\{(s,\v)\mid \ \v\in \BB_s\} \to \ring{R}
\] 
by
\[ 
\tau^*(s,\v) = \begin{cases}
  \tau(V_\v,E_\v,F_\v)-d(s,\v),  &\text{if } k(s) > 3\\
  \tau_3(V_\v)-d(s,\v), &\text{if } k(s) = 3.
\end{cases}
\] 
\indy{Notation}{zzt@$\tau^*$}%
\end{definition}



\begin{definition}[$\smain$]\label{ex:main} \guid{XOSFOMP}
The constants in the conclusions of the main estimate
  (Theorem~\ref{lemma:main-estimate}) can be packaged into unadorned SCSs.  
For example, the standard main estimate for $k=6$ gives
  the SCS data: $d=0.712$, $J=\emptyset$, $I$ an indexing set
  of cardinality six, and
\[
a_{ij} = \begin{cases} 0, & i=j,\\
  2, & j= i\pm1,\\
  2 \hm, & \text{otherwise},
  \end{cases}
\qquad
b_{ij}=\begin{cases}
 0, & i=j,\\
 2\hm, & j= i\pm1,\\
 4h_0^+, & otherwise,
  \end{cases}
\]
where $h_0^+$ is any constant greater than $\hm$.
The upper bound $4\hm$ on any diagonal comes from the triangle
inequality: $\norm{\v_i}{\v_j} \le \normo{\v_i}+\normo{\v_j} \le
4\hm$.   
% XX added $\hm^+$ May 26, 2012 to avoid binding constraints.
We write $\smain$ for the set of SCSs $s$, 
 for all cases of the main
estimate.
\end{definition}
\indy{Notation}{Smain@$\smain$ (main estimate SCSs)}%


\begin{lemma}\guid{ZITHLQN}\label{lemma:main-smain}  
\formalauthor{Hoang Le Truong}
The main estimate holds if and only if for every
$s\in\smain$ and for every $\v\in \BB_s$, we have $\tau^*(s,\v)\ge0$.
\end{lemma}

\begin{proof}  This follows by expanding the definition of $\smain$ and $\BB_s$.
Note that
the set $J(s)$ is empty for $s\in \smain$, so 
\[
d(s,\v) = d(s), \text{ for all } s \in \smain.
\]
\end{proof}



%\begin{definition}[$\smain$] \guid{BTKIQGE}
%For each of the cases of Theorem~\ref{lemma:main-estimate}, we fix an
%SCS that encodes its parameters, as described in Example~\ref{ex:main}. 
%Let $\smain$ be this set of  SCSs.
%\end{definition}




\subsection{minimization}




\begin{definition}[index,~$\iota$,~$\MM_s$]\guid{FNUEPJW}
Let $s$ be a SCS.
Let 
\[
\MM_{s}\subset \BB''_{s}\subset \BB'_s\subset \BB_{s}
\]
be defined as follows.
Let $\BB'_{s}$ be the set of all $\v\in \BB_{s}$ such that
\begin{enumerate}
\item $\tau^*(s,\v)$ is equal to the minimum of $\tau^*(s,\wild)$ over $\BB_{s}$.
\item $\tau^*(s,\v)< 0$.
\end{enumerate}
Define the \newterm{index} $\iota(s,\v)$ of $\v\in \BB_s$ to be the number of edges $\{i,j\}$ of $I(s)$
for which $a_{i j}(s)=\norm{\v_i}{\v_j}$.  Let $\iota(s)$ be the minimum
of the index of $\v$ as $\v$ runs over $\BB'_s$.  
We let $\BB''_{s}$  be the set of $\v\in \BB'_{s}$ that attain
the smallest possible index $\iota(s)$,
and let $\MM_s\subset \BB''_s$ be the subset of all $\v$ satisfying the additional soft
constraints.
\begin{enumerate}
\item If $i\in I_{str}$,  then $\v_i$ is straight.
\item If $i\in I_{lo}$,  then $\normo{\v_i}=2$.
\item If $i\in I_{hi}$,  then $\normo{\v_i}=2h_0$.
\item $\alpha_{ij}(s)\le \norm{\v_i}{\v_j}\le \beta_{ij}(s)$ for all $i,j$.
\end{enumerate}
\end{definition}


Note that if $s$ is unadorned, then $\MM_s = \BB''_s$.
%(Obviously, if $I_{hi}\cap I_{lo}\ne \emptyset$, then $\MM_s=\emptyset$.)


%We have the following analogue of Lemma~\ref{lemma:esm}.

%\begin{lemma}\guid{PCRTTID} \label{lemma:aug-compact}
%\end{lemma}

%\begin{proof}  See DSP.
%\end{proof}

%\begin{lemma}[continuity]\guid{HDPLYGYv2}\label{lemma:hdpv2}
%Let $s$ be a SCS.  Then the function 
%\[
%\v\mapsto \tau^*(s,\v)
%\]
%is a continuous function on $\BB_s$.  Moreover, if $\BB_s$ is
%nonempty, then the function attains a minimum.
%\end{lemma}

%\begin{proof} 
%\end{proof}

\begin{lemma}\guid{GKFMJLC}
$s$ is a SCS for every $s\in \smain$.
\end{lemma}

\begin{proof} This is a direct result of definitions.
\end{proof}

%\begin{lemma}\guid{old:XWITCCN}
%Let $s\in \smain$, and assume that 
%\[
%\tau^*(s,\v)< 0.
%\]
%for some $\v\in \BB_s$.
%Then $\BB'_s$ is nonempty.
%\end{lemma}

% 2013-05-30, changed hypothesis from s\in\smain to s \in SCS.
\begin{lemma}\guid{UXCKFPE}\guid{old:XWITCCN}\label{lemma:init-bbs}
\formalauthor{Hoang Le Truong}
Let $s$ be a SCS, and assume that 
\[
\tau^*(s,\v)< 0.
\]
for some $\v\in \BB_s$.
Then $\BB'_s$ is nonempty.
\end{lemma}

\begin{proof} Let $s$ be a SCS. Then by DSP,
$\BB_s$ is compact (as a subset of
$\BB^k \subset \ring{R}^{3k}$). 

 The function 
\[
\v\mapsto \tau^*(s,\v)
\]
is a continuous function on $\BB_s$.  Moreover, if $\BB_s$ is
nonempty, then the function attains a minimum.  This follows from Lemma~\ref{lemma:compact-fan} and
Lemma~\ref{lemma:aug-compact}.  The set of minima is then nonempty.
\end{proof}

% 2013-05-30, changed hypothesis from s\in\smain to s \in SCS.
\begin{lemma}\guid{SGTRNAF}\guid{old:AYQJTMD}\label{lemma:init}
\formalauthor{Hoang Le Truong}
Let $s$ be an unadorned SCS, and assume that 
\[
\tau^*(s,\v)< 0.
\]
for some $\v\in \BB_s$.
Then $\MM_s$ is nonempty.
\end{lemma}

\begin{proof}    By Lemma~\ref{lemma:init-bbs}, the set 
$\BB'_s$ of minimizers is nonempty.   
The subset $\BB''_s$ on which the index is as small as possible
is then also nonempty.  By assumption, $s$  is unadorned, and
  $\BB''_s = \MM_s$.
\end{proof}


\begin{lemma}\guid{EAPGLEJ}  
\formalauthor{Hoang Le Truong}
The main estimate holds if and only if $\MM_s=\emptyset$ for all $s\in\smain$.
\end{lemma}

\begin{proof} By Lemma~\ref{lemma:init} and Lemma~\ref{lemma:main-smain}.
\end{proof}

\begin{lemma}\guid{JKQEWGV}\label{lemma:not-circular}
\formalauthor{Hoang Le Truong}
Let $s$ be a SCS.  Let $\v\in \BB_s$.
Suppose that $\tau^*(s,\v)< 0$ and $k(s)>3$.  Then
$\sol(V_\v,E_\v,F_\v) < \pi$.
Furthermore, the local fan is not circular, and
the local fan can be lunar only when the pole has acute interior
angle.
\end{lemma}

\begin{proof} By the definition of SCS,
we have $d(s)< 0.9$. The proof of Lemma~\ref{lemma:09} extends readily
to this context. The solid angle of a lune is less than $\pi$ if and only
if the pole has acute interior angle.
\end{proof}

%\begin{lemma}\guid{HFNXPZA}\label{lemma:sol-pi3}
%Let $s$ be a SCS.  Let $\v\in \BB_s$.
%Suppose that $\tau^*(s,\v)< 0$ and $k(s)=3$.  Then
%$\sum_{i=1}^3\dih_V ( \{ 0,\v_i \}, \{ \v_{i+1},\v_{i-1}  \} ) < 2\pi$.
%\end{lemma}







\subsection{operations}

This section describes some operations on SCSs.  
The first of these, a restriction,
 is a {\it hardening} of some of the soft constraints.


\begin{definition}[restriction]\guid{PFEOBSC}
Let $s$ be a SCS.
We say that $s'$ is a \newterm{restriction} of $s$ of the \newterm{first type} if $I(s)=I(s')$ and
\[
b_{ij}(s') =  \beta_{ij}(s), \quad i,j\in I(s).
\]
and all other parameters $k$, $d$, $J$, $a$, $\alpha$, $\beta$, etc. are
the same for $s$ and $s'$.

We say that $s'$ is a \newterm{restriction} of $s$ of the \newterm{second type} if 
\begin{enumerate}
\item $I(s)=I(s')$,
\item $\alpha_{ij}(s)=\beta_{ij}(s)$ for all $i,j\in I(s)$,
\item
$a_{ij}(s') = b_{ij}(s') = \alpha_{i j} (s)$,
and 
\item all other parameters $k$, $d$, etc.
are
the same for $s$ and $s'$.
\end{enumerate}
We say that $s'$ is a restriction of $s$ if it is a restriction of
the first or second type.
\end{definition}


\begin{definition}[subdivision]\guid{YYKMEWW} 
Let $s$ be a SCS,
and let $p,q\in  I(s)$, with $p\ne q$.  Let $c\in\ring{R}$.
Define constants $\beta_0 = \min(b_{pq}(s),c)$ and $\alpha_0=\max(a_{pq}(s),c)$.
Define $s_1$ to be the same as $s$ except that
\[
\beta_{pq}(s_1)= \beta_0,\quad b_{pq}(s_1) = c.
\]
Define $s_2$ to be the same as $s$ except that
\[
a_{pq}(s_2) = c,\quad \alpha_{pq}(s_2) = \alpha_0.
\]
Define the subdivision of $s$ to be the following list of one or two SCSs, according to the case.
\[
\begin{cases}
\phantom{a_{pq}(s) \le } c \le a_{pq}(s), & [s] \\
a_{pq}(s) < c \le \alpha_{pq}(s), & [s_2] \\
\alpha_{pq}(s) < c < \beta_{pq}(s), & [s_1;s_2] \\
\beta_{pq}(s) \le c < b_{pq}(s), & [s_1]\\
b_{pq}(s) \le c, & [s]
\end{cases}
\]
\end{definition}
The subdivision thus corresponds to splitting an interval 
$\leftclosed a_{pq},b_{pq}\rightclosed$ into
\[
\leftclosed a_{pq},c\rightclosed \cup \leftclosed c,b_{pq}\rightclosed.
\]

\begin{definition}\guid{LCTBALA}  
We say that a SCS $s$
\newterm{transfers} to a SCS $s'$ if
\begin{enumerate}
\item If $s$ is an ear, then $s=s'$.
\item $s'$ is unadorned.
\item $I(s) = I(s')$.
\item $d(s)\le d(s')$.
\item For all $i,j$, we have $a_{ij}(s')\le a_{ij}(s)\le b_{ij}(s)\le b_{ij}(s')$.
\item $J(s')\subset J(s)$.
\end{enumerate}
\end{definition}

\begin{definition}[equivalent~SCS]
If $s$ is a SCS with torsor $I(s)$, and if
$I'$ is any equivalent torsor, then we can use the bijection between $I(s)$ and $I'$
to obtain a SCS $s'$ with $I' = I(s')$.  An
SCS $s'$ related in this way to $s$ is said
to be \newterm{equivalent} to $s$.  An \newterm{equi-transfer} of $s$
to $s'$ is a transfer from $s$ to a SCS that
is equivalent to $s'$.
\end{definition}

\begin{definition}[torsor slice] \guid{ZTBHGMO}
Let $I$ be a $\ring{Z}/k\ring{Z}$-torsor, with action given by $(j,i)\mapsto j+i$,
for $i\in I$.  Let $p,q\in I$ be non-adjacent.  Set
\[
I[p,q] = \{p,1+p,2+p,\ldots,q\} \subset I.
\]
Note that the cardinality of $I[p,q]$ is
\[
m = 1 + \min \{j\in \ring{N} \mid j + p = q\}.
\]
We make $I[p,q]$ into a $\ring{Z}/m\ring{Z}$-torsor with action $(j,i)\mapsto j+' i$,
given by the iterates of
\[
1 +' i = 
\begin{cases}
  1 + i &\text{if } i\ne q,\\
  p &\text{if } i = q.
\end{cases}
\]
The $\ring{Z}/m\ring{Z}$-torsor $I[p,q]$ is called the
\fullterm{slice\/}{slice!torsor} of $I$ along $(p,q)$.
\indy{Notation}{Ipq@$I[p,q]$ slice (of a torsor)}%
\end{definition}

\figWKUYEXM % fig:slice-torsor


\begin{definition}[SCS slice]\guid{CJMHFAT}
 Let $s$ be a SCS and let $\{p,q\}\subset I(s)$ be a diagonal.
  (In particular, $k(s)>3$.)  We
  say that a pair $\{s',s''\}$ is a
\newterm{slice} along  the
  diagonal $\{p,q\}$ of $s$, if the following conditions hold.
\begin{enumerate}
\item $s'$ and $s''$ are unadorned SCSs.
\item $I(s')=I[p,q]$ and $I(s'') = I[q,p]$.
\item $d(s) \le d(s') + d(s'')$.
\item $J(t) \subset J(s) \cup \{\{p,q\}\}$, for $t = s',s''$.  
\item $\{p,q\}\in J(s')$ iff $\{p,q\}\in J(s'')$.
\item $\{p,q\}\in J(s')$ iff $s'$ or $s''$ is an ear.
\item 
\[
a_{ij}(t) = a_{ij}(s), \text{ and } b_{ij}(t) = b_{ij}(s),
\]
for  $t=s',s''$ and all $i,j\in I(t)$ except the given diagonal $\{i,j\} = \{p,q\}$.
%\item For $t=s',s''$,
%\[
%b_{pq}(s) \in \leftclosed a_{pq}(t),b_{pq}(t)\rightclosed.
%\]
%%!! Removed b_{pq}(s) in cover def on Jan 23, 2012. Restored here!
%% XX May 17, 2012 restored there.
\item $a_{pq}(t) = \alpha_{pq}(s),\quad b_{pq}(t)=\beta_{pq}(s)$,\quad $t = s',s''$.
\item $\beta_{pq}(s) < 4$.
\item $k(s)=4$ or $\beta_{pq}(s) \le \stab$.
\end{enumerate}
\end{definition}


The word {\it slice} is used for related operations on the indexing
set, the local fan, and the SCS.  A slice of a
SCS is used in parallel with the slice a fan of
cardinality $k(s)$ into two smaller fans with cardinalities $k(s')$ and
$k(s'')$.  
All of the edge length constraints are to be preserved
under slicing.  

If $\{s',s''\}$ is an slice of a diagonal $\{p,q\}$, then we can use
the inclusions of sets $I(s')\subset I(s)$ and $I(s'')\subset I(s)$ to
restrict an element $\v:I(s)\to\BB$ to $\v':I(s')\to \BB$ and
$\v'':I(s'')\to \BB$.  

\begin{lemma}\guid{QKNVMLB}\label{lemma:cover2}
\formalauthor{Hoang Le Truong}
Let $s$ be a SCS with diagonal $\{p,q\}$ and slice
 $\{s',s''\}$ along $\{p,q\}$.
Let $\v\in \MM_s$ and let $\v'$ and $\v''$ be constructed from $\v$ as above.
Then  $\v'\in \BB_{s'}$ and $\v''\in \BB_{s''}$.
Moreover,
\begin{equation}
d(s,\v) \le d(s',\v') + d(s'',\v'')
\end{equation}
and
\begin{equation}
\tau^*(s,\v)\ge \tau^*(s,\v')+\tau^*(s,\v'').
\end{equation}
\end{lemma}

\begin{proof} See Lemma~\ref{lemma:cover}.
\end{proof}

\subsection{propagation}

The proof of the main lemma consists in showing that the nonemptiness
of $\MM_s$ propagates in an orderly way under the operations of
restriction, slicing, equivalence, subdivision, and deformation.

\begin{definition}[$\Ra$] \guid{AZGJNZO}
\formaldef{$\Ra$}{scs\_arrow\dots}
Let $\SCS$ be the set of SCSs
and let $P(\SCS)$ be the powerset of $\SCS$. 
% We define a relation $(\ra)$ on $\SCS\times P(\SCS)$.
%We write $s\ra T$ if the following condition holds.
%\begin{enumerate}
%\item $k=1$ and $s$ transfers to a SCS equivalent to $s_1$.
%\item $k=2$ and $\{s_1,s_2\}$ is an slice along some diagonal of $s$.
%\item $k=2$ and $\{s_1,s_2\}$ is a subdivision of $s$.
%\item If $\MM_s\ne\emptyset$, then 
%$\MM_t\ne\emptyset$ for some $t\in T$.
%\end{enumerate}
We define a binary relation $(\Ra)$ on $P(\SCS)$.  When $S,T\subset \SCS$, we write
$S\Ra T$ to mean  either that $\MM_s=\emptyset$ for all $s\in S$,
or that there exists $t\in T$ such that $\MM_t\ne\emptyset$.
%\begin{enumerate}
%\end{  $s\in S_1$, we have $s\ra S_2$.
%$s\ra S''$.  We define a binary relation $\Ra^*$ on $P(S)$ as the reflexive
%transitive closure of $\Ra$.
\end{definition}

\begin{lemma}\guid{FZIOTEF}
\formalauthor{Hales}
The relation $(\Ra)$  is reflexive and transitive.
\end{lemma}

\begin{proof}  Clearly, $\{s \}\Ra \{s\}$, and this implies reflexivity.
Transitivity is a simple matter.  Assume
$S_1\Ra S_2$ and $S_2\Ra S_3$.  Assume $s_1\in S_1$, with $\MM_{s_1}\ne \emptyset$.
Then select
$s_2\in S_2$ such that $\MM_{s_2}\ne\emptyset$, and $s_3\in S_3$ such
that $\MM_{s_3}\ne\emptyset$.  Then $\{s_1\}\Ra\{s_3\}$.  So $S_1\Ra S_3$.
\end{proof}

%\begin{lemma}\guid{IEWZAVH}\label{lemma:propagate}
%Let $S$  and $T$ be finite sets of SCSs such that
%$S\Ra T$.  Assume that $\MM_s\ne\emptyset$ for some $s\in S$.
%Then $\MM_t\ne\emptyset$ for some $t\in T$.
%\end{lemma}

%\begin{proof} This follows directly from the definitions. 
%\end{proof}

\begin{lemma}[restriction]\guid{EQTTNZI}
\formalauthor{Hoang Le Truong}
Let $s$ be a SCS, and let $t$ be a restriction of $s$.
When $t$ has the first type, assume also that for all $\{ i , j\} \in J$, we have $\beta_{i j}(s) = b_{i j}(s)$.
Assume further for this type that $J(s)=\emptyset$ or $k(s)>3$.
When $t$ has the second type, assume also that $J(s)=\emptyset$ and $m(t)+k(t)\le 6$, with $m$ as in
the definition of SCS.
Then $\{s\}\Ra \{t\}$.
\end{lemma}

\begin{proof}
$\BB_t\subset \BB_s$. Assume
 $\w\in \MM_s$. The assumptions  according to the type give $\w\in \BB_t$.

Assume the restriction has the first type.  Then a global minimizer $\w$ also
minimizes on a subset,  and the index does not change.  Hence $\w\in \MM_t$ and $\{s\}\Ra\{t\}$.

Assume that the restriction has the second type. Then 
 $\alpha_{ij}(s)=\beta_{ij}(s)$.    We have $\BB_t\subset \BB_s$.
For every $\v\in \BB'_t$, the index of $\v$ is $k$: every edge is fixed at its lower bound.
Hence $\BB'_t = \BB''_t$, and $\w\in \MM_t$.
\end{proof}


\begin{lemma}[subdivision]\guid{UAGHHBM}
\formalauthor{Hoang Le Truong}
Let $s$ be a SCS and let
Let $\{s_1,s_2\}$ be a subdivision of $s$ along $\{i,j\}\subset I(s)$.
Then $\{s\}\Ra\{s_1,s_2\}$.
\end{lemma}

\begin{proof}
Let $c$ denote the constant used for the subdivision.
We have $\BB_s =
\BB_{s_1}\cup \BB_{s_2}$.  If $\w\in \MM_s$, then
$\w\in \BB'_{s_1}\cup\BB'_{s_2}$.

Assume first that there exists $\w\in \MM_s$ such that $c < \norm{\w_i}{\w_j}$.
We claim that $\iota(s) \le \iota(s_2)$.  In fact,
\begin{align*}
\iota(s) &=\min_{\v\in \BB'_s} \iota(s,\v)\\
&\le \min_{\v\in \BB'_{s_2}} \iota(s,\v) \\
&\le \min_{\v\in \BB'_{s_2}} \iota(s_2,\v) \\
&=\iota(s_2).
\end{align*}

We have $\w\in\BB'_{s_2}$ and $\BB'_{s_2} = \BB'_s \cap \BB_{s_2}$.
Also,
\[
\iota(s_2)\ge \iota(s) = \iota(s,\w) = \iota(s_2,\w) \ge \iota(s_2)
\]
so that $\w\in \BB''_{s_2}$ and $\w\in \MM_{s_2}$.

Finally, assume that every $\w\in\MM_s$ has $\norm{\w_i}{\w_j}\le c$.  This
means $\MM_s\subset \BB_{s_1}$. Let $\w\in\MM_s$.
We claim that $\iota(s) = \iota(s_1)$.  In fact,
\begin{align*}
\iota(s) &= \min_{\v\in \BB'_s} \iota(s,\v) \\
   &\le \min_{\v\in\BB'_{s_1}}\iota(s,\v)\\
   &=\min_{\v\in \BB'_{s_1}}\iota(s_1,\v)\\
   &=\iota(s_1).
\end{align*}
Also, 
\[
\iota(s) = \iota(s,\w) = \iota(s_1,\w) \ge \iota(s_1).
\]

We have $\w\in\MM_s\subset \BB'_s\cap \BB_{s_1} = \BB'_{s_1}$.
Since $\iota(s)=\iota(s_1)$, we also have $\w\in \BB''_{s_1}$.
So $\w\in \MM_{s_1}$.
\end{proof}

\begin{lemma}[transfer, equivalence]\guid{YXIONXL}  
\formalauthor{Hoang Le Truong}
Let $s$ be a SCS and let
 $t$ be a transfer or equivalent of $s$.  
Then  $\{s\}\Ra\{t\}$.
\end{lemma}

\begin{proof}
We treat transfer first.
Assume that $\w\in \MM_s$.
We have $\w\in \BB_s\subset\BB_t$, and $d(t,\w) \ge d(s,\w)$,
as well as $\tau^*(t,\w)\le\tau^*(t,\w)< 0$.   By Lemma~\ref{lemma:init-bbs}, there
exists a global minimizer of smallest index
$\v\in\BB''_t\ne\emptyset$.  It satisfies
$\tau^*(t,\v)\le\tau^*(t,\w)< 0$.  By the definition of transfer,
$t$
is unadorned, so that $\BB''_t=\MM_t$.  (Note that $\MM_s$ and
$\MM_t$
might not be directly related.)  This shows that
$\MM_t\ne\emptyset$.
Hence $\{s\}\Ra\{t\}$.  Similarly, if $t$ is equivalent to $s$,
then we again have $\{s\}\Ra\{t\}$.
\end{proof}


\begin{lemma}[slice]\guid{LKGRQUI}  
\formalauthor{Hoang Le Truong}
Let $\{s',s''\}$ be a slice of
a SCS $s$ along
a diagonal $\{p,q\}$.  
Then   $\{s\}\Ra\{s',s''\}$.
\end{lemma}

\begin{proof}
Assume that $\w\in\MM_s$.
Let $\w'\in \BB_{s'}$ and $\w''\in \BB_{s''}$ be obtained
by restriction of parameters.  From Lemma~\ref{lemma:cover2},
we have $\tau^*(s',\w')< 0$ or $\tau^*(s'',\w'')<0$.  To be
concrete, say $\tau^*(s',\w')< 0$.  A global minimizer $\v'\in\BB_{s'}$ of smallest index
then also satisfies $\tau^*(s',\v')< 0$.  By the definition of
slice, $s'$ is unadorned, so that $\BB''_{s'}=\MM_{s'}$ and
$\v'\in \MM_{s'}$.  Hence $\{s\}\Ra\{s',s''\}$.
\end{proof}

%\begin{remark}[non-generic fans]\guid{KEOMGHK}
%We have seen that a set $\MM_s$ does not contain any circular fans.
%Assume that $\MM_s$ contains a lunar fan.
%By a process of subdivision and Lemma~\ref{lemma:bjo}, we may assume
%that it has some diagonal $\norm{\w_i}{\w_j}\le\stab$.  By slicing
%along
%the diagonal $\{i,j\}$, we obtain $\{s_1,s_2\}$ that are generic, with
%$\{s\}\Ra\{s_1,s_2\}$.  In this way, we may easily dispose of non-generic
%fans.  In what follows, we may assume that every member of $\MM_s$ is
%generic.
%\end{remark}

\subsection{deformation}

This section proves some deformation results and implements them
as arrows $\{s\}\Ra T$.

\begin{lemma}\guid{HXHYTIJ} 
\formalauthor{Hoang Le Truong}
Let $s$ be a SCS, and let $\v\in\BB''_s$.  For
Let $\w:I(s)\to\ring{R}^3$.
Then  one of the following holds:
\begin{enumerate}
\item $\w\not\in \BB_s$.
\item $\tau^*(s,\w)> \tau^*(s,\v)$.
\item $\tau^*(s,\w)=\tau^*(s,\v)$ and the index of $\w$ is at least that of $\v$.
\end{enumerate}
\end{lemma}

\begin{proof}
If the first two conclusions fail, then $\w\in \BB'_s$.  Since $\v\in\BB''_s$,
it must minimize the index over $\BB'_s$.  Hence the third conclusion holds.
\end{proof}


\begin{lemma}\guid{ODXLSTCv2}\label{lemma:odx2} 
\formalauthor{Hoang Le Truong}
Let $s$ be a SCS and let $\w\in \MM_s$.  Fix $\ell\in I(s)$.
Assume  that $\w_\ell$ is not the pole of a lunar local fan $(V_\w,E_\w,F_\w)$.
Assume that $4h_0 < b_{\ell i}(s)$ for every diagonal $\{\ell,i\}$ at $\ell$.
Then one of the following hard  constraints hold at index $\ell$.
\begin{enumerate}
\item $\norm{\w_\ell}{\w_i}$ attains its lower bound $a_{\ell i}(s)$, for
  some $i\ne \ell$.
\item $\normo{\w_\ell}$ attains its lower bound $2$.
\item There exists $i$ adjacent to $\ell$ such that $\{\ell,i\}\in J(s)$.
\end{enumerate}
\end{lemma}

\begin{proof} 
For a contradiction, assume that none of the enumerated constraints hold.
By Lemma~\ref{lemma:not-circular}, the fan is not circular.
The hypotheses
allow us to use Lemmas~\ref{lemma:fan-open-lunar} and
\ref{lemma:fan-open-generic} to deform $\w$ at $\w_\ell$.

The function $\tau^*$ is decreasing along
the curve of the form \eqref{eqn:move1} such that
$\w_\ell(t)=(1-t) \w_\ell$.
That is, we push the point $\w_\ell$ radially towards the origin.
Explicitly, 
\[
\tau^*(s,w) = c_1 + c_2 \normo{\w_\ell(t)}
\]
for some $c_2>0$ and $c_1$.
We have
$\w(t)\in \BB_s$ for all $t$ positive and sufficiently
small.  This contradicts the minimality properties of $\MM_s$.
\end{proof}

\begin{lemma}\guid{IMJXPHRv2}\label{lemma:imj2}
Let $s$ be a SCS, $\w\in \MM_s$, and $\w_\ell$ straight.
Assume  that $\w_\ell$ is not the pole of a lunar local fan $(V_\w,E_\w,F_\w)$.
Assume that $4h_0 < b_{\ell i}(s)$ for every diagonal $\{\ell,i\}$ at $\ell$.
Assume that $\w_\ell\in \op{aff}_+(\orz,\{\w_{\ell+1},\w_{\ell-1}\})$.
Then one of the following hard constraints holds at $\ell$.
\begin{enumerate}
\item $\norm{\w_\ell}{\w_{\ell+1}}$ attains its lower bound $a_{\ell,\ell+1}(s)$, and
 $\norm{\w_\ell}{\w_{\ell-1}}$ attains its lower bound $a_{\ell,\ell-1}(s)$.
\item $\normo{\w_\ell}$ attains its lower bound $2$.
\item There exists $i$ adjacent to $\ell$ such that $\{\ell,i\}\in J(s)$.
\item Some diagonal $\{\ell,i\}\subset I(s)$ at $\ell$ satisfies
$\norm{\w_\ell}{\w_i}=a_{\ell i}(s)$.
\end{enumerate}
\end{lemma}

\begin{proof} 
For a contradiction, assume that none of the enumerated constraints hold.
By Lemma~\ref{lemma:not-circular}, the fan is not circular.
The hypotheses
allow us to use Lemmas~\ref{lemma:fan-open-lunar} and
\ref{lemma:fan-open-generic} to deform $\w$ at $\w_\ell$.

The set $\{\orz,\w_{\ell-1},\w_\ell,\w_{\ell+1}\}$ lies in a plane $A$.
By the previous
lemma one of the norm constraints is satisfied, say
\[
\norm{\w_\ell}{\w_{\ell+1}}=a_{\ell,\ell+1}(s).
\]
We consider a  deformation of $\w$ that moves
 $\w_\ell(t)$ along a circle through
 $\w_\ell$ with center $\w_{\ell+1}$ in the plane $A$.  Parameterize the curve
so that as $t$ increases, the norm $\normo{\w_\ell(t)}$ decreases.
The function $\tau^*(s,\w)$ is decreasing in $t$.  Explicitly, the
function again depends linearly on $\normo{\w_\ell(t)}$, because
the angle at $\ell$ remains straight.  This contradicts the minimality of
$\MM_s$. 
The result ensues.
\end{proof}

\begin{lemma}\guid{NUXCOEAv2}\label{lemma:nux2}
Let $s$ be a SCS and let $\w\in \MM_s$.   Fix $\ell\in I_{str}(s)$
Assume $j$ is an index adjacent to $\ell$ such  that $\norm{\w_\ell}{\w_j}=a_{\ell j}(s)$.
Assume  that $\w_\ell$ is not the pole of a lunar local fan $(V_\w,E_\w,F_\w)$.
Assume that $4h_0 < b_{\ell i}(s)$ for every diagonal $\{\ell,i\}$ at $\ell$.
Then
one of the following hard conditions holds at index $\ell$.
\begin{enumerate}
\item We have $\norm{\w_\ell}{\w_i}=a_{\ell k}(s)$
for both choices of $i\in I(s)$ adjacent to $\ell$.
\item There exists $i$ adjacent to $\ell$ such that $\{\ell,i\}\in J(s)$.
\item Some diagonal $\{\ell,i\}\subset I(s)$ at $\ell$ satisfies
$\norm{\w_\ell}{\w_i}=a_{\ell i}(s)$.
\end{enumerate}
\end{lemma}

\begin{proof} 
The lemma is a special
case of the previous lemma, unless $\normo{\w_\ell}=2$, which we assume.
Let $i\ne j$ be the other index adjacent to $\ell$.
Assume that the three enumerated parts of the conclusion fail.

We consider a deformation of $\w$ that only moves $\w_\ell$.  We take
the motion of $\w_\ell$ to be
in a circular arc with center $\orz$ through the point $\w_\ell$ and in
the fixed plane determined by $\{\orz,\w_\ell,\w_j,\w_{i}\}$.  
The function $\tau^*(s,\wild)$ is
constant along this curve.  We orient the curve to be increasing
in $\norm{\w_\ell}{\w_{j}}$.  For sufficiently, small $t$, we find that
$\w(t)\in\BB'_s$ has smaller index than $\w$.  This is contrary to the minimizing
properties of $\w\in\MM_s$.

As in the proofs of the previous lemmas, the fan is not circular, and 
the constraints on generic and local fans
allow us to use Lemmas~\ref{lemma:fan-open-lunar} and
\ref{lemma:fan-open-generic}, showing that fan conditions are preserved.
\end{proof}

In the preceding three lemmas, we specifically allow the deformations
$\v(t)$ to occur within a lunar fan, moving a single node that is not a pole
of the lunar fan, as given by Lemma~\ref{lemma:fan-open-lunar}.
We consider some further deformations on generic $\v$.

%\begin{lemma}[482 obtuse]\guid{IIYDISC}
%Let $s$ be a basic SCS, and let $p\in I(s)$.  Let $\v\in \MM_ss$.
%Assume that for all diagonals except $\{p-1,p+1\}$,
%we have $a_{i,j}(s)\le\norm{\v_i}{\v_j}$.  Assume $\pi/2 < \angle \v_p < \pi$.
%Assume that the constraints along $\{p,p+1\}$ are standard. Assume $2\le \norm{\v_p}{\v_{p-1}}\le \stab$.
%Assume that $\{\orz,\v_{p-1},\v_{p+1}\}$ is not collinear.
%Then $\norm{\v_p}{\v_{p+1}} = 2$.
%\end{lemma}

%\begin{proof}  We construct a deformation using Lemma~\ref{lemma:PQC}.  Specifically, we take the
%base triangle to be $\{\orz,\v_{p-1},\v_{p+1}\}$ and variable point to be $\v_p$ with variable edge $\{\v_{p},\v_{p+1}\}$.
%{\tt LEMMA\_4828966562} states that the condition $\norm{\v_p}{\v_{p+1}} > 2$ is not a local minimum.
%Because of the condition  $\pi/2 < \angle \v_p < \pi$, decreasing $\norm{\v_p}{\v_{p+1}}$ along this
%deformation will preserve the nonreflexivity condition of a nonreflexive local fan.
%\end{proof}

\begin{lemma}[482]\guid{CUXVZOZ}\label{lemma:482-obtuse}
Let $s$ be a basic SCS, and let $p\in I(s)$.  Let $\v\in \MM_s$ be generic.
We make the following assumptions.
\begin{enumerate}
\item For all diagonals except $\{p-1,p+1\}$,
we have $a_{i,j}(s)<\norm{\v_i}{\v_j}$. 
\item  $3 \le \norm{\v_{p-1}}{\v_{p+1}}$. 
\item  $\angle\v_p < pi$. 
\item  $\pi/2 < \angle \v_p$ or $\angle \v_{p+1} < \pi$. 
\item  The constraints along $\{p,p+1\}$ are standard.  
\item   $2\le \norm{\v_p}{\v_{p-1}}\le \stab$.
\end{enumerate}
Then $\norm{\v_p}{\v_{p+1}} = 2$.
\end{lemma}

\begin{proof}  We construct a deformation using Lemma~\ref{lemma:PQC}.  Specifically, we take the
base triangle to be $\{\orz,\v_{p-1},\v_{p+1}\}$ and variable point to be $\v_p$ with variable edge $\{\v_{p},\v_{p+1}\}$.
{\tt LEMMA\_4828966562} states that the condition $\norm{\v_p}{\v_{p+1}} > 2$ is not a local minimum.
Because of the condition  $\pi/2 < \angle \v_p < \pi$, decreasing $\norm{\v_p}{\v_{p+1}}$ along this
deformation will preserve the nonreflexivity condition of a nonreflexive local fan.
\end{proof}

\begin{lemma}[482 bis]\guid{CJBDXXN}\label{lemma:482-obtuse-bis}
Let $s$ be a basic SCS, and let $p\in I(s)$.  Let $\v\in \MM_s$ be generic.
Assume that for all diagonals except $\{p-1,p+1\}$,
we have $a_{i,j}(s)<\norm{\v_i}{\v_j}$.  
Assume $3 \le \norm{\v_{p-1}}{\v_{p+1}}$.
Assume $\pi/2 < \angle \v_p < \pi$ or $\angle \v_{p-1} < \pi$.
Assume that the constraints along $\{p-1,p\}$ are standard. 
Assume $2\le \norm{\v_p}{\v_{p+1}}\le \stab$.
Then $\norm{\v_p}{\v_{p-1}} = 2$.
\end{lemma}

\begin{proof}  We construct a deformation using Lemma~\ref{lemma:PQC} as in the previous lemma,
now using $\{\v_p,\v_{p-1}\}$ as the variable edge.
\end{proof}

%\begin{lemma}[482 non-obtuse]\guid{PQGNPON}\label{lemma:482-non-obtuse}
%Let $s$ be a basic SCS, and let $p\in I(s)$.  Let $\v\in \MM_s$ be generic.
%Assume that for all diagonals except $\{p-1,p+1\}$,
%we have $a_{i,j}(s)<\norm{\v_i}{\v_j}$.  
%Assume $3 \le \norm{\v_{p-1}}{\v_{p+1}}$.
%Assume $\angle \v_p < \pi$ and $\angle \v_{p+1} < \pi$.
%Assume that the constraints along $\{p,p+1\}$ are standard. Assume $2\le \norm{\v_p}{\v_{p-1}}\le \stab$.
%Then $\norm{\v_p}{\v_{p+1}} = 2$.
%\end{lemma}

%\begin{proof}  We use the same deformation as that in Lemma~\ref{lemma:482-obtuse}.
%This time,  $\angle \v_p < \pi$ and $\angle \v_{p+1} < \pi$ are used to maintain nonreflexivity.
%\end{proof}

%\begin{lemma}[482 non-obtuse bis]\guid{TJGGEDF}\label{lemma:482-non-obtuse-bis}
%Let $s$ be a basic SCS, and let $p\in I(s)$.  Let $\v\in \MM_s$ be generic.
%Assume that for all diagonals except $\{p-1,p+1\}$,
%we have $a_{i,j}(s)<\norm{\v_i}{\v_j}$.  
%Assume $3 \le \norm{\v_{p-1}}{\v_{p+1}}$.
%Assume $\angle \v_p < \pi$ and $\angle \v_{p-1} < \pi$.
%Assume that the constraints along $\{p-1,p\}$ are standard.
% Assume $2\le \norm{\v_p}{\v_{p+1}}\le \stab$.
%Then $\norm{\v_p}{\v_{p-1}} = 2$.
%\end{lemma}

%\begin{proof} 
%We use the same deformation as that in Lemma~\ref{lemma:482-obtuse-bis}.
%This time,  $\angle \v_p < \pi$ and $\angle \v_{p-1} < \pi$ are used to maintain nonreflexivity.
%\end{proof}

Abbreviate $\op{xrr}_V (\u,\v) = \op{xrr} (\normo{\u},\normo{\v},\norm{\u}{\v})$.

\begin{lemma}{684 pent}\guid{IUNBUIG}\label{lemma:684-pent}
Let $s$ be a basic SCS with $k(s)=5$.  Let $p\in I(s)$ and $\v\in \MM_s$ be generic.
Assume that for all diagonals, we have $a_{i,j}(s) \le \stab <\norm{\v_i}{\v_j}$ 
and $4h_0 < b_{ij}(s)$.
Assume that $\angle \v_{p+2} < \pi$ and $\angle \v_{p+3} < \pi$.
Assume that $2\le a_{p+2,p+3} \le b_{p+2,p+3} \le cstab$.
Assume that $\norm{\v_i}{\v_j}=2$ for every edge other than $\{p+2,p+3\}$.
Assume that $2\le \norm{\v_i}{\v_j}$ and $\op{xrr}_V(\v_i,\v_j)\le 15.53$, 
for $\{i,j\} = \{p,p+2\}$, $\{p,p+3\}$.
Then $\norm{\v_{p+2}}{\v_{p+3}} = a_{p+2,p+3}$.
\end{lemma}

We only need to use the special case $(p+2,p+3)=(0,1)$.

\begin{proof} We construct a deformation using Lemma~\ref{lemma:PQC}.  We use $\{\orz,\v_p,\v_{p+3}\}$ as
the base triangle with constructed point $\v_{p+2}$ and variable edge $\{p+2,p+3\}$.  We construct a second
time on the base triangle $\{\orz,\v_p,\v_{p+2}(t)\}$ with constructed point $\v_{p+1}$.
{\tt LEMMA\_6843920790} asserts that $\norm{\v_{p+2}}{\v_{p+3}} > a_{p+2,p+3}$ is incompatible with the minimality of $\v$.
The conditions  $\angle \v_{p+2} < \pi$ and $\angle \v_{p+3} < \pi$ 
are used to maintain nonreflexivity.

To use {\tt LEMMA\_6843920790}, we must check the precondition that $\{\orz,\v_p,\v_{p+2},\v_{p+3}\}$
is not coplanar.  We leave this as an exercise based on the triangle inequality?
\end{proof}

\begin{lemma}[1834]\guid{NEHXMWH}\label{lemma:1834}
Let $s$ be a basic SCS, with $k\le 4$, and let $p\in I(s)$.  Let $\v\in \MM_s$ be generic.
Assume that for all diagonals 
we have $a_{i,j}(s)\le\stab <\norm{\v_i}{\v_j}$ and $4h_0<b_{i,j}(s)$.  
Assume $\angle \v_i < \pi$ for all $i\ne p+2$.
Then $\norm{\v_p}{\v_{p+1}} = a_{p,p+1}$ or $b_{p,p+1}$.  
\end{lemma}

\begin{proof} As in previous lemmas, use Lemma~\ref{lemma:PQC} to construct a deformation.
Use $\{\orz,\v_{p+1},\v_{p-1}\}$ as the base triangle with contructed point $\v_{p}$, 
where $\norm{\v_{p+1}}{\v_{p+2}}$ varies.
Continue as before with {\tt LEMMA\_1834976363}.
\end{proof}

\begin{lemma}[1834 sym]\guid{BZQNDMM}\label{lemma:1834}
Let $s$ be a basic SCS, with $k\le 4$, and let $p\in I(s)$.  Let $\v\in \MM_s$ be generic.
Assume that for all diagonals 
we have $a_{i,j}(s)\le\stab <\norm{\v_i}{\v_j}$ and $4h_0<b_{i,j}(s)$.  
Assume $\angle \v_i < \pi$ for all $i\ne p-1$.
Then $\norm{\v_p}{\v_{p+1}} = a_{p,p+1}$ or $b_{p,p+1}$.  
\end{lemma}

\begin{proof} As in previous lemmas, use Lemma~\ref{lemma:PQC} to construct a deformation.
Use $\{\orz,\v_{p},\v_{p+2}\}$ as the base triangle with contructed point $\v_{p+1}$, 
where $\norm{\v_{p}}{\v_{p+1}}$ varies.
Continue as before with {\tt LEMMA\_1834976363}.
\end{proof}


\begin{lemma}[684]\guid{JOTSWIX}\label{lemma:684 str}
Let $s$ be a basic SCS, with $k(s)=4$, and let $p\in I(s)$.  Let $\v\in \MM_s$ be generic.
Assume that for all diagonals 
we have $a_{i,j}(s)\le\stab <\norm{\v_i}{\v_j}$ and $4h_0<b_{i,j}(s)$.  
Assume $\angle \v_i < \pi$ for all $i\ne p+2$.
Assume $\op{xrr}_V(\v_{p-1},\v_{p+1})\le15.53$. Assume $a_{p,p+1}(s) < \stab$.
Then $\norm{\v_p}{\v_{p+1}} < \stab$ or $\norm{\v_p}{\v_{p-1}}  < \stab$.
\end{lemma}

\begin{proof} As in previous lemmas, use Lemma~\ref{lemma:PQC} to construct a deformation.
Use $\{\orz,\v_{p-1},\v_{p+1}\}$ as the base triangle with contructed point $\v_p$, where $\norm{\v_{p-1}}{\v_p}$ varies.
Continue as before with  {\tt LEMMA\_6843920790}.
\end{proof}




\newpage
\section{Checking Completeness}

\def\prop{$\text{pro}^+$\relax}
\def\proeight{$\text{pro}_8$\relax}

In this section we prove the implication $\smain \Ra \sterm$.

\subsection{definitions}


We let 
\[
M(s) = \{(i,i+1) \mid i \in I(s), \quad (2 < a_{i,i+1}(s) \text{ or } 2h_0 < b _{i,i+1}(s))\}.
\]
By the definition of SCS, the cardinality $m(s)$ of $M(s)$ satisfies $k(s) + m(s) \le 6$.

The stable constraints systems we discuss here are all unadorned with $J=I_{str}=I_{lo}=I_{hi}=\emptyset$;
that is, basic stable constraint systems.
Little further mention will be made of this sets.

We say that $\v\in \BB_s$ is generic if its local fan $(V_\v,E_\v,F_\v)$ is generic.
We say that $\v\in \BB_s$ is lunar if its local fan $(V_\v,E_\v,F_\v)$ is generic.

\subsection{init list}

We name stable constraint systems $s$ with a three-character identifier.
The first digit is $k(s)$.  The second is the letter $I$ (initial), $T$ (terminal), or $M$ (intermediate).
The third character is a distinguishing digit.

We let std denote the range $\leftclosed 2,2h_0\rightclosed$ of a standard edge,
pro denote the range $\leftclosed 2h_0,\sqrt{8}\rightclosed$ of a prolonged edge,
and \prop~ denote the range $\leftclosed 2h_0,\stab\rightclosed$.
Let \proeight~ denote the range $\leftclosed \sqrt{8},\stab\rightclosed$.
If $r$ is a real number, we write $r+$ for the interval $\leftclosed r,6\rightclosed$,
and by abuse of notation $r$ for the interval $[r,r]$.

\begin{table}\label{table:cc-intervals}
\centering
\begin{tabular}{|l|l|l|l|l|l|l}
\text{\bf name} &\text{interval}\vspace{6pt}\\
\text{std} & $\leftclosed 2,2h_0 \rightclosed $\\
\text{pro} & $\leftclosed 2h_0,\sqrt{8}\rightclosed$\\
\proeight & $\leftclosed \sqrt{8},\stab\rightclosed$\\
\prop & $\leftclosed 2h_0,\stab\rightclosed$\\
\text{pro} & $\leftclosed 2h_0,\sqrt{8}\rightclosed$
\end{tabular}
\caption{intervals}
\end{table}

We have the given table \eqref{table:init} of SCSs in the initial list.  In each case we give the value of $k$ and $d$, the
range of the diagonals, the default range on edges, and the range of one distinguished edge if there is one.


\begin{table}\label{table:init}
\centering
\begin{tabular}{|l|l|l|l|l|l|l}
\text{\bf name} &k&d&diag&edge&dist.edge\vspace{6pt}\\
6I1 & 6 & 0.712 & $2h_0$+ & std & * \\
5I1 & 5 & 0.4819 & $2h_0$+ & std & * \\
5I2 & 5 & 0.616 & $\sqrt8$+ & std & * \\
5I3 & 5 & 0.616 & $2h_0$+ & std & pro \vspace{6pt}\\
4I1 & 4 & 0.206 & $2h_0$+ & std & * \\
4I2 & 4 & 0.467 & 3+ & std & * \\
4I3 & 4 & 0.477 & $\sqrt{8}$+ & std & pro\\
3I1 & 3 & 0 & * & std & *
\end{tabular}
\caption{Initial SCS}
\end{table}

We have the given table \eqref{table:term} of SCSs in the terminal list.  Two entries in the diagonal column separated by
a semicolon indicates that there are two diagonals (in a quadrilateral) with different length constraints.
In 3T7, there are three different edge ranges.


\begin{table}\label{table:term}
\centering
\begin{tabular}{|l|l|l|l|l|l}
\text{\bf name} &k&d&diag&edge&dist.edge\vspace{6pt}\\
6T1 & 6 & 0.712 & $\stab$+ & 2 & * \\
5T1 & 5 & 0.616 & $\stab$+ & 2 & * \vspace{6pt}\\
4T1 & 4 & 0.467 & 3+ & 2 & * \\
4T2 & 4 & 0.467 & 3 & std & * \\
4T3 & 4 & 0.513 & $\stab$+ & 2 & $\stab$ \\
4T4 & 4 & 0.477 & $\sqrt{8}$+;~\proeight  & std & pro\\
4T5 & 4 & 0.513 & $\stab$; $\stab$+ & std & \prop \vspace{6pt}\\
3T1 & 3 & 0.11 & * & std & \proeight\\
3T2 & 3 & 0&  * & 2 & * \\
3T3 & 3 & 0.476 & * & \prop & * \\
3T4 & 3 & 0.2759 & * & \prop & std \\
3T5 & 3 & 0.103 & * & std & pro \\
3T6 & 3 & 0.4348 & * & \proeight & std \\
3T7 & 3 & 0.2565 & * &2& $\stab$; $\leftclosed \stab,3.62\rightclosed$ 
%3T7 & 
\end{tabular}
\caption{terminal SCS}
\end{table}


We define basic SCSs with the following parameters.
In 4M4,  4M5, 4M7, and 4M8, there are two standard edges and two with range \prop,
differing according to whether the standard edges are adjacent or opposite.
In particular,

%\begin{table}
%\centering
\begin{tabular}{|l|l|l|l|l|l}
\text{\bf name} &k&d&diag&edge&dist.edge\vspace{6pt}\\
6M1 & 6 & 0.712 & $2h_0$+ & std & *\\
5M1 & 5 & 0.616 & $2h_0$+ & std & \prop\\
5M2 & 5 & 0.616 & $\stab$+ & std & $\leftclosed 2,\stab\rightclosed$\\
% 4M1 & 4 & 0.3401 & $2h_0$+ & std & \prop\\
4M2 & 4 & 0.3789 & $2h_0$+ & std & \prop\\
4M3' & 4 & 0.513 & $\sqrt8$+ & std &\proeight\\
4M4' & 4 & 0.513 & $2h_0$+ & std (2 adj) & \prop (2 adj)\\
4M5' & 4 & 0.513 & $2h_0$+ & std (2 opp) & \prop (2 opp)\\
4M6' & 4 & 0.513 & $\stab$+ & std & \prop \\
4M7 & 4 & 0.513 & $\stab$+ & std (2 adj) & \prop (2 adj)\\
4M8 & 4 & 0.513 & $\stab$+ & std (2 opp) & \prop (2 opp)\\
3M1 & 3 & 0.103 & * & std & \prop
%3T7 & 
\end{tabular}
%\caption{terminal SCS}
%\end{table}


\subsection{preliminary lemmas}

\begin{lemma}[]\guid{FEKTYIY}  \label{lemma:not-coplanar-V}.
\formalauthor{Hoang Le Truong}
Let $s$ be an  SCS with $k(s)>3$, and let $\v\in \MM_s$.  Then $\{\orz\}\cup V_\v$ is not coplanar.
\end{lemma}

\begin{proof}  If $\{\orz\}\cup V_\v$ is coplanar, then every interior angle in the local fan $(V_\v,E_\v,F_\v)$ is $0$ or $\pi$.
However, the fan conditions prevent angle $0$.  Hence every interior angle is $\pi$.  This gives $\sol(V_\v,E_\v,F_\v)=2\pi$,
which is contrary to the estimate of  Lemma~\label{lemma:not-circular} (JKQEWGV).
\end{proof}

\begin{lemma}[]\guid{AURSIPD} \label{lemma:straight-count}  
\formalauthor{Hoang Le Truong}
Let $s$ be an SCS with $k(s)>3$, and let $\v\in \MM_s$ be generic.   
Then $3 + \ell \le k$, where $\ell$ is
the number of straight interior angles of $(V_\v,E_\v,F_\v)$.
\end{lemma}

\begin{proof}
Otherwise $2+\ell \ge k$, and we can find two distinct $i_1,i_2$ such that the interior angle is straight at $\v_i$ for
$i\ne i_1,i_2$.    By the straightness of $i_1+1,\ldots$ we have that
\[
\{\orz,\v_{i_1},\v_{i_1+1},\ldots,\v_{i_2}\}
\]
lies in the plane $A=\op{aff}\{\orz,\v_{i_1},\v_{i_2}\}$.
Similarly,
\[
\{\orz,\v_{i_2},\v_{i_2+1},\ldots,\v_{i_1}\}
\]
lies in $A$.  Hence $V_\v$ is coplanar, which is contrary to Lemma~\ref{lemma:not-coplanar-V}.
\end{proof}

\begin{lemma}[polar~test]\guid{PPBTYDQ} \label{lemma:no-pole}
\formalauthor{Hoang Le Truong}
Let $\u$, $\p$, and $\v\in\ring{R}^3$ be vectors such that
$\{\orz,\p,\u\}$ is not collinear and $\{\orz,\p,\v\}$ is not collinear.
If
\[
\arc_V (\orz,\u,\p) + \arc_V (\orz,\p,\v) < \pi
\]
then $\orz$ is not in the convex hull of $\{\u,\v\}$.
\end{lemma}

\begin{proof}
Assume for a contradiction that $\orz$ does lie in the convex hull.
Let $\e = \u\times \p$.  By the orientation chosen for $\e$, and by (DIHV\_ARCV), we have
\begin{align*}
\op{azim}(\orz,\e,\u,\p) &= \dih_V (\orz,\e,\u,\p) = \arc_V (\orz,\u,\p)\\
\op{azim}(\orz,\e,\p,\v) &= \dih_V (\orz,\e,\p,\v) = \arc_V (\orz,\p,\v).
\end{align*}
Hence the assumption of the lemma and additivity of azimuth angles gives
\[
\azim(\orz,\e,\u,\v) = \azim(\orz,\e,\u,\p)+\azim(\orz,\e,\p,\v) < \pi.
\]
If $\orz$ does lie in the convex hull, then $\{\orz,\u,\v,\e\}$ is coplanar, which implies that
$\azim(\orz,\e,\u,\v)\in\{0,\pi\}$.
We have eliminated the possibility $\pi$.  If the azimuth angle is $0$, then $\u$ and $\v$ lie
in the same half plane $\u\in \op{aff}_+^0(\{\orz,\e\},\{\v\})$.  Hence $\orz$ is not in the convex hull.
\end{proof}

\begin{lemma}[]\guid{OIQKKEP}
 Let $\u,\v\in \BB$.  Assume that $\norm{\u}{\v} \le c < 4$, for some $c$.
Then
\[
\arc_V(\orz,\u,\v) \le \arc(2,2,c).
\]
\end{lemma}

\begin{proof}
\[
\arc_V(\orz,\u,\v) = \arc(\normo{\u},\normo{\v},\norm{\u}{\v}).
\]
The function $\arc$ is decreasing in the first two arguments and increasing in the third.
\end{proof}

\begin{lemma}[]\guid{BGSAKHJ}
\formalauthor{Hoang Le Truong}
Let $(V,E,F)$ be a lunar fan with pole $(\v,\w)$.  Then $\orz$ lies in the convex hull of $\{\v,\w\}$.
\end{lemma}

\begin{proof} This follows directly from the definition of a lunar fan.
\end{proof}

\begin{lemma}[]\guid{MXQTIED}\label{lemma:transfer-prelim} 
\formalauthor{Hoang Le Truong}
Let $s$ be a basic SCS, and let $\v\in \MM_s$.  Let $s'$ be a basic SCS such that
$M(s')=M(s)$, $k(s')=k(s)$, $I(s')=I(s)$,  $\v\in \BB_{s'}$, $d(s')=d(s)$, $a_{ii}(s')=0$,
$a_{ij}(s') = a_{ij}(s)$ for all edges $(i,j)$, and
\[
a_{ij} (s) \le a_{ij}(s') \le \norm{\v_i}{\v_j} \le b_{ij}(s') \le b_{ij}(s).
\]
Then  $\v\in \MM_{s'}$.
\end{lemma}

\begin{proof} 
Clearly $\v\in \BB_{s'}$.  
The domain shrinks and $\v$ is a global minimizer, so $\v\in \BB'_{s'}$.
By the hypotheses the constants $a_{ij}$ are the same on edges, so the index remains the same, and $\v\in \BB''_{s'}$.
The SCS is unadorned, so $\v\in \MM_{s'}$.
\end{proof}

\begin{lemma}[]\guid{XWNHLMD}
\formalauthor{Hoang Le Truong}
Let $s$ and $s'$ be basic SCSs with $d(s') \ge d(s)$,  $k(s) = k(s')$, and $I(s) = I(s')$.
Suppose that $\v\in \MM_s \cap \BB_{s'}$.
Then $\{s\}\Ra \{s'\}$.
\end{lemma}

\begin{proof}
The condition $\v\in\MM_s$ gives $\tau^*(s',\v)\le \tau^*(s,\v)<0$.  Hence $\BB'_s$ is nonempty.
The SCS is basic, so $\BB''_{s'} = \MM_{s'}$ is also nonempty.
\end{proof}

\begin{lemma}\guid{SYNQIWN}\label{lemma:scs-obtuse}
\formalauthor{Hales}
Let $s$ be a basic SCS and let $\v\in \BB_s$. Let $i\in I(s)$.
Assume that at least two the following four lengths are equal to $2$:
\[
\normo{\v_i},\quad \norm{\v_i}{\v_{i+1}},\quad
\normo{\v_{i+2}},\quad \norm{\v_{i+2}}{\v_{i+1}}
\]
Assume that $\stab\le \norm{\v_i}{\v_{i+2}}$.  Then the interior angle at $i+1$ is
greater than $\pi/2$.
\end{lemma}

\begin{proof} This is a \cc{1117202051~4559601669~4559601669b}{}.
\end{proof}

\begin{lemma}[lunar prep]\guid{AXJRPNC}\label{lemma:lunar-prep}
\formalauthor{Hoang Le Truong}
Let $s$ be a basic SCS and let $\v\in \MM_s$.  Assume that $b_{ij}(s)\le \stab$ for all edges $\{i,j\}$.
Assume that $(V_\v,E_\v,F_\v)$ is a lune with pole $(\v_p,\v_q)$.  Then $k(s)=6$ and $q = p+3$.
\end{lemma}

\begin{proof}
We first consider the case that $k=6$ and $q=p$, $p+1$, or $p+2$.  Then $M(s)=\emptyset$ and
the polar criterion gives the result, when applied to
\[
2\arc(2,2,2h_0) < \pi.
\]

Assume for a contradiction that $k<6$.  In particular, the floor of $k/2$ is at most $2$.
We have $\norm{\v_i}{\v_j} < 4$ for every edge, and this implies that $(p,q)$ is not an edge.
We have that $k> 3$; for otherwise $(p,q)$ is an edge.
Without loss of generality we may assume that $q=p+2$.

We start a special case by assuming that $M(s)$ meets $\{(p,p+1),(p+1,p+2)\}$ in a set of cardinality at most one.
Then by the monotonicity of $\arc$, we apply the polar test
\[
\arc(\orz,\v_p,\p)+\arc(\orz,\p,\v_q) \le \arc(2,2,2h_0) + \arc(2,2,\stab) < \pi,
\]
to see that $(p,q)$ is not a pole.

In the final case we assume that $M(s)$ meets $\{(p,p+1),(p+1,p+2)\}$ in a set of cardinality two.
By the inequality $m + k\le6$, we see that $m=2$ and $k=4$.  This implies that $M(s)$ is disjoint
from $\{(p+2,p+3),(p+3,p)\}$.  By the polar test,
\[
\arc_V(\orz,\v_p,\v_q) \le 2\arc(2,2,2h_0) < \pi,
\]
and again $(p,q)$ is not a pole.
\end{proof}

A weak version of the following lemma has been formalized as {\tt RRCWNS\_WEAK}.

\begin{lemma}[genericity]\guid{RRCWNSJ}\label{lemma:lune-main}
\formalauthor{Hoang Le Truong}
Let $s$ be a basic SCS  and $\v\in \MM_s$.  Assume that $4h_0< b_{ij}(s)$
for every diagonal $(i,j)$. 
Assume that $a_{ij}(s) \le \stab < \norm{\v_i}{\v_j}$ for every diagonal $(i,j)$.
 Assume that $b_{ij}(s)\le \stab$ for every edge $(i,j)$.
Then $(V_\v,E_\v,F_\v)$ is generic.
\end{lemma}

\begin{proof}
An earlier lemma shows that $(V_\v,E_\v,F_\v)$ is not circular.

Assume for a contradiction that $(V_\v,E_\v,F_\v)$ is lunar with pole $(\v_p,\v_q)$.  The previous lemma
gives $k(s) = 6$ and $q = p+3$.  By the definition of SCS, we have $m=0$.  That is, $b_{ij}(s)\le 2h_0$ and
$a_{ij}=2$ for all edges.

By the deformation ODX applied at $p+1$, we have 
\[
\normo{\v_{p+1}}=2,\text{ or } \norm{\v_{p+1}}{\v_p}=2,\text{ or } \norm{\v_{p+1}}{\v_{p+2}}=2.
\]
Furthermore, if the third possibility holds: $\norm{\v_{p+1}}{\v_{p+2}}=2$, then the deformation IMJ at $p+1$ gives
that one of the first two possibilities hold.

By similar reasoning at vertex $p-1$, we have
\[
\normo{\v_{p-1}}=2,\text{ or } \norm{\v_p}{\v_{p-1}}=2.
\]

By Lemma~\ref{lemma:scs-obtuse}, the interior angle at $p$ is greater than $\pi/2$.  This is contrary
to Lemma~\label{lemma:not-circular} (JKQEWGV).
\end{proof}

\begin{lemma}[exists-2]\guid{JCYFMRP}\label{lemma:exists-2}
 Let $s$ be a basic SCS, with $3 < k(s)$, and let $\v\in \MM_s$ be generic.  Assume that  $4h_0 < b_{ij}(s)$
for all diagonals, and that $m(s)\le 1$.  Assume that $a_{ij}(s)=2$ for all edges $\{i,j\}$.  
Assume that for all diagonals $\{i,j\}$
\[
a_{ij}(s)\le \stab < \norm{\v_i}{\v_j} \text{ and } 4h_0 < b_{ij}(s).
\]
Then there exists an edge $\{i,j\}$ such that $\norm{\v_i}{\v_j}=2$.
\end{lemma}

\begin{proof} For a contradiction, assume $\norm{\v_i}{\v_j}>2$ for all edges.
Apply the deformation ODX at every vertex $\ell$.  Then $\normo{\v_\ell}=2$ for all $\ell$.
Since $m(s)\le 1$, we have some index $p$ such that for every edge $(i,i+1)$ other than $(p,p+1)$,
we have $b_{ij}(s)\le 2h_0$.

By Lemma~\ref{lemma:scs-obtuse}, the interior angle is obtuse  at every $i$, such that $i\ne p,p+1$.
We claim that each of the vertices $\v_i$ is straight $i\ne p,p+1$.  For otherwise, we may apply
the obtuse case of deformation 482 to conclude that some edge has length $2$.

Thus, we have constructed $k-2$ straight angles.  This is contrary to Lemma~\ref{lemma:straight-count}.
\end{proof}

\begin{lemma}[propagate-min-std]\guid{TFITSKC}\label{lemma:propagate-min-std}
Let $s$ be a basic SCS, with $3 < k(s)$, and let $\v\in \MM_s$ be generic.  Let $p\in I(s)$.
Assume  that $(p,p+1)$ is a standard
edge.  Assume that $\norm{\v_{p-1}}{\v_p} = 2$.  
Assume that for all diagonals $\{i,j\}$
\[
a_{ij}(s)\le \stab < \norm{\v_i}{\v_j} \text{ and } 4h_0 < b_{ij}(s).
\]
Assume
\[
2 < b_{p-1,p}(s),\quad \le a_{p+1,p+2}(s) < b_{p+1,p+2}(s)
\]
Then $\norm{\v_p}{\v_{p+1}}=2$.
\end{lemma}

\begin{proof} Assume for a contradiction that $\norm{\v_p}{\v_{p+1}}>2$.

We claim that $\v_p$ is not straight.  Otherwise, deformation  NUX applied at $\v_p$ gives
$\norm{\v_p}{\v_{p+1}} = 2$.

We claim that $\normo{\v_{p+1}}>2$.  Otherwise, by Lemma~\ref{lemma:scs-obtuse}, the interior angle
at $\v_p$ is obtuse, and the obtuse case of deformation 482 gives the $\norm{\v_p}{\v_{p+1}} = 2$.

By deformation ODX applied at $p+1$, we have $\norm{\v_{p+1}}{\v_{p+2}} =a_{p+1,p+2}$.

We claim that $\v_{p+1}$ is not straight.  Otherwise, deformation  NUX applied at $\v_{p+1}$ gives
$\norm{\v_p}{\v_{p+1}} = 2$.

Finally, we may apply the deformation 482 in the non-obtuse case at $p+1$ to obtain $\norm{\v_p}{\v_{p+1}}=2$.
\end{proof}

\begin{lemma}[propagate-min-std2]\guid{CQAOQLR}\label{lemma:propagate-min-std2}
Let $s$ be a basic SCS, with $3<k(s)$, and let $\v\in \MM_s$ be generic.   Assume that
for all diagonals $\{i,j\}$, we have
$a_{ij}(s)\le \stab < \norm{\v_i}{\v_j}$ and $4h_0 < b_{ij}(s)$.
Assume
\[
2 < b_{p,p+1},\quad 2 < b_{p,p-1},\quad a_{p+1,p+2}<b_{p+1,p+2},\quad a_{p-2,p_1} < b_{p-2,p-1}.
\]
Assume
\[
a_{ij} < b_{ij}
\]
for all edges.
Then for every $p$, such that $(p-1,p)$ and $(p,p+1)$ are both standard, either
both of $\norm{\v_{p}}{\v_{p+1}}$ and $\norm{\v_p}{\v_{p-1}}$ equal $2$, or neither equals $2$.
\end{lemma}

\begin{proof}
This follows from Lemma~\ref{lemma:propagate-min-std} and the reversal symmetry of stable constraint systems.
\end{proof}

\begin{lemma}[propagate-min-std3]\guid{JLXFDMJ}\label{lemma:propagate-min-std3}
Let $s$ be a basic SCS, and let $\v\in \MM_s$ be generic.   Assume that $m(s)\le 1$.  
Assume that
for all diagonals $\{i,j\}$, we have
$a_{ij}(s)\le \stab < \norm{\v_i}{\v_j}$ and $4h_0 < b_{ij}(s)$.
Assume
\[
a_{ij} < b_{ij}
\]
for all edges.
Assume that $\norm{\v_i}{\v_{i+1}}=2$ for some edge $\{i,i+1\}$.  
Then $\norm{\v_i}{\v_j}=2$ at every  edge not in $M(s)$.
\end{lemma}

\begin{proof}  Let $\{j,j+1\}$ be any standard edge.  We may create a chain avoiding $M(s)$ of the form
\[
\{j,j+1\}, \{j+1,j+2\},\ldots, \{i-1,i\},
\]
or 
\[
\{i+1,i+2\}, \{i+2,i+3\},\ldots \{j,j+1\}.
\]
Induction along the chain using Lemma~\ref{lemma:propagate-min-std2} gives the result.
\end{proof}


If $s$ is a SCS,
with  diagonal $\{i,j\}$, let $D(s,\{i,j\})$ be the SCS which is identical to $s$, except that
$b_{ij}(D(s,\{i,j\})) =\stab$.   In particular, we have a SCS $D(6I1,\{i,j\})$.

\begin{lemma}\guid{YRTAFYH}
If $s$ is a basic SCS, $\{i,j\}$ is a diagonal, and
$a_{ij}(s)\le\stab$, then $D(s,\{i,j\})$ is a basic SCS.
\end{lemma}


\begin{lemma}[equivalent diagonal]\guid{WKEIDFT}\label{lemma:equivalent-diagonal}
Let $s$ be a basic SCS with $k(s)>3$.  
Assume that the constants $a_{ij}(s)$ and $b_{ij}(s)$ are independent of
the subscript for all edges $\{i,j\}$.  Assume that the constants
$a_{ij}(s)$ and $b_{ij}(s)$ are independent of the subscript for all diagonals.
Assume $a_{ij}(s)\le stab$ for all diagonals.
Let $\{p,q\}$ and $\{p',q'\}$ be diagonals with $p'+q = p+q'$.
Then
\[
\{D(s,\{p,q\})\} \Ra \{D(s,\{p',q'\})\}.
\]
\end{lemma}

\begin{proof}  This follows from the equivalence of the two SCSs.
\end{proof}

\subsection{hexagons}

In this subsection, we treat the initial SCS 6I1.




\begin{lemma}[]\guid{PEDSLGV} Let $\v\in \MM_{6I1}$.  If for some diagonal $\{i,j\}$, we have $\norm{\v_i}{\v_j}\le \stab$,
then $\v\in \MM_{D(6I1,\{i,j\})}$.  If for every diagonal $\{i,j\}$, we have $\stab < \norm{\v_i}{\v_j}$, then
$\v \in \MM_{6M1}$.
\end{lemma}

\begin{proof} This is a direct consequence of Lemma~\ref{lemma:transfer-prelim}.
\end{proof}



\begin{lemma}[hex slice]\guid{AQICLXA}\label{lemma:hex-slice}
We have
\[
D(6I1,\{0,2\}) \Ra \{5M1,3M1\}.
\]
\end{lemma}

\begin{proof}
Slice $D(6I1,\{0,2\})$ along the diagonal $\{0,2\}$.
\end{proof}

\begin{lemma}[hex slice2]\guid{FUNOUYH}\label{lemma:hex-slice2}
We have
\[
D(6I1,\{0,3\}) \Ra \{4M2\}.
\]
\end{lemma}

\begin{proof}
Slice $D(6I1,\{0,3\})$ along the diagonal $\{0,3\}$. The two halves are equivalent.
\end{proof}

\begin{lemma}[hex slice 3]\guid{OEHDBEN}\label{lemma:hex-slice3}
$\{6I1\}\Ra \{6T1,5M1,4M2,3M1\}.$
\end{lemma}

\begin{proof}
Let $\v\in \MM_{6I1}$.  

Assume first that there is a diagonal $\{i,i+2\}$ such that $\norm{\v_i}{\v_{i+2}}\le \stab$.
Then by the previous lemmas,
\[
\{6I1\}\Ra \{D(6I1,\{i,j\})\} \Ra \{D(6I1,\{0,2\})\} \Ra \{5M1,3M1\}.
\]

Assume next
that there is a diagonal $\{i,i+3\}$ such that $\norm{\v_i}{\v_{i+1}}\le \stab$.
Then by the previous lemmas,
\[
\{6I1\}\Ra \{D(6I1,\{i,j\})\} \Ra \{D(6I1,\{0,3\})\} \Ra \{4M2\}.
\]

In a hexagon, every diagonal has the form $\{i,i+2\}$ or $\{i,i+3\}$.  We may now assume that
for every diagonal, $\stab < \norm{\v_i}{\v_j}$.  By Lemma~\ref{lemma:lune-main}, $\v$ is generic.
By Lemma~\ref{lemma:exists-2}, there exists an edge $\{i,j\}$ such that $\norm{\v_i}{\v_j} = 2$.
By Lemma~\ref{lemma:propagate-min-std3} [propagate-min-std3], all edges have length $2$.
Hence $\v\in \BB_{6T1}$ and $\{6I1\}\Ra \{6T1\}$.
\end{proof}

In the section on pentagons, we make a further analysis of 5M1; and in the section on quadrilaterals, we analyze 4M2.
This completes our analysis of hexagons.  

\subsection{pentagons}

In this section, we treat the pentagonal cases: 5I1, 5I2, 5I3, 5M1.

\begin{lemma}[]\guid{OTMTOTJ}
\begin{align*}
\{5I1\}&\Ra \{D(5I1,\{0,2\}),5M2\}\\
\{5I2\}&\Ra \{D(5I2,\{0,2\}),5M2\}\\
\{5I3\}&\Ra \{D(5M1,\{0,2\}),D(5M1,\{0,3\}),D(5M1,\{2,4\}),5M2\}\\
\{5M1\}&\Ra \{D(5M1,\{0,2\}),D(5M1,\{0,3\}),D(5M1,\{2,4\}),5M2\}\\
\end{align*}
\end{lemma}

\begin{proof}
Let  $s\in \{5I1,5I2,5I3,5M1\}$.
Let $\v\in\MM_s$.  If $\norm{\v_i}{\v_j}>\stab$ for every diagonal $\{i,j\}$, then $s$ transfers to 5M2,
and $\{s\}\Ra \{5M2\}$.

For every diagonal,
we have 
\begin{equation}\label{eqn:d513}
\{D(5I3,\{i,j\})\}\Ra \{D(5M1,\{i,j\})\}.
\end{equation}

Now, let $\{i,j\}$ be a diagonal such that $\norm{\v_i}{\v_j}\le \stab$.  
Then $\{s\}\Ra \{D(s,\{i,j\})\}$ and by equivalence $\{D(s,\{i,j\})\}$ and the arrow ~\eqref{eqn:d513},
we may pass to one of the SCSs enumerated in the lemma.
\end{proof}

\begin{lemma}[]\guid{HIJQAHA}
\[
\{5M2\}\Ra \{3T1,3T4,4M6,4M7,4M8,5T1,D(5I2,\{0,2\}),D(5M1,\{0,2\}),D(5M1,\{0,3\}),D(5M1,\{2,4\}) \}
\]
\end{lemma}

\begin{proof}
Let $\v\in\MM_{5M2}$.  
Assume first that $\norm{\v_i}{\v_j}\le \stab$ for some diagonal $\{i,j\}$.
We consider subcases depending on the length of edges $\norm{\v_i}{\v_j}$.
If $\norm{\v_0}{\v_1}\le 2h_0$, then 
\[
\{5M2\}\Ra \{D(5I2,\{i,j\})\},
\]
and otherwise if  $2h_0 < \norm{\v_0}{\v_1} \le \sqrt8$, then
\[
\{5M2\}\Ra \{D(5I3,\{i,j\})\},
\]
These SCSs transfer to one of the terms on the right-hand side in the lemma.
In the final case $\sqrt8\le \norm{\v_0}{\v_1}\le \stab$.  We can take the diagonal to be $\{0,2\}$, $\{0,3\}$,
or $\{2,4\}$.  For these three diagonals, we have respectively,
\[
\{5M2\}\Ra \{D(5M2,\{i,j\})\}\Ra \{4M6,3T4\},\quad \text{or~} \{3T1,4M7\},\quad \text{or~} \{3T1,4M8\}.
\]

We now assume $\norm{\v_i}{\v_j}>\stab$ for all diagonals.
By Lemma~\ref{lemma:lune-main}, $\v$ is generic.
By Lemma~\ref{lemma:exists-2}, there exists an edge $\{i,j\}$ such that $\norm{\v_i}{\v_j} = 2$.
By Lemma~\ref{lemma:propagate-min-std3}, all standard edges of $\v$ have length $2$.

Index the vertices so that $\{0,1\}$ is the non-standard edge.  If either $\v_0$ or $\v_1$ is straight, then
the deformation NUX implies that the edge $\{0,1\}$ is as short as possible, length $2$.  
If neither of the two vertices is straight, then we may apply deformation 684, to again conclude the edge $\{0,1\}$
is as short as possible.
%
%We apply deformation 684 as follows.  We fix the positions of $\v_1,\v_2,\v_3$, and apply the deformation 684
%to the triangle $\v_1,\v_3,\v_0$, moving $\v_0$ towards $\v_1$.  The vector $\v_2$ drags along in a way to preserve
%the edge lengths among $\{\orz,\v_0,\v_3,\v_4\}$.
In these cases
$\{5M2\}\Ra\{5T1\}$.
\end{proof}

\begin{lemma}[]\guid{CNICGSF}
\begin{align*}
\{D(5I1,\{0,2\})\}&\Ra \{4M2,3M1\}\\
\{D(5I2,\{0,2\})\}&\Ra \{4M3,3T1\}\\
\{D(5M1,\{0,2\})\}& \Ra \{4M2,3T4\}\\
\{D(5M1,\{0,3\})\}& \Ra \{4M4,3M1\}\\
\{D(5M1,\{2,4\})\}& \Ra \{4M5,3M1\}
\end{align*}
\end{lemma}

\begin{proof}
In each case, we slice the given SCS along the given diagonal $\{i,j\}$ to produce a quadrilateral and
a triangle.  The resulting pieces (up to equivalence and transfer) are shown on the right.
\end{proof}


\subsection{quadrilaterals}

Next we turn to the analysis of quadrilaterals.

\begin{lemma}[]\guid{GSXRFWM}\label{lemma:generic-4}
Let $s$ be an SCS with $k(s)= 4$.
Let $\v\in \MM_s$.  Then $\v$ is generic.
\end{lemma}

\begin{proof}
Assume $k=4$.
Recall $m(s) + k(s) \le 6$ so that $m(s)\le 2$.
There is no pole, because of the polar test
\[
\arc(2,2,2h_0) + \arc(2,2,\stab) < \pi.
\]
\end{proof}


\begin{lemma}[]\guid{ARDBZYE}
\[
\{4I2\}\Ra \{4T1,4T2\}.
\]
\end{lemma}

\begin{proof}
Let $\v\in M_{4I2}$. By Lemma~\ref{lemma:generic-4}, $\v$ is generic.

We consider the case when both diagonals of $\v$ are greater than $\stab$.
By Lemma~\ref{lemma:exists-2}, there exists an edge $\{i,j\}$ such that $\norm{\v_i}{\v_j}=2$.
By Lemma~\ref{lemma:propagate-min-std3}, all edges have length $2$.  This gives $\{4I2\}\Ra\{4T1\}$.

We turn to the case when some diagonal, say $\{1,3\}$ has length in the range $\leftclosed 3,\stab\rightclosed$.
Without loss of generality, we may assume that $\{1,3\}$ is the shorter of the two diagonals.
By Lemma~{\tt ear\_acute}, a quadrilateral with diagonals at least $3$ does not have any straight $\v_i$.
If diagonal $\{0,2\}$ has length $3$ then since it is the longest, both diagonals are $3$, and $\{4I2\}\Ra\{4T2\}$.
If the diagonal $\{0,2\}$ has length greater than $3$, we may triangulate the quadrilateral along the diagonal
$\{1,3\}$ and apply non-obtuse deformation 482 at any edge to show that it has length $2$.  Hence,
$\{4I2\}\Ra\{4T1\}$.
\end{proof}

\begin{lemma}[]\guid{FYSSVEV}
\[
\{4I1\}\Ra \{4I2,D(4I1,\{0,2\})\}
\]
\end{lemma}

\begin{proof}  Let $\v\in \MM_{4I1}$.  If $\v$ has some diagonal $\{0,2\}$ that is less than $\stab$,
then
\[
\{4I1\}\Ra\{D(4I1,\{i,j\})\}\Ra\{D(4I1,\{0,2\})\}.
\]
Otherwise, with long diagonals, we have a transfer
\[
\{4I1\}\Ra \{4I2\}.
\]
\end{proof}

\begin{lemma}[]\guid{AUEAHEH}
\[
\{D(4I1,\{0,2\})\}\Ra \{3M1\}.
\]
\end{lemma}

\begin{proof}
Slice along the diagonal $\{0,2\}$.
\end{proof}

\begin{lemma}[]\guid{ZNLLLDL}
\[
\{D(4I3,\{0,2\})\}\Ra \{4T4\}.
\]
\end{lemma}

\begin{proof}
In fact,  4T4 is equivalent to $D(413,\{0,2\})$.
\end{proof}

\begin{remark}  The terminal case 4T4 is treated by slicing along the diagonal $\{0,2\}$ and introducing
a nontrivial $J$.
\end{remark}

\begin{lemma}[]\guid{VQFYMZY}
\[
\{4I3\}\Ra\{4T4,4M6\}.
\]
\end{lemma}

\begin{proof}
Let $\v\in \MM_{4I3}$.  
If there is a diagonal $\{i,j\}$ of length at most $\stab$, and we have
\[
\{4I3\}\Ra\{D(4I3,\{i,j\})\}\Ra \{D(4I3,\{0,2\})\} \Ra\{4T4\}.
\]
If both diagonals are greater than $\stab$, there is an equi-transfer to 4M6.
\end{proof}

%\begin{lemma}[]\guid{CNFNTYP}
%$\{4M1\}\Ra\{4M2,4M6\}$.
%\end{lemma}

%\begin{proof} 
%If there exists $\v\in \MM_{4M1}$ and a diagonal $\{i,j\}$ such that $\norm{\v_i}{\v_j}\le \stab$,
%then $\{4M1\}\Ra\{4M2\}$.  Otherwise, $\{4M1\}\Ra\{4M6\}$.
%\end{proof}

\begin{lemma}[]\guid{BNAWVNH}
$\{4M2\}\Ra\{3M1,3T4,4M6\}$.
\end{lemma}

\begin{proof}
If there exists $\v\in \MM_{4M2}$ and a diagonal $\{i,j\}$ such that $\norm{\v_i}{\v_j}\le \stab$,
then slice along the diagonal $\{i,j\}$ to obtain $\{4M2\}\Ra \{3T5,3T4\}$.
Otherwise, $\{4M2\}\Ra\{4M6\}$.
\end{proof}

\begin{lemma}[]\guid{RAWZDIB}
$\{4M3\}\Ra\{3T1,3T6,4M6\}$.
\end{lemma}

\begin{proof}
If there exists $\v\in \MM_{4M3}$ and a diagonal $\{i,j\}$ such that $\norm{\v_i}{\v_j}\le \stab$,
slice along the diagonal $\{i,j\}$ to obtain 
 $\{4M3\}\Ra \{3M1,3T6\}$.
Otherwise, $\{4M3\}\Ra\{4M6\}$.
\end{proof}

\begin{lemma}[]\guid{MFKLVDK}
$\{4M4\}\Ra\{3T4,3M1,3T3,4M7\}$.
\end{lemma}

\begin{proof}
If there exists $\v\in \MM_{4M4}$ and a diagonal $\{i,j\}$ such that $\norm{\v_i}{\v_j}\le \stab$,
slice along the diagonal $\{i,j\}$ to obtain 
 $\{4M4\}\Ra \{3T4,3M1,3T3\}$.
Otherwise, $\{4M4\}\Ra\{4M7\}$.
\end{proof}

\begin{lemma}[]\guid{RYPDIXT}
$\{4M5\}\Ra\{3T4,4M8\}$.
\end{lemma}

\begin{proof}
If there exists $\v\in \MM_{4M5}$ and a diagonal $\{i,j\}$ such that $\norm{\v_i}{\v_j}\le \stab$,
slice along the diagonal $\{i,j\}$ to obtain 
 $\{4M5\}\Ra \{3T4\}$.
Otherwise, $\{4M5\}\Ra\{4M8\}$.
\end{proof}

The quadrilateral cases that remain are 4M6, 4M7, and 4M8.


\begin{lemma}[]\guid{WGDHPPI}
Let $s$ be an SCS with $k(s)=4$.
Let $\v\in \MM_s$.  Then the number of straight vertices $\v_i$ is at most $1$.
\end{lemma}

\begin{proof}
Lemma~\ref{lemma:generic-4} implies that $\v$ is generic. Lemma~\ref{lemma:straight-count} gives the result.
\end{proof}

\begin{lemma}[]\guid{ASSWPOW}\label{lemma:15.53}
Let $s$ be a basic SCS with $k(s)=4$.
Let $\v\in \MM_s$.  
Let  $p\in I(s)$.
Assume that the constraints at $(p-1,p)$ and $(p,p+1)$ are both standard.  Then
$\op{xrr}_V(\v_{p-1},\v_{p+1}) \le 15.53$.
\end{lemma}

\begin{remark} The constant $15.53$ appears in several of the computer calculations for
nonlinear inequalities.
\end{remark}

\begin{proof}  
This follows from the triangle inequality.
\[
\arc_V(\orz,{\v_{\ell-1}},{\v_{\ell+1}}) \le 2\arc(2,2,2h_0)<\arc(2,2,\sqrt{15.53}).
\]
\end{proof}

\begin{remark}[Running assumptions] 
The following lemmas will have several assumptions in common.  We list them
here as conditions on $(s,v)$.
\begin{enumerate}
\item $s$ is an SCS
\item $k=4$
\item $\v\in \MM_s$.
\item For all diagonals, $a_{ij} \le \stab < \norm{\v_i}{\v_j}$ and $4h_0 < b_{ij}$.
\item The constraint on each edge is standard or \prop.  (In particular $m$ is the number of edges with \prop~
constraints.)
\end{enumerate}
\end{remark}

\begin{lemma}\guid{YEBWJNG} 
Let $(s,v)$ satisfy the running assumptions.  If the constraint on $(p,p+1)$ is standard
and if $\v$ is not straight at $p$ and $p+1$, then $\norm{\v_p}{\v_{p+1}}=2$.
\end{lemma}

\begin{proof} This is a direct consequence of deformation 482.
\end{proof}

\begin{lemma}[]\guid{TUAPYYU}\label{lemma:tua}
Let $(s,v)$ satisfy the running assumptions.  Assume that $\v$ is not straight at $p$ and $p+1$.
Then $\norm{\v_p}{\v_{p+1}} = a_{p,p+1}$ or $b_{p,p+1}$.
\end{lemma}

\begin{proof} Either $\v_{p-1}$ or $\v_{p+2}$ is not straight.  Use deformation 1834 or deformation (1834 sym),
as appropriate.
\end{proof}

\begin{lemma}[]\guid{WKZZEEH} Let $(s,v)$ satisfy the running assumptions.  Assume that $\v$ is not straight
at $p$, $p-1$, and $p+1$.  Then $\norm{\v_p}{\v_{p-1}} < \stab$ or $\norm{\v_p}{\v_{p+1}} < \stab$.
\end{lemma}

\begin{proof} This is a restatement of deformation 684.
\end{proof}

\begin{lemma}[]\guid{PWEIWBZ} Let $(s,v)$ satisfy the running assumptions.  Then $\norm{\v_p}{\v_{p+1}}=2$
for every standard edge.
\end{lemma}

\begin{proof} Assume $(p,p+1)$ standard.  If $\v$ is not straight at $p$ and $p+1$, then YEBWJNG
gives the result.  We may now assume without loss of generality that $\v$ is straight at $p$ or $p+1$.
Shifting indices, we may assume that $\v$ is straight at $p$ and that $(p,q)$ is standard, where $q=p\pm 1$.
For a contradiction, we may assume that $\norm{\v_p}{\v_{q}}$ is not minimal.  
In fact, by NUX, we may assume that no edge at $p$ is minimal.
By IMJ, $\normo{\v_p}=2$.


%\claim{We claim that if $(p-1,p)$ is also standard, then we may assume that 
%$\norm{\v_{p+1}}{\v_{p+2}}\le \norm{\v_{p+2}}{\v_{p-1}}$}.  In fact, by NUX, $(p-1,p)$ is minimal if and only
%if $(p+1,p)$ is minimal.  Thus, by symmetry, we may reverse $s$ if necessary, so that the inequality holds.

We review the conditions at $(i,j)=(p+1,p+2)$ and $(p+2,p+3)$, the two edges away from the straight angle $p$.
By Lemma~{\tt TUAPYYU}, $\v$ is extremal along edges $(p+1,p+2)$ and $(p+2,p+3)$. Hence
along these two edges $\norm{\v_i}{\v_j}$ is $2$, $2h_0$, or $\stab$.  By Lemma~{\tt TUAPYYU},
one of the two edges $\norm{\v_i}{\v_j}\le 2h_0$.  
By Lemma~{\tt YEBWJNG}, if the constraint at $(i,j)$
is standard, then $\norm{\v_i}{\v_j}=2$. 

%If $i=p+2$ and $(j,p)$ is standard, then $\angle \v_j$ is acute,
%for otherwise,  Lemma~\ref{  } propagates the edge of length $2$ to produce a minimal
%edge $\norm{\v_j}{\v_p}=2$ at $p$, contrary to assumption.


If $(p,j)$ is a standard edge at $p$, with $j=p\pm 2$,
then $(j,p+2)$ is \prop. Otherwise, by earlier remarks $\norm{\v_j}{\v_{p+2}}=2$, which propagates
to make $\norm{\v_p}{\v_j}=2$ by {\tt TFITSKC}, which is contrary to what we have.

We consider four subcases:
\begin{enumerate}
\item $(p-1,p)$ and $(p,p+1)$ are both standard.  Also, $\norm{\v_{p+1}}{\v_{p+1}}\le 2h_0$.
\item $(p-1,p)$ and $(p,p+1)$ are both standard.  Also, $\norm{\v_{p+2}}{\v_{p-1}}\le 2h_0$.
\item $(p,p+1)$ is standard,  $(p-1,p)$ is \prop.
\item $(p,p-1)$ is standard,  $(p,p+1)$ is \prop.
\end{enumerate}

If $(p,j)$ is a standard edge at $p$, with $j=p\pm 1$, then the angle at $j$ is acute. Otherwise,
deformation 482 obtuse makes $(p,j)$ minimal.  We use a computer calculation to contradict this fact.

In the first two cases, by \cc{6184614449,~1348932091,~1348932091 delta,~5557288534,~5557288534 delta}{}
we may use {\tt LEMMA\_PWE1} and {\tt LEMMA\_PWE2}, respectively.  Note that both edges at $p+2$
are \prop.

In the third case, the edge $(p+1,p+2)$ is \prop, and the edge $(p+2,p+3)$ is standard (because $m\le 2$)
of length $2$.  Use {\tt LEMMA\_PWE3}, which is based on a 
\cc{2073661826,~8405387449,~9368433105,~5550839403,~5550839403 delta}{}.

The fourth case is symmetrical with the third, and uses {\tt LEMMA\_PWE4}.
%
%By deformation 482, we also have $\angle \v_{q}$ is not obtuse.
%
%\claim{We claim that $(p+1,p+2)$ is not standard.}  Otherwise, by YEBWJNG, its length is $2$, and
%this propagates to $(p,p+1)$.
%
%By TUAPYYU, edges $(p+1,p+2)$ and $(p+2,p-1)$ are both extremal.
%
%We consider the case when $(p-1,p)$ is standard.  By Lemma~{\tt WKZZEEH}, one of the
%extremal edges $(p+1,p+2)$ and $(p+2,p-1)$ is minimal.  By the symmetry reduction above,
% $\norm{\v_{p+1}}{\v_{p+2}}\le 2h_0$.   By a , 
%using obtuseness at $\angle \v_{p+1}$, we have $\angle \v_p < \pi$, a contradiction.
%
%Finally, we consider the case when $(p-1,p)$ is \prop.  Since $m\le 2$, this forces $(p+2,p-1)$
%to be standard. By YEB, $\norm{\v_{p+2}}{\v_{p-1}}=2$.  By a 
%\cc.
%using obtuseness at $\angle\v_{p+1}$, we have $\angle \v_p < \pi$, a contradiction.
\end{proof}

\begin{lemma}[]\guid{VASYYAU}  Let $(s,v)$ satisfy the running assumptions.  Let $\v$ be
straight at $p$.  Then both edges at $p$ are minimal.
\end{lemma}

\begin{proof}  If there exists a standard constraint at some edge at $p$, then by PWEIBZ, it is minimal.
By NUX, the other edge at $p$ is also minimal.  In this case we are done.

If, on the other hand, there does not exist a standard constraint at some edge at $p$, then since $m\le 2$,
both edges at $p+2$ are standard.  The edges are $\v$-minimal and hence have length $2$.
The two edges at $p$ are \prop~ and hence have length $\ge 2h_0$.  Also, by ODX, IMJ, since some
edge at $p$ is not minimal, we have $\normo{\v_p} = 2$.

This violates the triangle inequality:
\begin{align*}
\arc(2,\normo{\v_{p-1}},2) + \arc(2,\normo{\v_{p+1}},2) &<
  \arc(2,\normo{\v_{p-1}},2h_0) + \arc(2,\normo{\v_{p+1}},2h_0) \\
  &\le \arc_V(\orz,\{\v_{p-1},\v_p\} ) + \arc_V(\orz,\{\v_{p+1},\v_p\} ) \\
  &= \arc_V(\orz,\{\v_{p-1},\v_{p+1}\} ) \\
  &\le \arc_V(\orz,\{\v_{p-1},\v_{p+2}\} ) + \arc_V(\orz,\{\v_{p+2},\v_{p+1}\} ) \\
  &\le \arc(2,\normo{\v_{p-1}},2) + \arc(2,\normo{\v_{p+1}},2).
\end{align*}
\end{proof}

\begin{lemma}[]\guid{NWDGKXH}
\[
\{4M6\}\Ra \{4T3,4T5\}.
\]
\end{lemma}

\begin{proof} Let $\v\in \MM_{4M6}$.  By the definition of 4M6, the diagonals are at least $\stab$.
If some diagonal has $\norm{\v_i}{\v_j}=\stab$, then
\[
\{4M6\}\Ra\{4T5\}.
\]
Otherwise,
by the preceding lemmas, all edges are extremal, and
all standard edges have length $2$.
  
By Lemma~{\tt quad\_nonexist\_849}, the nonstandard edge does not have $\norm{\v_i}{\v_j}=2h_0$.
Since the non-standard edge is extremal, this forces $\norm{\v_i}{\v_j}=\stab$.
In this case $\{4M6\}\Ra \{4T3\}$.
\end{proof}

\begin{lemma}[]\guid{EFLYGAU}
Let $\v\in \MM_{4M7}$.  If both diagonals of $\v$ are greater than $\stab$, then
\[
\{4M7\}\Ra \{4M6\}.
\]
\end{lemma}

\begin{proof}
By preceding lemmas, the nonstandard edges of $\v$ is extremal.  


If one of those
edges is minimal $2h_0$, then $\v$ is in the domain of $\MM_{4M6}$ and it transfers.

We prove in fact, that if both standard edges are maximal, then we obtain a contradiction.
Suppose for a contradiction, the two nonstandard edges are adjacent and have length $\stab$.  
By Lemma~{\tt VASYYAU}, neither nonstandard edge is adjacent to a vertex that is straight.
By {\tt WKZZEEH},  one of the nonstandard edges is minimal.
earlier lemma has ruled out adjacent edges of length $\stab$.
\end{proof}

\begin{lemma}[]\guid{YOBIMPP}
Let $\v\in \MM_{4M7}$.  If some diagonal has length $\stab$, then
\[
\{4M7\}\Ra \{3M1,3T3,3T4\}
\]
\end{lemma}

\begin{proof} Let $\{i,i+2\}$ be the diagonal such that $\norm{\v_i}{\v_{i+2}} = \stab$.

Assume first that the diagonal is $\{0,2\}$.
Slice along the diagonal to obtain 3M1 and 3T3.  Then $\{4M7\}\Ra\{3M1,3T3\}$.

In the remaining case, the diagonal is $\{1,3\}$.
Slice along the diagonal to obtain two equivalent pieces that transfer to 3T4.
\end{proof}

\begin{lemma}[]\guid{BJTDWPS}
Let $\v\in \MM_{4M8}$.  If both diagonals of $\v$ are greater than $\stab$, then
\[
\{4M8\}\Ra \{4M6,3T7\}.
\]
\end{lemma}

\begin{proof}
By preceding lemmas, the non-standard edges of $\v$ is extremal.  If one of those
edges is minimal $2h_0$, then $\v$ is in the domain of $\MM_{4M6}$ and it transfers.

Otherwise, both non-standard edges have length $\stab$.  Every non-standard edge
is adjacent to a standard edge.  By Lemma~{\tt PWEI WBZ},  these standard edges
are minimal; that is, they have length $2$.  By Lemma~{\tt quad\_diag\_362}, 
the shortest diagonal has length
at most $3.62$.  Slice along that diagonal, to obtain two pieces like 3T7.
Then $\{4M7\}\Ra\{3T7\}$.
\end{proof}

\begin{lemma}[]\guid{MIQMCSN}
Let $\v\in \MM_{4M8}$.  If some diagonal has length precisely $\stab$, then
\[
\{4M8\}\Ra \{3T4\}
\]
\end{lemma}

\begin{proof} 
Slice along the diagonal to obtain two equivalent pieces that transfer to 3T4.
(Compare the proof of {\tt RYPDIXT}.)
\end{proof}


This completes the analysis of the cases 4M6, 4M7, and 4M8.  
All quad cases have been resolved into terminal cases.



\subsection{triangles}



\begin{lemma}[]\guid{LFLACKU}
\formalauthor{TCH}
$\{3I1\}\Ra \{3T2,3T5\}$
\end{lemma}

\begin{proof} By deformation 1834,  we may assume that each edge $\{i,j\}$ is extremal, hence
of length $2$ or $2h_0$.  If all edges have length $2$, then
\[
\{3I1\}\Ra\{3T2\}.
\]
Otherwise,
\[
\{3I1\}\Ra\{3T5\}.
\]
\end{proof}

\begin{lemma}[]\guid{BKOSSGE}
\formalauthor{TCH}
$\{3M1\}\Ra \{3T1,3T5\}$.
\end{lemma}


\begin{lemma}\label{lemma:sterm-empty}\guid{OCBICBY}
\formalauthor{T. Hales}
\[
\MM_s=\emptyset,
\]
for all $s\in\sterm$.
\end{lemma}

\begin{proof}
When $s\in \sterm$
with $k(s)\le 4$, by a \cc{various inequalities}{}, we show
that $\tau^*(s,\v) \ge0$ for all $\v\in \BB_s$.  This implies for such $s$
that $\MM_s=\emptyset$.  The two cases $5T1$ and $6T1$ remain.
They are treated in Secton~\ref{sec:computer-main}, where it is shown
that $\MM_s=\emptyset$ for $ s=5T1$ and $6T1$.  This
shows that $\MM_s=\emptyset$ for all $s\in \sterm$.
\end{proof}

\subsection{unsorted lemmas}

We dump a few unsorted lemmas at the end of this appendix.

\begin{lemma}[]\guid{TECOXBM}\label{lemma:2hm-slice1}
\formalauthor{Hoang Le Truong}
Let $s$ be a SCS, and let $\v\in \BB_s$.
Let $\u,\w\in V_\v$ satisfy $2\le\norm{\u}{\w}\le \stab$ where
$\{\u,\w\}\not\in E_\v$.  Then $\u$ and $\w$ are nonparallel.
Moreover,
$C^0\{\u,\w\}\subset \Wdarto(x)$ for all $x\in F$.
\end{lemma}


\begin{proof}  This is a repetition of Lemma~\ref{lemma:2hm-slice}.
\end{proof}

\begin{definition}[$XR$]\guid{LIHVJNG}
We let
\[
XR(y_1,y_2,y_6) = 8 (1 - \frac{y_1^2 + y_2^2 - y_6^2}{2 y_1 y_2}).
\]
\end{definition}

\begin{lemma}[]\guid{KPIDBQH}
\formalauthor{Hales}
\[
\op{dih}_y(y_1,y_2,\ldots,y_6) = \dih_x(4,4,4,XR(y_2,y_3,y_4),XR(y_1,y_2,y_6),XR(y_1,y_3,y_5)).
\]
\end{lemma}

\begin{proof}
Compute both sides.
\end{proof}

\begin{lemma}[]\guid{DRNDRDV}
\formalauthor{Hales}
\[
\frac{\partial XR(y_1,y_2,y_6)}{\partial y_6} = \frac{8 y_6}{y_1 y_2}.
\]
\end{lemma}

\begin{lemma}[]\guid{TBRMXRZ}
\formalauthor{Hales}
Let $h(x) = g(f(x))$ and $f(x)= y$.  Assume $f'(x)>0$.  Then under appropriate differentiabilty conditions:
\begin{enumerate}
\item $g'(y) \sim h'(x)$.
\item $h'(x) = 0$ implies that $h''(x)\sim g''(y)$.
\end{enumerate}
\end{lemma}

\begin{proof}
\[
h'(x) = g'(y) f'(x) \sim g'(y).
\]
Also, if $h'(x) = 0$, then $g'(y)=0$ and
\[
h''(x) = g''(y) (f'(x))^2 + g'(y) f''(x) = g''(y) (f'(x))^2 \sim g''(y).
\]
\end{proof}


\newpage
\section{Appendix on explicit deformations}\label{sec:sup-deformation}

This is an appendix to Section 7.2 of Dense Sphere Packings.
This appendix gives the explicit construction of particular deformations.

The first lemma constructs a simplex $\{\v_0,\v_1,\v_2,\v_3\}\subset\ring{R}^3$ on
a given base triangle $\{\v_0,\v_1,\v_2\}$.  Our intention is to define a new constant
to equal the right-hand side of Equation~\ref{eqn:v3}.  The variable $x_5$ will run over
an interval to define a continuous deformation of a local fan $(V,E,F)$.


\begin{lemma}\guid{PQCSXWG}\label{lemma:PQC}  
Let $\{\v_0,\v_1,\v_2\}\subset \ring{R}^3$.  Assume that $\{\v_0,\v_1,\v_2\}$ is
not collinear.  Let $x_1,\ldots,x_6\in\ring{R}^3$ be given with $x_i> 0$ and
\[
x_1 = \norm{\v_1}{\v_0}^2, \quad x_2 = \norm{\v_2}{\v_0}^2,\quad x_6 = \norm{\v_1}{\v_2}^2.
\]
Assume that $\Delta(x_1,\ldots,x_6) > 0$  (that is, {\tt delta\_x x1 x2 ...}).
Then there exists  $\v_3$ such that
\begin{itemize}
\item $x_3 = \norm{\v_3}{\v_0}^2,\quad x_5 = \norm{\v_3}{\v_1}^2,\quad x_4 = \norm{\v_3}{\v_2}^2$, and
\item $(\v_1 - \v_0) \cdot (\v_2 - \v_0) \times (\v_3 - \v_0) > 0$.
\end{itemize}
Explicitly, the following vector works:
\begin{equation}\label{eqn:v3}
\v_3 = \v_0 +  \dfrac{2\sqrt{\Delta} (\v_1-\v_0) \times (\v_2 - \v_0) + 
\Delta_5  (\v_1-\v_0) + \Delta_4 (\v_2-\v_0)} {\ups(x_1,x_2,x_6)},
\end{equation}
with subscripts on $\Delta$ indicating partial derivatives and $\ups = \text{\tt ups\_x}$, the upsilon function.
Moreover, fixing $\v_0,\v_1,\v_2$ and fixing all the variables $x_i$ except $x_5$, the vector $\v_3\in\ring{R}^3$
in Equation~\ref{eqn:v3}
depends continuously on $x_5$ on the domain
\[
\{x_5 \mid x_5 > 0,\quad \Delta(x_1,\ldots,x_6)>0\}.
\]
\end{lemma}

\begin{remark} There is a symmetry to the data fixing $\v_0$, $x_3$, $x_6$, $\ups(x_1,x_2,x_6)$  and swapping
$\v_1\leftrightarrow \v_2$, $x_1\leftrightarrow x_2$, $x_4\leftrightarrow x_5$, $\Delta_5 \leftrightarrow \Delta_4$.
Under this symmetry, the vector $\v_3$ is given by the same formula, except that $\sqrt{\Delta}$ is
replaced with $-\sqrt{\Delta}$, and the sign of the triple product is reversed.
\end{remark}

\begin{proof}
It can be shown by direct computation that the vector $\v_3$ works.  This proof gives details about how
$\v_3$ is found.

Without loss of generality, we may move $\v_0$ to the origin.  Explicitly,
we let $\w_i = \v_i - \v_0$.  We will construct a unique $\w_3$ (for $\w_0=0$) and then set $\v_3 = \v_0 + \w_3$.

Note that the non-collinearity condition on $\{\v_0,\v_1,\v_2\}$ gives $\w_1\times\w_2\ne 0$.
We may write $\w_3$ in terms of the basis $\w_1\times\w_2$, $\w_1$, and $\w_2$:
\[
\w_3 = \alpha (\w_1\times \w_2) + \beta \w_1 + \gamma \w_2.
\]
We compute the norms of $\w_3$, $\w_3 - \w_1$ and $\w_3-\w_2$ in this basis:
\begin{align*}
\normo{\w_3}^2 = x_3 &= \alpha^2 \normo{\w_1\times\w_2}^2 + \normo{\beta\w_1+\gamma\w_2}^2 \\
\norm{\w_3}{\w_1}^2 = x_5 &= \alpha^2 \normo{\w_1\times\w_2}^2 + \normo{(\beta-1)\w_1 + \gamma\w_2}^2\\
\norm{\w_3}{\w_2}^2 = x_4 &= \alpha^2\normo{\w_1\times\w_2}^2 +\normo{\beta\w_1 + (\gamma-1)\w_2}^2.
\end{align*}
We eliminate $\alpha^2$ from the equations and write the resulting equations for $\beta$ and $\gamma$ as
a linear system:
\[
\left(\begin{matrix} \normo{\w_1}^2 & \w_1\cdot \w_2 \\ \w_1\cdot \w_2 & \normo{\w_2} \end{matrix}\right)
\left(\begin{matrix} \beta \\ \gamma \end{matrix}\right) = 
\left(\begin{matrix} (x_1 + x_3 - x_5)/2 \\ (x_2 + x_3 - x_4)/2 \end{matrix}\right).
\]
The determinant of the system is 
\[
\normo{\w_1}^2\normo{\w_2}^2 - (\w_1\cdot \w_2)^2 = \normo{\w_1\times \w_2}^2 >  0.
\]
By the law of sines or cosines (Lemma~2.59), this determinant can also be written in terms of $x_i$:
\[
x_1 x_2 - ((x_6 - x_1 - x_2)/2)^2 = \ups(x_1,x_2,x_6)/4 > 0.
\]
Thus, there are unique solutions $\beta$ and $\gamma$ as functions of the variables $x_i$. Explicitly,
\[
\beta = \Delta_5/\ups(x_1,x_2,x_6),\quad \gamma = \Delta_4/\ups(x_1,x_2,x_6),
\]
where $\Delta_i=\Delta_i(x_1,\ldots,x_6)$ is the $i$th partial derivative of $\Delta$.

With $\beta$ and $\gamma$ in hand, we solve for $\alpha$ using the equation:
\[
x_3 - \normo{\beta\w_1 + \gamma\w_2}^2 = \alpha^2 \normo{\w_1\times \w_2}^2.
\]
The left-hand side of this equation, expressed in terms of the variables $x_i$ is precisely $\Delta/\ups(x_1,x_2,x_6) >0$.
Hence 
\[
\alpha = \pm 2\frac{\sqrt{\Delta(x_1,\ldots,x_6)}} {\ups(x_1,x_2,x_6)}.
\]
The triple product is
\[
((\v_1 - \v_0) \times (\v_2 - \v_0)) \cdot (\v_3 - \v_0) = (\w_1 \times \w_2) \cdot \w_3 = \alpha |\w_1\times \w_2|^2.
\]
This is positive exactly when $\alpha$ is chosen to be positive.
This shows the existence of a unique vector $\w_3$ subject to the given conditions.

Continuity follows from the continuous dependence of $\alpha$, $\beta$, and $\gamma$ on $x_5$.
In fact, $\beta$ and $\gamma$ are polynomials in $x_5$ and $\alpha$ requires the extraction of a square
root of a positive polynomial in $x_5$.
\end{proof}


We will need a second lemma for deformations that occur within a plane.
Our intention is to define a new constant
to equal the right-hand side of Equation~\ref{eqn:v3-planar}.  It will be used in two
contexts.  Sometimes, the variable $x_3$ will run over
an interval to define a continuous deformation of a local fan $(V,E,F)$.
At other times, the vector $\v_2$ will vary in a continuous deformation constructed in the previous lemma,
and $\v_3$ will be carried continuously along in the plane of $\{\v_0,\v_1,\v_2(t)\}$ by the construction of this lemma.



\begin{lemma}\guid{EYYPQDW}\label{lemma:EYY}
\formalauthor{Hoang Le Truong}
Let $\{\v_0,\v_1,\v_2\}\subset \ring{R}^3$.  Assume that $\{\v_0,\v_1,\v_2\}$ is
not collinear.  Let $x_1, x_2,x_3,x_5,x_6 \in\ring{R}^3$ be given with $x_i> 0$ and
\[
x_1 = \norm{\v_1}{\v_0}^2, \quad x_2 = \norm{\v_2}{\v_0}^2,\quad x_6 = \norm{\v_1}{\v_2}^2.
\]
Assume that $\ups(x_1,x_3,x_5)>0$.  Let $\sigma\in\{\pm 1\}$ be a choice of sign.
Then there exists  $\v_3$ such that
\begin{itemize}
\item $\{\v_0,\v_1,\v_2,\v_3\}$ is coplanar.
\item $x_3 = \norm{\v_3}{\v_0}^2,\quad x_5 = \norm{\v_3}{\v_1}^2$, and 
\item $(\v_3 - \v_0) \times (\v_1-\v_0)$ is a positive scalar times $\sigma (\v_1-\v_0)\times (\v_2 - \v_0)$.
\end{itemize}
Explicitly, the following vector works:
\begin{equation}\label{eqn:v3-planar}
\v_3 = \v_0 +  \frac{x_1 + x_3 - x_5}{2x_1}  (\v_1 - \v_0) + \frac{\sigma}{x_1} \sqrt{\frac {\ups(x_1,x_3,x_5)}{\ups(x_1,x_2,x_6)}}
   (\v_1 - \v_0) \times ((\v_1-\v_0) \times (\v_2-\v_0)).
\end{equation}
Moreover, fixing $\v_0,\v_1,\v_2$ and fixing all the variables $x_i$ except $x_3$, the vector $\v_3\in\ring{R}^3$
depends continuously on $x_3$ on the domain
\[
\{x_3 \mid x_3 > 0,\quad \ups(x_1,x_3,x_5) > 0\}.
\]
Moreover, fixing $\v_0,\v_1$ and fixing all the variables $x_i$, the vector $\v_3\in\ring{R}^3$ depends continuously
on $\v_2$ on the domain
\[
\{ \v_2\in\ring{R}^3\mid \v_2 \text{~~ is not on the line through~~ } \v_0 \text{~ and ~} \v_1 \}.
\]
\end{lemma}

\begin{remark} There is a symmetry in the data $\v_0\leftrightarrow \v_1$, $x_3\leftrightarrow x_5$,
$x_2\leftrightarrow x_6$ fixing $\v_2$ and $x_1$.  The symmetry preserves the solution $\v_3$.
\end{remark}

\begin{proof}
Without loss of generality, we may move $\v_0$ to the origin.  Explicitly,
we let $\w_i = \v_i - \v_0$.  We will construct a unique $\w_3$ (for $\w_0=0$) and then set $\v_3 = \v_0 + \w_3$.

Let $\n = \w_1 \times (\w_1\times \w_2)$.  By the non-collinearity assumption and the positivity of $x_i$,
we have $\n\ne 0$.  In fact, $\w_1$ are  $\n$ are orthogonal and span $\op{aff}\{\orz,\w_1,\w_2\}$.
The norm of $\n$ is computed as in the previous lemma by the law of cosiines:
\[
\normo{\n}^2 = \normo{\w_1}^2 \normo{\w_1\times \w_2}^2  = x_1 \ups(x_1,x_2,x_6)/4 > 0.
\]
We solve for $\w_3$ as a combination of $\w_1$ and $\n$:
\[
\w_3 = \alpha \w_1 + \beta \n.
\]
The norms of $\w_3$ and $\w_3-\w_1$ are computed as 
\begin{align*}
\normo{\w_3}^2 &= x_3 = \alpha^2 \normo {\w_1}^2 + \beta^2 \normo{\n}\\
\normo{\w_3-\w_1}^2 &= x_5 = \alpha^2 \normo {\w_1}^2 + \beta^2 \normo{\n}\\
\end{align*}
Eliminate $\beta$ and solve the resulting linear equation uniquely for $\alpha$:
\[
\alpha = (x_1 + x_3 - x_5)/(2 x_1).
\]
The right-hand side of $\beta^2 \normo{\n}^2 = x_3 - \alpha^2 x_1$, expressed in terms of the variables $x_i$
is $\ups(x_1,x_3,x_5)/(4 x_1)$.  Hence,
\[
\beta = \pm\frac{1}{x_1} \sqrt{\frac {\ups(x_1,x_3,x_5)}{\ups(x_1,x_2,x_6)}}.
\]

To compute the sign of $\beta$, we examine the cross-product condition.
\begin{align*}
\w_3\times \w_1 &= (\alpha \w_1 + \beta \n)\times \w_1 \\
 &= \beta  (\w_1\times (\w_1\times \w_2)) \times \w_1\\
&= \beta (\w_1 \times \w_2) (\w_1\cdot \w_1)\\
&= \beta x_1 (\w_1\times \w_2).
\end{align*}
This is a positive multiple of $\sigma \w_1\times \w_2$ when $\beta$ has sign $\sigma$.
This establishes the unique existence of $\w_3$.  

Continuity follows from the explicit formulas for $\alpha$ and $\beta$.
\end{proof}

